!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var n={};t(n),e.htmlparser=n}}(this,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();"undefined"!=typeof window&&(window.Tautologistics||(window.Tautologistics={}),window.Tautologistics.NodeHtmlParser=e);var p="text",s="script",o="tag",l="attr",r="cdata",u="doctype",g="comment",m=[{langName:"mustache",open:"{{",close:"}}",openCode:"￰",closeCode:"￱"},{langName:"singleMustache",open:"{",close:"}",openCode:"￲",closeCode:"￳"}],n=[];function a(e){a.super_.call(this,e,{ignoreWhitespace:!0,verbose:!1,enforceEmptyTags:!1,caseSensitiveTags:!0})}m.forEach(function(e){n.push(e.openCode)},void 0),a.prototype.done=function(){var e,i={},t=h.getElementsByTagName(function(e){return"rss"==e||"feed"==e},this.dom,!1);if(t.length&&(e=t[0]),e){if("rss"==e.name){i.type="rss",e=e.children[0],i.id="";try{i.title=h.getElementsByTagName("title",e.children,!1)[0].children[0].data}catch(e){}try{i.link=h.getElementsByTagName("link",e.children,!1)[0].children[0].data}catch(e){}try{i.description=h.getElementsByTagName("description",e.children,!1)[0].children[0].data}catch(e){}try{i.updated=new Date(h.getElementsByTagName("lastBuildDate",e.children,!1)[0].children[0].data)}catch(e){}try{i.author=h.getElementsByTagName("managingEditor",e.children,!1)[0].children[0].data}catch(e){}i.items=[],h.getElementsByTagName("item",e.children).forEach(function(e,t,n){var a={};try{a.id=h.getElementsByTagName("guid",e.children,!1)[0].children[0].data}catch(e){}try{a.title=h.getElementsByTagName("title",e.children,!1)[0].children[0].data}catch(e){}try{a.link=h.getElementsByTagName("link",e.children,!1)[0].children[0].data}catch(e){}try{a.description=h.getElementsByTagName("description",e.children,!1)[0].children[0].data}catch(e){}try{a.pubDate=new Date(h.getElementsByTagName("pubDate",e.children,!1)[0].children[0].data)}catch(e){}i.items.push(a)})}else{i.type="atom";try{i.id=h.getElementsByTagName("id",e.children,!1)[0].children[0].data}catch(e){}try{i.title=h.getElementsByTagName("title",e.children,!1)[0].children[0].data}catch(e){}try{i.link=h.getElementsByTagName("link",e.children,!1)[0].attributes.href.value}catch(e){}try{i.description=h.getElementsByTagName("subtitle",e.children,!1)[0].children[0].data}catch(e){}try{i.updated=new Date(h.getElementsByTagName("updated",e.children,!1)[0].children[0].data)}catch(e){}try{i.author=h.getElementsByTagName("email",e.children,!0)[0].children[0].data}catch(e){}i.items=[],h.getElementsByTagName("entry",e.children).forEach(function(e,t,n){var a={};try{a.id=h.getElementsByTagName("id",e.children,!1)[0].children[0].data}catch(e){}try{a.title=h.getElementsByTagName("title",e.children,!1)[0].children[0].data}catch(e){}try{a.link=h.getElementsByTagName("link",e.children,!1)[0].attributes.href.value}catch(e){}try{a.description=h.getElementsByTagName("summary",e.children,!1)[0].children[0].data}catch(e){}try{a.pubDate=new Date(h.getElementsByTagName("updated",e.children,!1)[0].children[0].data)}catch(e){}i.items.push(a)})}this.dom=i}a.super_.prototype.done.call(this)};var h={testAttribute:function(e,t){for(var n=0;n<t.length;n++)if(e(t[n].data))return!0;return!1},testElement:function(e,t){if(!t)return!1;for(var n in e)if(e.hasOwnProperty(n))if("tag_name"==n){if(t.type!==o)return!1;if(!e.tag_name(t.name))return!1}else if("tag_type"==n){if(!e.tag_type(t.type))return!1}else if("tag_contains"==n){if(t.type!==p&&t.type!==g&&t.type!==r)return!1;if(!e.tag_contains(t.data))return!1}else if(!t.attributes||!t.attributes[n]||!h.testAttribute(e[n],t.attributes[n]))return!1;return!0},getElements:function(e,t,n,a){setPrototypeOfDomUtils=function(e){},n=null==n||!!n,a=isNaN(parseInt(a))?-1:parseInt(a);var i,s=[];if(setPrototypeOfDomUtils(s),!t)return s;function r(t){return function(e){return e==t}}for(var o in e)"function"!=typeof e[o]&&(e[o]=r(e[o]));if(h.testElement(e,t)&&s.push(t),0<=a&&s.length>=a)return s;if(n&&t.children)i=t.children;else{if(!(t instanceof Array))return s;i=t}for(var l=0;l<i.length&&(s=s.concat(h.getElements(e,i[l],n,a)),!(0<=a&&s.length>=a));l++);return s},getElementById:function(e,t,n){var a=h.getElements({id:e},t,n,1);return a.length?a[0]:null},getElementsByTagName:function(e,t,n,a){return h.getElements({tag_name:e},t,n,a)},getElementsByTagType:function(e,t,n,a){return h.getElements({tag_type:e},t,n,a)},removeChild:function(e,t){for(var n=0;n<t.children.length;n++)e===t.children[n]&&t.children.splice(n,1)},removeChildAll:function(e){e.children=[]}};var f=e.Parser=function(){function h(e,t){c(this,h),this.writable=!0,this._options=t||{},this._validateBuilder=function(e){if("object"!=(void 0===e?"undefined":d(e)))throw new Error("Builder is not an object");if("function"!=typeof e.reset)throw new Error("Builder method 'reset' is invalid");if("function"!=typeof e.done)throw new Error("Builder method 'done' is invalid");if("function"!=typeof e.write)throw new Error("Builder method 'write' is invalid");if("function"!=typeof e.error)throw new Error("Builder method 'error' is invalid")},this._validateBuilder(e);this._builder=e,this.reset=function(){this._state={mode:p,lastMode:p,pos:0,data:null,pendingText:null,pendingWrite:null,lastTag:null,isScript:!1,needData:!1,output:[],done:!1,commentTagType:">",scriptTagType:null},this._builder.reset()},this.reset();var n=new _(this);this._parseText=function(e){return n._parseText(e)};var a=new y(this);this._parseScript=function(e){return a._parseScript(e)};var i=new v(this);this._parseTag=function(e){return i._parseTag(e)};var s=new w(this);this._parseAttr=function(e){return s._parseAttr(e)};var r=new x(this);this._parseCData=function(e){return r._parseCData(e)};var o=new E(this);this._parseDoctype=function(e){return o._parseDoctype(e)};var l=new k(this);this._parseComment=function(e){return l._parseComment(e)}}return i(h,[{key:"write",value:function(e){e instanceof Buffer&&(e=e.toString()),this.parseChunk(e)}},{key:"end",value:function(e){arguments.length&&this.write(e),this.writable=!1,this.done()}},{key:"destroy",value:function(){this.writable=!1}},{key:"parseChunk",value:function(e){for(this._state.needData=!1,this._state.data=null!==this._state.data?this._state.data.substr(this.pos)+e:e;this._state.pos<this._state.data.length&&!this._state.needData;)this._parse(this._state)}},{key:"parseComplete",value:function(t){t&&(this.reset(),m.forEach(function(e){t=t.replace(new RegExp(e.open,"g"),e.openCode).replace(new RegExp(e.close,"g"),e.closeCode)},this),this.parseChunk(t),this.done())}},{key:"done",value:function(){this._state.done=!0,this._parse(this._state),this._flushWrite(),this._builder.done()}},{key:"_parse",value:function(){switch(this._state.mode){case p:return this._parseText(this._state);case s:return this._parseScript(this._state);case o:return this._parseTag(this._state);case l:return this._parseAttr(this._state);case r:return this._parseCData(this._state);case u:return this._parseDoctype(this._state);case g:return this._parseComment(this._state)}}},{key:"_writePending",value:function(e){this._state.pendingWrite||(this._state.pendingWrite=[]),this._state.pendingWrite.push(e)}},{key:"_flushWrite",value:function(){if(this._state.pendingWrite){for(var e=0,t=this._state.pendingWrite.length;e<t;e++){var n=this._state.pendingWrite[e];this._builder.write(n)}this._state.pendingWrite=null}}},{key:"_write",value:function(e){this._flushWrite(),this._builder.write(e)}}]),h}(),_=e.ParseText=function(){function t(e){c(this,t),this.perser=e,this._re_parseText_tagOpen=new RegExp("([\\<"+n.join("")+"])","g"),this._re_parseText_scriptClose=/<\s*\/\s*(x\-)?script/gi}return i(t,[{key:"_parseText",value:function(t){var n,a=o;if(t.isScript)this._re_parseText_scriptClose.lastIndex=t.pos,n=(n=this._re_parseText_scriptClose.exec(t.data))?n.index:-1;else{this._re_parseText_tagOpen.lastIndex=t.pos;var i=this._re_parseText_tagOpen.exec(t.data);i?"<"==i[0]?(a=o,n=i.index):m.forEach(function(e){i[0]==e.openCode&&(a=s,t.lastMode=p,n=i.index,t.scriptTagType=e)},this.perser):(a=o,n=-1)}var e=-1===n?t.data.substring(t.pos,t.data.length):t.data.substring(t.pos,n);if(n<0&&t.done&&(n=t.data.length),n<0){if(t.isScript)return void(t.needData=!0);t.pendingText||(t.pendingText=[]),t.pendingText.push(t.data.substring(t.pos,t.data.length)),t.pos=t.data.length}else t.pendingText?(t.pendingText.push(t.data.substring(t.pos,n)),e=t.pendingText.join(""),t.pendingText=null):e=t.data.substring(t.pos,n),""!==e&&this.perser._write({type:p,data:e}),t.pos=n+1,t.mode=a}}]),t}(),y=e.ParseScript=function(){function t(e){c(this,t),this.perser=e,this.re_parseScript=/\s*([\/\#][^\s\}]+)?(\!\-*)?\s*([^\}]*?)\}/g}return i(t,[{key:"_parseScript",value:function(e){var t="\\s*([\\/\\#][^\\s"+e.scriptTagType.closeCode+"]+)?(\\!\\-*)?\\s*([^"+e.scriptTagType.closeCode+"]*?)"+e.scriptTagType.closeCode;this.re_parseScript=new RegExp(t,"g"),this.re_parseScript.lastIndex=e.pos;var n=this.re_parseScript.exec(e.data);if(n){if(e.mode=s,n[2]&&"!--"===n[2].substr(0,3))return e.mode=g,e.commentTagType=e.scriptTagType.closeCode,void(e.pos+=3);n[2]&&"!"==n[2].charAt(0)&&(e.mode=g,e.commentTagType=e.scriptTagType.closeCode,e.pos+=1);var a=n[3];e.pendingText&&(e.pendingText.push(a),a=e.pendingText.join(""),e.pendingText=null),""!==a&&this.perser._write({type:e.mode,name:n[1]||n[2],data:a,langName:e.scriptTagType.langName}),e.pos+=n[0].length,e.mode=e.lastMode}else e.needData=!0}}]),t}(),v=e.ParseTag=function(){function t(e){c(this,t),this.perser=e,this.re_parseTag=/\s*(\/?)\s*([^\s>\/]+)(\s*)\??(>?)/g}return i(t,[{key:"_parseTag",value:function(e){this.re_parseTag.lastIndex=e.pos;var t=this.re_parseTag.exec(e.data);if(t){if(!t[1]&&"!--"===t[2].substr(0,3))return e.mode=g,e.commentTagType=">",void(e.pos+=3);if(!t[1]&&"![CDATA["===t[2].substr(0,8))return e.mode=r,void(e.pos+=8);if(!t[1]&&"!DOCTYPE"===t[2].substr(0,8))return e.mode=u,void(e.pos+=8);if(!e.done&&e.pos+t[0].length===e.data.length)return void(e.needData=!0);var n;n=">"===t[4]?(e.mode=p,t[0].substr(0,t[0].length-1)):(e.mode=l,t[0]),e.pos+=t[0].length;var a={type:o,name:t[1]+t[2],raw:n};e.mode===l&&(e.lastTag=a),"script"===a.name.toLowerCase()?e.isScript=!0:"/script"===a.name.toLowerCase()&&(e.isScript=!1),"x-script"===a.name.toLowerCase()?e.isScript=!0:"/x-script"===a.name.toLowerCase()&&(e.isScript=!1),e.mode===l?this.perser._writePending(a):this.perser._write(a)}else e.needData=!0}}]),t}(),T=e.ParseAttr_findName=function(){function t(e){c(this,t),this.perser=e,this.re_parseAttr_findName=/\s*([^=<>\s'"\/]+)\s*/g}return i(t,[{key:"_parseAttr_findName",value:function(e){this.re_parseAttr_findName.lastIndex=e.pos;var t=this.re_parseAttr_findName.exec(e.data);return t?e.pos+t[0].length!==this.re_parseAttr_findName.lastIndex?null:{match:t[0],name:t[1]}:null}}]),t}(),b=e.ParseAttr_findValue=function(){function t(e){c(this,t),this.perser=e,this.re_parseAttr_findValue=/\s*=\s*(?:'([^']*)'|"([^"]*)"|([^'"\s\/>]+))\s*/g,this.re_parseAttr_findValue_last=/\s*=\s*['"]?(.*)$/g}return i(t,[{key:"_parseAttr_findValue",value:function(e){this.re_parseAttr_findValue.lastIndex=e.pos;var t=this.re_parseAttr_findValue.exec(e.data);return t?e.pos+t[0].length!==this.re_parseAttr_findValue.lastIndex?null:{match:t[0],value:t[1]||t[2]||t[3]}:e.done?(this.re_parseAttr_findValue_last.lastIndex=e.pos,(t=this.re_parseAttr_findValue_last.exec(e.data))?{match:t[0],value:""!==t[1]?t[1]:null}:null):null}}]),t}(),w=e.ParseAttr=function(){function t(e){c(this,t),this.perser=e,this.re_parseAttr_splitValue=/^\s*=\s*['"]?/g,this.re_parseAttr_selfClose=/(\s*\/\s*)(>?)/g,this.parseAttr_findName=new T(e),this.parseAttr_findValue=new b(e)}return i(t,[{key:"_parseAttr",value:function(e){var t=this.parseAttr_findName._parseAttr_findName(e);if(t&&"?"!==t.name){if(!e.done&&e.pos+t.match.length===e.data.length)return e.needData=!0,null;e.pos+=t.match.length;var n=this.parseAttr_findValue._parseAttr_findValue(e);if(n){if(!e.done&&e.pos+n.match.length===e.data.length)return e.needData=!0,void(e.pos-=t.match.length);e.pos+=n.match.length}else{if(this.re_parseAttr_splitValue.lastIndex=e.pos,this.re_parseAttr_splitValue.exec(e.data))return e.needData=!0,void(e.pos-=t.match.length);n={match:"",value:null}}e.lastTag.raw+=t.match+n.match;var a=[];if(n.value){var i=new C(function(e,t){},this.perser._builder._options);new f(i).parseComplete(n.value),a=i.dom}this.perser._writePending({type:l,name:t.name,data:a})}else{this.re_parseAttr_selfClose.lastIndex=e.pos;var s=this.re_parseAttr_selfClose.exec(e.data);if(s&&s.index===e.pos){if(!e.done&&!s[2]&&e.pos+s[0].length===e.data.length)return void(e.needData=!0);e.lastTag.raw+=s[1],this.perser._write({type:o,name:"/"+e.lastTag.name,raw:null}),e.pos+=s[1].length}var r=e.data.indexOf(">",e.pos);if(r<0){if(e.done)return e.lastTag.raw+=e.data.substr(e.pos),void(e.pos=e.data.length);e.needData=!0}else e.pos=r+1,e.mode=p}}}]),t}(),x=e.ParseCData=function(){function t(e){c(this,t),this.perser=e,this.re_parseCData_findEnding=/\]{1,2}$/}return i(t,[{key:"_parseCData",value:function(e){var t=e.data.indexOf("]]>",e.pos);if(t<0&&e.done&&(t=e.data.length),t<0){if(this.re_parseCData_findEnding.lastIndex=e.pos,this.re_parseCData_findEnding.exec(e.data))return void(e.needData=!0);e.pendingText||(e.pendingText=[]),e.pendingText.push(e.data.substr(e.pos,e.data.length)),e.pos=e.data.length,e.needData=!0}else{var n;e.pendingText?(e.pendingText.push(e.data.substring(e.pos,t)),n=e.pendingText.join(""),e.pendingText=null):n=e.data.substring(e.pos,t),this.perser._write({type:r,data:n}),e.mode=p,e.pos=t+3}}}]),t}(),E=e.ParseDoctype=function(){function t(e){c(this,t),this.perser=e}return i(t,[{key:"_parseDoctype",value:function(e){var t,n=e.data.indexOf(">",e.pos);(n<0&&e.done&&(n=e.data.length),n<0)?(this.re_parseCData_findEnding.lastIndex=e.pos,e.pendingText||(e.pendingText=[]),e.pendingText.push(e.data.substr(e.pos,e.data.length)),e.pos=e.data.length,e.needData=!0):(e.pendingText?(e.pendingText.push(e.data.substring(e.pos,n)),t=e.pendingText.join(""),e.pendingText=null):t=e.data.substring(e.pos,n),this.perser._write({type:u,data:t}),e.mode=p,e.pos=n+1)}}]),t}(),k=e.ParseComment=function(){function t(e){c(this,t),this.perser=e,this.re_parseComment_findEnding=/\-{1,2}$/}return i(t,[{key:"_parseComment",value:function(e){var t=e.data.indexOf("--"+e.commentTagType,e.pos);if(t<0&&e.done&&(t=e.data.length),t<0){if(this.re_parseComment_findEnding.lastIndex=e.pos,this.re_parseComment_findEnding.exec(e.data))return void(e.needData=!0);e.pendingText||(e.pendingText=[]),e.pendingText.push(e.data.substr(e.pos,e.data.length)),e.pos=e.data.length,e.needData=!0}else{var n;e.pendingText?(e.pendingText.push(e.data.substring(e.pos,t)),n=e.pendingText.join(""),e.pendingText=null):n=e.data.substring(e.pos,t),this.perser._write({type:g,data:n}),e.mode=p,e.pos=t+3}}}]),t}(),C=function(){function n(e,t){c(this,n),this._options=null,this._callback=null,this._done=!1,this._tagStack=null,this.dom=null,this._emptyTags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1,"?xml":1,wbr:1},this.reWhitespace=/^\s*$/,this.reset(),"function"==typeof e?this._callback=e:t=e,this._options=t||{},void 0===this._options.ignoreWhitespace&&(this._options.ignoreWhitespace=!1),void 0===this._options.includeLocation&&(this._options.includeLocation=!1),void 0===this._options.verbose&&(this._options.verbose=!0),void 0===this._options.enforceEmptyTags&&(this._options.enforceEmptyTags=!0),void 0===this._options.caseSensitiveTags&&(this._options.caseSensitiveTags=!1),void 0===this._options.caseSensitiveAttr&&(this._options.caseSensitiveAttr=!1)}return i(n,[{key:"setPrototypeOfDomUtils",value:function(e){}},{key:"reset",value:function(){this.dom=[],this.setPrototypeOfDomUtils(this.dom),this._done=!1,this._tagStack=[],this._lastTag=null,this._tagStack.last=function(){return this.length?this[this.length-1]:null},this._line=1,this._col=1}},{key:"done",value:function(){this._done=!0,this.handleCallback(null)}},{key:"error",value:function(e){this.handleCallback(e)}},{key:"handleCallback",value:function(e){if("function"==typeof this._callback)this._callback(e,this.dom);else if(e)throw e}},{key:"isEmptyTag",value:function(e){var t=e.name.toLowerCase();return"?"==t.charAt(0)||("/"==t.charAt(0)&&(t=t.substring(1)),this._options.enforceEmptyTags&&!!this._emptyTags[t])}},{key:"_getLocation",value:function(){return{line:this._line,col:this._col}}},{key:"_updateLocation",value:function(e){var t=e.type===o?e.raw:e.data;if(null!==t){var n=t.split("\n");this._line+=n.length-1,1<n.length&&(this._col=1),this._col+=n[n.length-1].length,e.type===o?this._col+=2:e.type===g?this._col+=7:e.type===r&&(this._col+=12)}}},{key:"_copyElement",value:function(t,e){var n=new N(t.type,e);if(this._options.verbose&&void 0!==t.raw&&(n.raw=t.raw),void 0!==t.name)switch(t.type){case o:n.name=this._options.caseSensitiveTags?t.name:t.name.toLowerCase();break;case l:n.name=this._options.caseSensitiveAttr?t.name:t.name.toLowerCase();break;default:n.name=this._options.caseSensitiveTags?t.name:t.name.toLowerCase()}return void 0!==t.data&&(m.forEach(function(e){t.data=t.data.replace(new RegExp(e.openCode,"g"),e.open).replace(new RegExp(e.closeCode,"g"),e.close)},this),n.data=t.data),void 0!==t.langName&&(n.langName=t.langName),t.location&&(n.location={line:t.location.line,col:t.location.col}),n}},{key:"write",value:function(e){var t,n;if(this._done&&this.handleCallback(new Error("Writing to the builder after done() called is not allowed without a reset()")),this._options.includeLocation&&e.type!==l&&(e.location=this._getLocation(),this._updateLocation(e)),e.type!==p||!this._options.ignoreWhitespace||!this.reWhitespace.test(e.data))if(this._tagStack.last())if(e.type===o)if("/"==e.name.charAt(0)){var a=this._options.caseSensitiveTags?e.name.substring(1):e.name.substring(1).toLowerCase();if(!this.isEmptyTag(e)){for(var i=this._tagStack.length-1;-1<i&&this._tagStack[i--].name!=a;);if(-1<i||this._tagStack[0].name==a)for(;i<this._tagStack.length-1;)this._tagStack.pop()}}else t=this._tagStack.last(),e.type===l?(t.attributes||(t.attributes={}),t.attributes[this._options.caseSensitiveAttr?e.name:e.name.toLowerCase()]=e.data):(n=this._copyElement(e,t),t.children||(t.children=[]),t.children.push(n),this.isEmptyTag(n)||this._tagStack.push(n),e.type===o&&(this._lastTag=n));else if(e.type===s)if(e.name&&"/"==e.name.charAt(0)){a=this._options.caseSensitiveTags?e.name.substring(1):e.name.substring(1).toLowerCase();if(!this.isEmptyTag(e)){for(i=this._tagStack.length-1;-1<i&&this._tagStack[i--].name!=a;);if(-1<i||this._tagStack[0].name==a)for(;i<this._tagStack.length-1;)this._tagStack.pop()}}else e.name&&"!"==e.name.charAt(0)?(t=this._tagStack.last(),e.name&&(e.name=this._options.caseSensitiveTags?e.name.substring(1):e.name.substring(1).toLowerCase()),n=this._copyElement(e,t),t.children||(t.children=[]),t.children.push(n)):(t=this._tagStack.last(),e.name&&(e.name=this._options.caseSensitiveTags?e.name.substring(1):e.name.substring(1).toLowerCase()),n=this._copyElement(e,t),t.children||(t.children=[]),t.children.push(n),e.name&&this._tagStack.push(n)),this._lastTag=n;else t=this._tagStack.last(),e.type===l?(this._lastTag.attributes||(this._lastTag.attributes={}),this._lastTag.attributes[this._options.caseSensitiveAttr?e.name:e.name.toLowerCase()]=e.data):(t.children||(t.children=[]),t.children.push(this._copyElement(e,t)));else if(e.type===o)"/"!=e.name.charAt(0)&&(n=this._copyElement(e),this.dom.push(n),this.isEmptyTag(n)||this._tagStack.push(n),this._lastTag=n);else if(e.type===l&&this._lastTag)this._lastTag.attributes||(this._lastTag.attributes={}),this._lastTag.attributes[this._options.caseSensitiveAttr?e.name:e.name.toLowerCase()]=e.data;else if(e.type===s){if(e.name&&"/"==e.name.charAt(0))return;e.name&&"!"==e.name.charAt(0)?(e.name=this._options.caseSensitiveTags?e.name.substring(1):e.name.substring(1).toLowerCase(),n=this._copyElement(e),this.dom.push(n)):e.name?(e.name&&(e.name=this._options.caseSensitiveTags?e.name.substring(1):e.name.substring(1).toLowerCase()),n=this._copyElement(e),this.dom.push(n),this._tagStack.push(n)):(n=this._copyElement(e),this.dom.push(n)),this._lastTag=n}else this.dom.push(this._copyElement(e))}}]),n}();e.HtmlBuilder=C,e.DefaultHandler=C;var N=e.Element=function(){function a(e,t){c(this,a),this.type=e,this.parentNode=t}return i(a,[{key:"getElementById",value:function(e,t){return h.getElementById(e,this,t)}},{key:"getElementsByTagName",value:function(e,t,n){return h.getElementsByTagName(e,this,t,n)}},{key:"getElementsByTagType",value:function(e,t,n){return h.getElementsByTagType(e,this,t,n)}},{key:"getElements",value:function(e,t,n){return h.getElements(e,this,t,n)}},{key:"removeChildAll",value:function(){return h.removeChildAll(this)}},{key:"removeChild",value:function(e){return h.removeChild(e,this)}},{key:"createNode",value:function(e,t){return new a(e,t||null)}},{key:"createElement",value:function(e,t){var n=new a("tag",t||null);return n.name=e,n}},{key:"createTextNode",value:function(e,t){var n=new a("text",t||null);return n.data=e,n}},{key:"appendChild",value:function(e){this.children=this.children||[],(e.parentNode=this).children.push(e)}},{key:"insertBefore",value:function(e,t){this.children=this.children||[];var n=this.children.indexOf(t);this.children.splice(n,0,e)}},{key:"getAttribute",value:function(e){this.attributes[e]}},{key:"cloneElement",value:function(e){var t=this.createNode(this.type,e||{});if(this.name&&(t.name=this.name),this.raw&&(t.raw=this.raw),this.location&&(t.location={line:this.location.line,col:this.location.col}),this.langName&&(t.langName=this.langName),this.data&&(t.data=this.data),this.attributes&&(t.attributes=function(e){var t={};for(var n in e){for(var a=e[n],i=[],s=0;s<a.length;s++){var r=a[s],o={type:r.type,data:r.data};r.langName&&(o.langName=r.langName),i.push(o)}t[n]=i}return t}(this.attributes)),this.children){t.children=[];for(var n=0;n<this.children.length;n++){this.children[n].cloneElement(t)}}return t.parentNode.children?t.parentNode.children.push(t):t.parentNode.children=[t],t}},{key:"nextSibling",get:function(){if(!this.parentNode||!this.parentNode.children)return null;var e=this.parentNode.children.indexOf(this);return-1==e||this.parentNode.children.lenght<=e?null:this.parentNode.children[e+1]}},{key:"attribs",get:function(){if(!this.attributes)return null;var e={};for(var t in this.attributes){var n="";this.attributes[t].forEach(function(e){n=e.data||""}),e[t]=n}return console.log("attribs",e),e}}]),a}()});