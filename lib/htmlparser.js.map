{"version":3,"sources":["htmlparser.es6"],"names":["window","Tautologistics","NodeHtmlParser","exports","inherits","ctor","superCtor","tempCtor","prototype","super_","constructor","Mode","Text","Script","Tag","Attr","CData","Doctype","Comment","TagType","langName","open","close","openCode","closeCode","opentags","forEach","tagtype","push","RssBuilder","callback","call","ignoreWhitespace","verbose","enforceEmptyTags","caseSensitiveTags","done","RssBuilder$done","feed","feedRoot","found","DomUtils","getElementsByTagName","value","dom","length","name","type","children","id","title","data","ex","link","description","updated","Date","author","items","item","index","list","entry","pubDate","attributes","href","testAttribute","DomUtils$testAttribute","option","i","testElement","DomUtils$testElement","options","element","key","hasOwnProperty","getElements","DomUtils$getElements","currentElement","recurse","limit","setPrototypeOfDomUtils","array","undefined","isNaN","parseInt","elementList","getTest","checkVal","Array","concat","getElementById","DomUtils$getElementById","result","DomUtils$getElementsByTagName","tag_name","getElementsByTagType","DomUtils$getElementsByTagType","tag_type","removeChild","DomUtils$removeChild","splice","removeChildAll","DomUtils$removeChildAll","parseDOM","handler","HtmlBuilder","Parser","parseComplete","newElement","Element","parentNode","builder","writable","_options","_validateBuilder","Error","reset","write","error","self","_builder","_state","mode","lastMode","pos","pendingText","pendingWrite","lastTag","isScript","needData","output","commentTagType","scriptTagType","parseText","ParseText","_parseText","state","parseScript","ParseScript","_parseScript","parseTag","ParseTag","_parseTag","parseAttr","ParseAttr","_parseAttr","parseCData","ParseCData","_parseCData","parseDoctype","ParseDoctype","_parseDoctype","parseComment","ParseComment","_parseComment","Buffer","toString","parseChunk","arguments","chunk","substr","_parse","replace","RegExp","_flushWrite","node","len","perser","_re_parseText_tagOpen","join","_re_parseText_scriptClose","nextMode","foundPos","lastIndex","exec","match","text","substring","_write","re_parseScript","charAt","re_parseTag","raw","tag","toLowerCase","_writePending","ParseAttr_findName","re_parseAttr_findName","ParseAttr_findValue","re_parseAttr_findValue","re_parseAttr_findValue_last","re_parseAttr_splitValue","re_parseAttr_selfClose","parseAttr_findName","parseAttr_findValue","name_data","_parseAttr_findName","matchTrailingSlash","indexOf","value_data","_parseAttr_findValue","foundCloseScriptPos","err","parser","re_parseCData_findEnding","matchPartialCDataEnd","re_parseComment_findEnding","matchPartialCommentEnd","_callback","_done","_tagStack","_emptyTags","area","base","basefont","br","col","frame","hr","img","input","isindex","meta","param","embed","wbr","reWhitespace","includeLocation","caseSensitiveAttr","_lastTag","last","HtmlBuilder$_tagStack$last","_line","_col","handleCallback","line","positionData","lines","split","location","_getLocation","_updateLocation","test","parent","_copyElement","isEmptyTag","baseName","pop","DefaultHandler","_type","_parentNode","tagName","newNode","referenceNode","cloneAttributes","newAttributes","attribute","_attribute","attributeElement","_attributeElement","createNode","child","cloneElement","lenght","ret","_key","content","_row","console","log"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;AAoBA;AACA,GAAC,YAAY;AACX;;;;;;;;;;;;;;;;AAgBA,QAAI,OAAOA,MAAP,KAAkB,WAAtB,EAAmC;AACjC,UAAI,CAACA,OAAOC,cAAZ,EAA4B;AAC1BD,eAAOC,cAAP,GAAwB,EAAxB;AACD;AACDD,aAAOC,cAAP,CAAsBC,cAAtB,GAAuCC,OAAvC;AACD;AAGF,GAzBD;;AA2BE,WAASC,QAAT,CAAkBC,IAAlB,EAAwBC,SAAxB,EAAmC;AACjC,QAAIC,WAAW,SAAXA,QAAW,GAAY,CAAG,CAA9B;AACAA,aAASC,SAAT,GAAqBF,UAAUE,SAA/B;AACAH,SAAKI,MAAL,GAAcH,SAAd;AACAD,SAAKG,SAAL,GAAiB,IAAID,QAAJ,EAAjB;AACAF,SAAKG,SAAL,CAAeE,WAAf,GAA6BL,IAA7B;AACD;;AAED,MAAIM,OAAO;AACTC,UAAM,MADG;AAETC,YAAQ,QAFC;AAGTC,SAAK,KAHI;AAITC,UAAM,MAJG;AAKTC,WAAO,OALE;AAMTC,aAAS,SANA;AAOTC,aAAS;AAPA,GAAX;AASA,MAAIC,UAAU,CACZ;AACEC,cAAU,UADZ;AAEEC,UAAM,IAFR;AAGEC,WAAO,IAHT;AAIEC,cAAU,QAJZ;AAKEC,eAAW;AALb,GADY,EAQZ;AACEJ,cAAU,gBADZ;AAEEC,UAAM,GAFR;AAGEC,WAAO,GAHT;AAIEC,cAAU,QAJZ;AAKEC,eAAW;AALb,GARY,CAAd;;AAiBA,MAAIC,WAAW,EAAf;AACAN,UAAQO,OAAR,CAAgB,UAAUC,OAAV,EAAmB;AACjCF,aAASG,IAAT,CAAcD,QAAQJ,QAAtB;AACD,GAFD;;AAIF;AACA;;;;;;;;AAQE,WAASM,UAAT,CAAoBC,QAApB,EAA8B;AAC5BD,eAAWpB,MAAX,CAAkBsB,IAAlB,CAAuB,IAAvB,EAA6BD,QAA7B,EAAuC;AACrCE,wBAAkB,IADmB;AAErCC,eAAS,KAF4B;AAGrCC,wBAAkB,KAHmB;AAIrCC,yBAAmB;AAJkB,KAAvC;AAMD;AACF;;;AAGCN,aAAWrB,SAAX,CAAqB4B,IAArB,GAA4B,SAASC,eAAT,GAA2B;AACrD,QAAIC,OAAO,EAAX;AACA,QAAIC,QAAJ;;AAEA,QAAIC,QAAQC,SAASC,oBAAT,CACV,UAAUC,KAAV,EAAiB;AACf,aAAOA,SAAS,KAAT,IAAkBA,SAAS,MAAlC;AACD,KAHS,EAIV,KAAKC,GAJK,EAKV,KALU,CAAZ;AAOA,QAAIJ,MAAMK,MAAV,EAAkB;AAChBN,iBAAWC,MAAM,CAAN,CAAX;AACD;AACD,QAAID,QAAJ,EAAc;AACZ,UAAIA,SAASO,IAAT,IAAiB,KAArB,EAA4B;AAC1BR,aAAKS,IAAL,GAAY,KAAZ;AACAR,mBAAWA,SAASS,QAAT,CAAkB,CAAlB,CAAX,CAF0B,CAEO;AACjCV,aAAKW,EAAL,GAAU,EAAV;AACA,YAAI;AACFX,eAAKY,KAAL,GAAaT,SAASC,oBAAT,CACX,OADW,EAEXH,SAASS,QAFE,EAGX,KAHW,EAIX,CAJW,EAIRA,QAJQ,CAIC,CAJD,EAIIG,IAJjB;AAKD,SAND,CAME,OAAOC,EAAP,EAAW,CAAG;AAChB,YAAI;AACFd,eAAKe,IAAL,GAAYZ,SAASC,oBAAT,CACV,MADU,EAEVH,SAASS,QAFC,EAGV,KAHU,EAIV,CAJU,EAIPA,QAJO,CAIE,CAJF,EAIKG,IAJjB;AAKD,SAND,CAME,OAAOC,EAAP,EAAW,CAAG;AAChB,YAAI;AACFd,eAAKgB,WAAL,GAAmBb,SAASC,oBAAT,CACjB,aADiB,EAEjBH,SAASS,QAFQ,EAGjB,KAHiB,EAIjB,CAJiB,EAIdA,QAJc,CAIL,CAJK,EAIFG,IAJjB;AAKD,SAND,CAME,OAAOC,EAAP,EAAW,CAAG;AAChB,YAAI;AACFd,eAAKiB,OAAL,GAAe,IAAIC,IAAJ,CACbf,SAASC,oBAAT,CACE,eADF,EAEEH,SAASS,QAFX,EAGE,KAHF,EAIE,CAJF,EAIKA,QAJL,CAIc,CAJd,EAIiBG,IALJ,CAAf;AAOD,SARD,CAQE,OAAOC,EAAP,EAAW,CAAG;AAChB,YAAI;AACFd,eAAKmB,MAAL,GAAchB,SAASC,oBAAT,CACZ,gBADY,EAEZH,SAASS,QAFG,EAGZ,KAHY,EAIZ,CAJY,EAITA,QAJS,CAIA,CAJA,EAIGG,IAJjB;AAKD,SAND,CAME,OAAOC,EAAP,EAAW,CAAG;AAChBd,aAAKoB,KAAL,GAAa,EAAb;AACAjB,iBAASC,oBAAT,CAA8B,MAA9B,EAAsCH,SAASS,QAA/C,EAAyDtB,OAAzD,CACE,UAAUiC,IAAV,EAAgBC,KAAhB,EAAuBC,IAAvB,EAA6B;AAC3B,cAAIC,QAAQ,EAAZ;AACA,cAAI;AACFA,kBAAMb,EAAN,GAAWR,SAASC,oBAAT,CACT,MADS,EAETiB,KAAKX,QAFI,EAGT,KAHS,EAIT,CAJS,EAINA,QAJM,CAIG,CAJH,EAIMG,IAJjB;AAKD,WAND,CAME,OAAOC,EAAP,EAAW,CAAG;AAChB,cAAI;AACFU,kBAAMZ,KAAN,GAAcT,SAASC,oBAAT,CACZ,OADY,EAEZiB,KAAKX,QAFO,EAGZ,KAHY,EAIZ,CAJY,EAITA,QAJS,CAIA,CAJA,EAIGG,IAJjB;AAKD,WAND,CAME,OAAOC,EAAP,EAAW,CAAG;AAChB,cAAI;AACFU,kBAAMT,IAAN,GAAaZ,SAASC,oBAAT,CACX,MADW,EAEXiB,KAAKX,QAFM,EAGX,KAHW,EAIX,CAJW,EAIRA,QAJQ,CAIC,CAJD,EAIIG,IAJjB;AAKD,WAND,CAME,OAAOC,EAAP,EAAW,CAAG;AAChB,cAAI;AACFU,kBAAMR,WAAN,GAAoBb,SAASC,oBAAT,CAClB,aADkB,EAElBiB,KAAKX,QAFa,EAGlB,KAHkB,EAIlB,CAJkB,EAIfA,QAJe,CAIN,CAJM,EAIHG,IAJjB;AAKD,WAND,CAME,OAAOC,EAAP,EAAW,CAAG;AAChB,cAAI;AACFU,kBAAMC,OAAN,GAAgB,IAAIP,IAAJ,CACdf,SAASC,oBAAT,CACE,SADF,EAEEiB,KAAKX,QAFP,EAGE,KAHF,EAIE,CAJF,EAIKA,QAJL,CAIc,CAJd,EAIiBG,IALH,CAAhB;AAOD,WARD,CAQE,OAAOC,EAAP,EAAW,CAAG;AAChBd,eAAKoB,KAAL,CAAW9B,IAAX,CAAgBkC,KAAhB;AACD,SAzCH;AA2CD,OArFD,MAqFO;AACLxB,aAAKS,IAAL,GAAY,MAAZ;AACA,YAAI;AACFT,eAAKW,EAAL,GAAUR,SAASC,oBAAT,CACR,IADQ,EAERH,SAASS,QAFD,EAGR,KAHQ,EAIR,CAJQ,EAILA,QAJK,CAII,CAJJ,EAIOG,IAJjB;AAKD,SAND,CAME,OAAOC,EAAP,EAAW,CAAG;AAChB,YAAI;AACFd,eAAKY,KAAL,GAAaT,SAASC,oBAAT,CACX,OADW,EAEXH,SAASS,QAFE,EAGX,KAHW,EAIX,CAJW,EAIRA,QAJQ,CAIC,CAJD,EAIIG,IAJjB;AAKD,SAND,CAME,OAAOC,EAAP,EAAW,CAAG;AAChB,YAAI;AACFd,eAAKe,IAAL,GAAYZ,SAASC,oBAAT,CACV,MADU,EAEVH,SAASS,QAFC,EAGV,KAHU,EAIV,CAJU,EAIPgB,UAJO,CAIIC,IAJJ,CAIStB,KAJrB;AAKD,SAND,CAME,OAAOS,EAAP,EAAW,CAAG;AAChB,YAAI;AACFd,eAAKgB,WAAL,GAAmBb,SAASC,oBAAT,CACjB,UADiB,EAEjBH,SAASS,QAFQ,EAGjB,KAHiB,EAIjB,CAJiB,EAIdA,QAJc,CAIL,CAJK,EAIFG,IAJjB;AAKD,SAND,CAME,OAAOC,EAAP,EAAW,CAAG;AAChB,YAAI;AACFd,eAAKiB,OAAL,GAAe,IAAIC,IAAJ,CACbf,SAASC,oBAAT,CACE,SADF,EAEEH,SAASS,QAFX,EAGE,KAHF,EAIE,CAJF,EAIKA,QAJL,CAIc,CAJd,EAIiBG,IALJ,CAAf;AAOD,SARD,CAQE,OAAOC,EAAP,EAAW,CAAG;AAChB,YAAI;AACFd,eAAKmB,MAAL,GAAchB,SAASC,oBAAT,CACZ,OADY,EAEZH,SAASS,QAFG,EAGZ,IAHY,EAIZ,CAJY,EAITA,QAJS,CAIA,CAJA,EAIGG,IAJjB;AAKD,SAND,CAME,OAAOC,EAAP,EAAW,CAAG;AAChBd,aAAKoB,KAAL,GAAa,EAAb;AACAjB,iBAASC,oBAAT,CAA8B,OAA9B,EAAuCH,SAASS,QAAhD,EAA0DtB,OAA1D,CACE,UAAUiC,IAAV,EAAgBC,KAAhB,EAAuBC,IAAvB,EAA6B;AAC3B,cAAIC,QAAQ,EAAZ;AACA,cAAI;AACFA,kBAAMb,EAAN,GAAWR,SAASC,oBAAT,CACT,IADS,EAETiB,KAAKX,QAFI,EAGT,KAHS,EAIT,CAJS,EAINA,QAJM,CAIG,CAJH,EAIMG,IAJjB;AAKD,WAND,CAME,OAAOC,EAAP,EAAW,CAAG;AAChB,cAAI;AACFU,kBAAMZ,KAAN,GAAcT,SAASC,oBAAT,CACZ,OADY,EAEZiB,KAAKX,QAFO,EAGZ,KAHY,EAIZ,CAJY,EAITA,QAJS,CAIA,CAJA,EAIGG,IAJjB;AAKD,WAND,CAME,OAAOC,EAAP,EAAW,CAAG;AAChB,cAAI;AACFU,kBAAMT,IAAN,GAAaZ,SAASC,oBAAT,CACX,MADW,EAEXiB,KAAKX,QAFM,EAGX,KAHW,EAIX,CAJW,EAIRgB,UAJQ,CAIGC,IAJH,CAIQtB,KAJrB;AAKD,WAND,CAME,OAAOS,EAAP,EAAW,CAAG;AAChB,cAAI;AACFU,kBAAMR,WAAN,GAAoBb,SAASC,oBAAT,CAClB,SADkB,EAElBiB,KAAKX,QAFa,EAGlB,KAHkB,EAIlB,CAJkB,EAIfA,QAJe,CAIN,CAJM,EAIHG,IAJjB;AAKD,WAND,CAME,OAAOC,EAAP,EAAW,CAAG;AAChB,cAAI;AACFU,kBAAMC,OAAN,GAAgB,IAAIP,IAAJ,CACdf,SAASC,oBAAT,CACE,SADF,EAEEiB,KAAKX,QAFP,EAGE,KAHF,EAIE,CAJF,EAIKA,QAJL,CAIc,CAJd,EAIiBG,IALH,CAAhB;AAOD,WARD,CAQE,OAAOC,EAAP,EAAW,CAAG;AAChBd,eAAKoB,KAAL,CAAW9B,IAAX,CAAgBkC,KAAhB;AACD,SAzCH;AA2CD;;AAED,WAAKlB,GAAL,GAAWN,IAAX;AACD;AACDT,eAAWpB,MAAX,CAAkBD,SAAlB,CAA4B4B,IAA5B,CAAiCL,IAAjC,CAAsC,IAAtC;AACD,GAnMD;;AAqMA,MAAIU,WAAW;AACbyB,mBAAe,SAASC,sBAAT,CAAgCC,MAAhC,EAAwCJ,UAAxC,EAAoD;AACjE,WAAK,IAAIK,IAAI,CAAb,EAAgBA,IAAIL,WAAWnB,MAA/B,EAAuCwB,GAAvC,EAA4C;AAC1C,YAAID,OAAOJ,WAAWK,CAAX,EAAclB,IAArB,CAAJ,EAAgC,OAAO,IAAP;AACjC;AACD,aAAO,KAAP;AACD,KANY;AAObmB,iBAAa,SAASC,oBAAT,CAA8BC,OAA9B,EAAuCC,OAAvC,EAAgD;AAC3D,UAAI,CAACA,OAAL,EAAc;AACZ,eAAO,KAAP;AACD;;AAED,WAAK,IAAIC,GAAT,IAAgBF,OAAhB,EAAyB;AACvB,YAAI,CAACA,QAAQG,cAAR,CAAuBD,GAAvB,CAAL,EAAkC;AAChC;AACD;AACD,YAAIA,OAAO,UAAX,EAAuB;AACrB,cAAID,QAAQ1B,IAAR,KAAiBpC,KAAKG,GAA1B,EAA+B;AAC7B,mBAAO,KAAP;AACD;AACD,cAAI,CAAC0D,QAAQ,UAAR,EAAoBC,QAAQ3B,IAA5B,CAAL,EAAwC;AACtC,mBAAO,KAAP;AACD;AACF,SAPD,MAOO,IAAI4B,OAAO,UAAX,EAAuB;AAC5B,cAAI,CAACF,QAAQ,UAAR,EAAoBC,QAAQ1B,IAA5B,CAAL,EAAwC;AACtC,mBAAO,KAAP;AACD;AACF,SAJM,MAIA,IAAI2B,OAAO,cAAX,EAA2B;AAChC,cACED,QAAQ1B,IAAR,KAAiBpC,KAAKC,IAAtB,IACA6D,QAAQ1B,IAAR,KAAiBpC,KAAKO,OADtB,IAEAuD,QAAQ1B,IAAR,KAAiBpC,KAAKK,KAHxB,EAIE;AACA,mBAAO,KAAP;AACD;AACD,cAAI,CAACwD,QAAQ,cAAR,EAAwBC,QAAQtB,IAAhC,CAAL,EAA4C;AAC1C,mBAAO,KAAP;AACD;AACF,SAXM,MAWA;AACL;AACA,cACE,CAACsB,QAAQT,UAAT,IACA,CAACS,QAAQT,UAAR,CAAmBU,GAAnB,CADD,IAEA,CAACjC,SAASyB,aAAT,CAAuBM,QAAQE,GAAR,CAAvB,EAAqCD,QAAQT,UAAR,CAAmBU,GAAnB,CAArC,CAHH,EAIE;AACA,mBAAO,KAAP;AACD;AACF;AACF;;AAED,aAAO,IAAP;AACD,KAnDY;;AAqDbE,iBAAa,SAASC,oBAAT,CACXL,OADW,EAEXM,cAFW,EAGXC,OAHW,EAIXC,KAJW,EAKX;;AAEAC,+BAAyB,gCAASC,KAAT,EAAgB,CAAE,CAA3C;AACAH,gBAAUA,YAAYI,SAAZ,IAAyBJ,YAAY,IAArC,IAA6C,CAAC,CAACA,OAAzD;AACAC,cAAQI,MAAMC,SAASL,KAAT,CAAN,IAAyB,CAAC,CAA1B,GAA8BK,SAASL,KAAT,CAAtC;;AAEA,UAAIxC,QAAQ,EAAZ;AACA,UAAI8C,WAAJ;AACAL,6BAAuBzC,KAAvB;;AAEA,UAAI,CAACsC,cAAL,EAAqB;AACnB,eAAOtC,KAAP;AACD;;AAED,eAAS+C,OAAT,CAAiBC,QAAjB,EAA2B;AACzB,eAAO,UAAU7C,KAAV,EAAiB;AACtB,iBAAOA,SAAS6C,QAAhB;AACD,SAFD;AAGD;AACD,WAAK,IAAId,GAAT,IAAgBF,OAAhB,EAAyB;AACvB,YAAI,OAAOA,QAAQE,GAAR,CAAP,IAAuB,UAA3B,EAAuC;AACrCF,kBAAQE,GAAR,IAAea,QAAQf,QAAQE,GAAR,CAAR,CAAf;AACD;AACF;;AAED,UAAIjC,SAAS6B,WAAT,CAAqBE,OAArB,EAA8BM,cAA9B,CAAJ,EAAmD;AACjDtC,cAAMZ,IAAN,CAAWkD,cAAX;AACD;;AAED,UAAIE,SAAS,CAAT,IAAcxC,MAAMK,MAAN,IAAgBmC,KAAlC,EAAyC;AACvC,eAAOxC,KAAP;AACD;;AAED,UAAIuC,WAAWD,eAAe9B,QAA9B,EAAwC;AACtCsC,sBAAcR,eAAe9B,QAA7B;AACD,OAFD,MAEO,IAAI8B,0BAA0BW,KAA9B,EAAqC;AAC1CH,sBAAcR,cAAd;AACD,OAFM,MAEA;AACL,eAAOtC,KAAP;AACD;;AAED,WAAK,IAAI6B,IAAI,CAAb,EAAgBA,IAAIiB,YAAYzC,MAAhC,EAAwCwB,GAAxC,EAA6C;AAC3C7B,gBAAQA,MAAMkD,MAAN,CACNjD,SAASmC,WAAT,CAAqBJ,OAArB,EAA8Bc,YAAYjB,CAAZ,CAA9B,EAA8CU,OAA9C,EAAuDC,KAAvD,CADM,CAAR;AAGA,YAAIA,SAAS,CAAT,IAAcxC,MAAMK,MAAN,IAAgBmC,KAAlC,EAAyC;AACvC;AACD;AACF;;AAED,aAAOxC,KAAP;AACD,KA7GY;;AA+GbmD,oBAAgB,SAASC,uBAAT,CACd3C,EADc,EAEd6B,cAFc,EAGdC,OAHc,EAId;AACA,UAAIc,SAASpD,SAASmC,WAAT,CAAqB,EAAE3B,IAAIA,EAAN,EAArB,EAAiC6B,cAAjC,EAAiDC,OAAjD,EAA0D,CAA1D,CAAb;AACA,aAAOc,OAAOhD,MAAP,GAAgBgD,OAAO,CAAP,CAAhB,GAA4B,IAAnC;AACD,KAtHY;;AAwHbnD,0BAAsB,SAASoD,6BAAT,CACpBhD,IADoB,EAEpBgC,cAFoB,EAGpBC,OAHoB,EAIpBC,KAJoB,EAKpB;AACA,aAAOvC,SAASmC,WAAT,CACL,EAAEmB,UAAUjD,IAAZ,EADK,EAELgC,cAFK,EAGLC,OAHK,EAILC,KAJK,CAAP;AAMD,KApIY;;AAsIbgB,0BAAsB,SAASC,6BAAT,CACpBlD,IADoB,EAEpB+B,cAFoB,EAGpBC,OAHoB,EAIpBC,KAJoB,EAKpB;AACA,aAAOvC,SAASmC,WAAT,CACL,EAAEsB,UAAUnD,IAAZ,EADK,EAEL+B,cAFK,EAGLC,OAHK,EAILC,KAJK,CAAP;AAMD,KAlJY;AAmJbmB,iBAAa,SAASC,oBAAT,CAA8B3B,OAA9B,EAAuCK,cAAvC,EAAuD;AAClE,WAAK,IAAIT,IAAI,CAAb,EAAgBA,IAAIS,eAAe9B,QAAf,CAAwBH,MAA5C,EAAoDwB,GAApD,EAAyD;AACvD,YAAII,YAAYK,eAAe9B,QAAf,CAAwBqB,CAAxB,CAAhB,EAA4C;AAC1CS,yBAAe9B,QAAf,CAAwBqD,MAAxB,CAA+BhC,CAA/B,EAAkC,CAAlC,EAD0C,CACL;AACtC;AACF;AACF,KAzJY;AA0JbiC,oBAAgB,SAASC,uBAAT,CAAiCzB,cAAjC,EAAiD;AAC/DA,qBAAe9B,QAAf,GAA0B,EAA1B;AACD;AA5JY,GAAf;;AA+JA,WAASwD,QAAT,CAAkBrD,IAAlB,EAAwBqB,OAAxB,EAAiC;AAC/B,QAAIiC,UAAU,IAAIC,WAAJ,CAAgBlC,OAAhB,CAAd;AACA,QAAImC,MAAJ,CAAWF,OAAX,EAAoBjC,OAApB,EAA6BoC,aAA7B,CAA2CzD,IAA3C;;AAEA,QAAI0D,aAAa,IAAIC,OAAJ,CAAY,WAAZ,EAAyB3D,IAAzB,CAAjB;AACA0D,eAAWE,UAAX,GAAwB,EAAxB;AACAF,eAAW7D,QAAX,GAAsByD,QAAQ7D,GAAR,IAAe,EAArC;AACA,WAAOiE,UAAP;AACA;AACD;;AAED;;;;;;;;;;AAeF;;MAEaF,M,WAAAA,M;AACT,oBAAYK,OAAZ,EAAqBxC,OAArB,EAA8B;AAAA;;AAC5B;AACA,WAAKyC,QAAL,GAAgB,IAAhB;;AAEA,WAAKC,QAAL,GAAgB1C,UAAUA,OAAV,GAAoB,EAApC;AACA;AACA;AACA;;AAEA,WAAK2C,gBAAL,GAAwB,UAASH,OAAT,EAAkB;AACxC,YAAI,QAAOA,OAAP,yCAAOA,OAAP,MAAkB,QAAtB,EAAgC;AAC9B,gBAAM,IAAII,KAAJ,CAAU,0BAAV,CAAN;AACD;AACD,YAAI,OAAOJ,QAAQK,KAAf,IAAwB,UAA5B,EAAwC;AACtC,gBAAM,IAAID,KAAJ,CAAU,mCAAV,CAAN;AACD;AACD,YAAI,OAAOJ,QAAQ5E,IAAf,IAAuB,UAA3B,EAAuC;AACrC,gBAAM,IAAIgF,KAAJ,CAAU,kCAAV,CAAN;AACD;AACD,YAAI,OAAOJ,QAAQM,KAAf,IAAwB,UAA5B,EAAwC;AACtC,gBAAM,IAAIF,KAAJ,CAAU,mCAAV,CAAN;AACD;AACD,YAAI,OAAOJ,QAAQO,KAAf,IAAwB,UAA5B,EAAwC;AACtC,gBAAM,IAAIH,KAAJ,CAAU,mCAAV,CAAN;AACD;AACF,OAhBD;;AAkBA,WAAKD,gBAAL,CAAsBH,OAAtB;AACA,UAAIQ,OAAO,IAAX;AACA,WAAKC,QAAL,GAAgBT,OAAhB;;AAGA,WAAKK,KAAL,GAAW,YAAW;AACpB,aAAKK,MAAL,GAAc;AACZC,gBAAMhH,KAAKC,IADC;AAEZgH,oBAAUjH,KAAKC,IAFH;AAGZiH,eAAK,CAHO;AAIZ1E,gBAAM,IAJM;AAKZ2E,uBAAa,IALD;AAMZC,wBAAc,IANF;AAOZC,mBAAS,IAPG;AAQZC,oBAAU,KARE;AASZC,oBAAU,KATE;AAUZC,kBAAQ,EAVI;AAWZ/F,gBAAM,KAXM;AAYZgG,0BAAgB,GAZJ;AAaZC,yBAAe;AACf;AACA;AAfY,SAAd;AAiBA,aAAKZ,QAAL,CAAcJ,KAAd;AACD,OAnBD;;AAqBA,WAAKA,KAAL;;AAEA,UAAIiB,YAAY,IAAIC,SAAJ,CAAc,IAAd,CAAhB;AACA,WAAKC,UAAL,GAAkB,UAACC,KAAD;AAAA,eAAWH,UAAUE,UAAV,CAAqBC,KAArB,CAAX;AAAA,OAAlB;AACA,UAAIC,cAAc,IAAIC,WAAJ,CAAgB,IAAhB,CAAlB;AACA,WAAKC,YAAL,GAAoB,UAACH,KAAD;AAAA,eAAWC,YAAYE,YAAZ,CAAyBH,KAAzB,CAAX;AAAA,OAApB;AACA,UAAII,WAAW,IAAIC,QAAJ,CAAa,IAAb,CAAf;AACA,WAAKC,SAAL,GAAiB,UAACN,KAAD;AAAA,eAAWI,SAASE,SAAT,CAAmBN,KAAnB,CAAX;AAAA,OAAjB;AACA,UAAIO,YAAY,IAAIC,SAAJ,CAAc,IAAd,CAAhB;AACA,WAAKC,UAAL,GAAkB,UAACT,KAAD;AAAA,eAAWO,UAAUE,UAAV,CAAqBT,KAArB,CAAX;AAAA,OAAlB;AACA,UAAIU,aAAa,IAAIC,UAAJ,CAAe,IAAf,CAAjB;AACA,WAAKC,WAAL,GAAmB,UAACZ,KAAD;AAAA,eAAWU,WAAWE,WAAX,CAAuBZ,KAAvB,CAAX;AAAA,OAAnB;AACA,UAAIa,eAAe,IAAIC,YAAJ,CAAiB,IAAjB,CAAnB;AACA,WAAKC,aAAL,GAAqB,UAACf,KAAD;AAAA,eAAWa,aAAaE,aAAb,CAA2Bf,KAA3B,CAAX;AAAA,OAArB;AACA,UAAIgB,eAAe,IAAIC,YAAJ,CAAiB,IAAjB,CAAnB;AACA,WAAKC,aAAL,GAAqB,UAAClB,KAAD;AAAA,eAAWgB,aAAaE,aAAb,CAA2BlB,KAA3B,CAAX;AAAA,OAArB;AAED;AACD;;;;;4BACMtF,I,EAAM;AACV,YAAIA,gBAAgByG,MAApB,EAA4B;AAC1BzG,iBAAOA,KAAK0G,QAAL,EAAP;AACD;AACD,aAAKC,UAAL,CAAgB3G,IAAhB;AACD;;;0BACGA,I,EAAM;AACR,YAAI4G,UAAUlH,MAAd,EAAsB;AACpB,eAAKyE,KAAL,CAAWnE,IAAX;AACD;AACD,aAAK8D,QAAL,GAAgB,KAAhB;AACA,aAAK7E,IAAL;AACD;;;gCACS;AACR,aAAK6E,QAAL,GAAgB,KAAhB;AACD;;;iCAEU+C,K,EAAO;AAChB,aAAKtC,MAAL,CAAYQ,QAAZ,GAAuB,KAAvB;AACA,aAAKR,MAAL,CAAYvE,IAAZ,GACE,KAAKuE,MAAL,CAAYvE,IAAZ,KAAqB,IAArB,GACI,KAAKuE,MAAL,CAAYvE,IAAZ,CAAiB8G,MAAjB,CAAwB,KAAKpC,GAA7B,IAAoCmC,KADxC,GAEIA,KAHN;AAIA,eACE,KAAKtC,MAAL,CAAYG,GAAZ,GAAkB,KAAKH,MAAL,CAAYvE,IAAZ,CAAiBN,MAAnC,IACA,CAAC,KAAK6E,MAAL,CAAYQ,QAFf,EAGE;AACA,eAAKgC,MAAL,CAAY,KAAKxC,MAAjB;AACD;AACF;;;oCACavE,I,EAAM;AAClB,YAAI,CAACA,IAAL,EAAW;AACX,aAAKkE,KAAL;AACAlG,gBAAQO,OAAR,CAAgB,UAASC,OAAT,EAAkB;AAChCwB,iBAAOA,KACJgH,OADI,CACI,IAAIC,MAAJ,CAAWzI,QAAQN,IAAnB,EAAyB,GAAzB,CADJ,EACmCM,QAAQJ,QAD3C,EAEJ4I,OAFI,CAEI,IAAIC,MAAJ,CAAWzI,QAAQL,KAAnB,EAA0B,GAA1B,CAFJ,EAEoCK,QAAQH,SAF5C,CAAP;AAGD,SAJD,EAIG,IAJH;AAKA,aAAKsI,UAAL,CAAgB3G,IAAhB;AACA,aAAKf,IAAL;AACD;;;6BACM;AACL,aAAKsF,MAAL,CAAYtF,IAAZ,GAAmB,IAAnB;AACA,aAAK8H,MAAL,CAAY,KAAKxC,MAAjB;AACA,aAAK2C,WAAL;AACA,aAAK5C,QAAL,CAAcrF,IAAd;AACD;;AAED;;;;+BACS;AACP,gBAAQ,KAAKsF,MAAL,CAAYC,IAApB;AACE,eAAKhH,KAAKC,IAAV;AACE,mBAAO,KAAK4H,UAAL,CAAgB,KAAKd,MAArB,CAAP;AACF,eAAK/G,KAAKE,MAAV;AACE,mBAAO,KAAK+H,YAAL,CAAkB,KAAKlB,MAAvB,CAAP;AACF,eAAK/G,KAAKG,GAAV;AACE,mBAAO,KAAKiI,SAAL,CAAe,KAAKrB,MAApB,CAAP;AACF,eAAK/G,KAAKI,IAAV;AACE,mBAAO,KAAKmI,UAAL,CAAgB,KAAKxB,MAArB,CAAP;AACF,eAAK/G,KAAKK,KAAV;AACE,mBAAO,KAAKqI,WAAL,CAAiB,KAAK3B,MAAtB,CAAP;AACF,eAAK/G,KAAKM,OAAV;AACE,mBAAO,KAAKuI,aAAL,CAAmB,KAAK9B,MAAxB,CAAP;AACF,eAAK/G,KAAKO,OAAV;AACE,mBAAO,KAAKyI,aAAL,CAAmB,KAAKjC,MAAxB,CAAP;AAdJ;AAgBD;;;oCACa4C,I,EAAM;AAClB,YAAI,CAAC,KAAK5C,MAAL,CAAYK,YAAjB,EAA+B;AAC7B,eAAKL,MAAL,CAAYK,YAAZ,GAA2B,EAA3B;AACD;AACD,aAAKL,MAAL,CAAYK,YAAZ,CAAyBnG,IAAzB,CAA8B0I,IAA9B;AACD;;;oCACa;AACZ,YAAI,KAAK5C,MAAL,CAAYK,YAAhB,EAA8B;AAC5B,eAAK,IAAI1D,IAAI,CAAR,EAAWkG,MAAM,KAAK7C,MAAL,CAAYK,YAAZ,CAAyBlF,MAA/C,EAAuDwB,IAAIkG,GAA3D,EAAgElG,GAAhE,EAAqE;AACnE,gBAAIiG,OAAO,KAAK5C,MAAL,CAAYK,YAAZ,CAAyB1D,CAAzB,CAAX;AACA,iBAAKoD,QAAL,CAAcH,KAAd,CAAoBgD,IAApB;AACD;AACD,eAAK5C,MAAL,CAAYK,YAAZ,GAA2B,IAA3B;AACD;AACF;;;6BACMuC,I,EAAM;AACX,aAAKD,WAAL;AACA,aAAK5C,QAAL,CAAcH,KAAd,CAAoBgD,IAApB;AACD;;;;;;MAIQ/B,S,WAAAA,S;AACT,uBAAYiC,MAAZ,EAAoB;AAAA;;AAClB,WAAKA,MAAL,GAAcA,MAAd;AACA,WAAKC,qBAAL,GAA6B,IAAIL,MAAJ,CAAW,UAAU3I,SAASiJ,IAAT,CAAc,EAAd,CAAV,GAA8B,IAAzC,EAA+C,GAA/C,CAA7B;AACA,WAAKC,yBAAL,GAAiC,yBAAjC;AACD;;;;iCAEUlC,K,EAAM;AACf,YAAImC,WAAWjK,KAAKG,GAApB;AACA,YAAI+J,QAAJ;AACA,YAAIpC,MAAMR,QAAV,EAAoB;AAClB,eAAK0C,yBAAL,CAA+BG,SAA/B,GAA2CrC,MAAMZ,GAAjD;AACAgD,qBAAW,KAAKF,yBAAL,CAA+BI,IAA/B,CAAoCtC,MAAMtF,IAA1C,CAAX;AACA0H,qBAAWA,WAAWA,SAASjH,KAApB,GAA4B,CAAC,CAAxC;AACD,SAJD,MAIO;AACL,eAAK6G,qBAAL,CAA2BK,SAA3B,GAAuCrC,MAAMZ,GAA7C;AACA,cAAImD,QAAQ,KAAKP,qBAAL,CAA2BM,IAA3B,CAAgCtC,MAAMtF,IAAtC,CAAZ;AACA,cAAI6H,KAAJ,EAAW;AACT,gBAAIA,MAAM,CAAN,KAAY,GAAhB,EAAqB;AACnBJ,yBAAWjK,KAAKG,GAAhB;AACA+J,yBAAWG,MAAMpH,KAAjB;AACD,aAHD,MAGO;AACLzC,sBAAQO,OAAR,CAAgB,UAASC,OAAT,EAAkB;AAChC,oBAAIqJ,MAAM,CAAN,KAAYrJ,QAAQJ,QAAxB,EAAkC;AAChCqJ,6BAAWjK,KAAKE,MAAhB;AACA4H,wBAAMb,QAAN,GAAiBjH,KAAKC,IAAtB;AACAiK,6BAAWG,MAAMpH,KAAjB;AACA6E,wBAAMJ,aAAN,GAAsB1G,OAAtB;AACD;AACF,eAPD,EAOG,KAAK6I,MAPR;AAQD;AACF,WAdD,MAcO;AACLI,uBAAWjK,KAAKG,GAAhB;AACA+J,uBAAW,CAAC,CAAZ;AACD;AACF;AACD,YAAII,OACFJ,aAAa,CAAC,CAAd,GACIpC,MAAMtF,IAAN,CAAW+H,SAAX,CAAqBzC,MAAMZ,GAA3B,EAAgCY,MAAMtF,IAAN,CAAWN,MAA3C,CADJ,GAEI4F,MAAMtF,IAAN,CAAW+H,SAAX,CAAqBzC,MAAMZ,GAA3B,EAAgCgD,QAAhC,CAHN;AAIA,YAAIA,WAAW,CAAX,IAAgBpC,MAAMrG,IAA1B,EAAgC;AAC9ByI,qBAAWpC,MAAMtF,IAAN,CAAWN,MAAtB;AACD;AACD,YAAIgI,WAAW,CAAf,EAAkB;AAChB,cAAIpC,MAAMR,QAAV,EAAoB;AAClBQ,kBAAMP,QAAN,GAAiB,IAAjB;AACA;AACD;AACD,cAAI,CAACO,MAAMX,WAAX,EAAwB;AACtBW,kBAAMX,WAAN,GAAoB,EAApB;AACD;AACDW,gBAAMX,WAAN,CAAkBlG,IAAlB,CACE6G,MAAMtF,IAAN,CAAW+H,SAAX,CAAqBzC,MAAMZ,GAA3B,EAAgCY,MAAMtF,IAAN,CAAWN,MAA3C,CADF;AAGA4F,gBAAMZ,GAAN,GAAYY,MAAMtF,IAAN,CAAWN,MAAvB;AACD,SAZD,MAYO;AACL,cAAI4F,MAAMX,WAAV,EAAuB;AACrBW,kBAAMX,WAAN,CAAkBlG,IAAlB,CAAuB6G,MAAMtF,IAAN,CAAW+H,SAAX,CAAqBzC,MAAMZ,GAA3B,EAAgCgD,QAAhC,CAAvB;AACAI,mBAAOxC,MAAMX,WAAN,CAAkB4C,IAAlB,CAAuB,EAAvB,CAAP;AACAjC,kBAAMX,WAAN,GAAoB,IAApB;AACD,WAJD,MAIO;AACLmD,mBAAOxC,MAAMtF,IAAN,CAAW+H,SAAX,CAAqBzC,MAAMZ,GAA3B,EAAgCgD,QAAhC,CAAP;AACD;AACD,cAAII,SAAS,EAAb,EAAiB;AACf,iBAAKT,MAAL,CAAYW,MAAZ,CAAmB,EAAEpI,MAAMpC,KAAKC,IAAb,EAAmBuC,MAAM8H,IAAzB,EAAnB;AACD;AACDxC,gBAAMZ,GAAN,GAAYgD,WAAW,CAAvB;AACApC,gBAAMd,IAAN,GAAaiD,QAAb;AACD;AACF;;;;;;MAGQjC,W,WAAAA,W;AACT,yBAAY6B,MAAZ,EAAoB;AAAA;;AAClB,WAAKA,MAAL,GAAcA,MAAd;AACA,WAAKY,cAAL,GAAsB,6CAAtB;AACD;;;;mCACY3C,K,EAAM;AACjB,YAAI2C,iBACF,uBACA3C,MAAMJ,aAAN,CAAoB7G,SADpB,GAEA,uBAFA,GAGAiH,MAAMJ,aAAN,CAAoB7G,SAHpB,GAIA,MAJA,GAKAiH,MAAMJ,aAAN,CAAoB7G,SANtB;AAOA,aAAK4J,cAAL,GAAsB,IAAIhB,MAAJ,CAAWgB,cAAX,EAA2B,GAA3B,CAAtB;;AAEA,aAAKA,cAAL,CAAoBN,SAApB,GAAgCrC,MAAMZ,GAAtC;AACA,YAAImD,QAAQ,KAAKI,cAAL,CAAoBL,IAApB,CAAyBtC,MAAMtF,IAA/B,CAAZ;AACA,YAAI6H,KAAJ,EAAW;AACTvC,gBAAMd,IAAN,GAAahH,KAAKE,MAAlB;AACA,cAAImK,MAAM,CAAN,KAAYA,MAAM,CAAN,EAASf,MAAT,CAAgB,CAAhB,EAAmB,CAAnB,MAA0B,KAA1C,EAAiD;AAC/CxB,kBAAMd,IAAN,GAAahH,KAAKO,OAAlB;AACAuH,kBAAML,cAAN,GAAuBK,MAAMJ,aAAN,CAAoB7G,SAA3C;AACAiH,kBAAMZ,GAAN,IAAa,CAAb;AACA;AACD;AACD,cAAImD,MAAM,CAAN,KAAYA,MAAM,CAAN,EAASK,MAAT,CAAgB,CAAhB,KAAsB,GAAtC,EAA2C;AACzC5C,kBAAMd,IAAN,GAAahH,KAAKO,OAAlB;AACAuH,kBAAML,cAAN,GAAuBK,MAAMJ,aAAN,CAAoB7G,SAA3C;AACAiH,kBAAMZ,GAAN,IAAa,CAAb;AACD;AACD,cAAIoD,OAAOD,MAAM,CAAN,CAAX;AACA,cAAIvC,MAAMX,WAAV,EAAuB;AACrBW,kBAAMX,WAAN,CAAkBlG,IAAlB,CAAuBqJ,IAAvB;AACAA,mBAAOxC,MAAMX,WAAN,CAAkB4C,IAAlB,CAAuB,EAAvB,CAAP;AACAjC,kBAAMX,WAAN,GAAoB,IAApB;AACD;AACD,cAAImD,SAAS,EAAb,EAAiB;AACf,iBAAKT,MAAL,CAAYW,MAAZ,CAAmB;AACjBpI,oBAAM0F,MAAMd,IADK;AAEjB7E,oBAAMkI,MAAM,CAAN,KAAYA,MAAM,CAAN,CAFD;AAGjB7H,oBAAM8H,IAHW;AAIjB7J,wBAAUqH,MAAMJ,aAAN,CAAoBjH;AAJb,aAAnB;AAMD;AACDqH,gBAAMZ,GAAN,IAAamD,MAAM,CAAN,EAASnI,MAAtB;AACA4F,gBAAMd,IAAN,GAAac,MAAMb,QAAnB;AACD,SA7BD,MA6BO;AACL;AACA;AACAa,gBAAMP,QAAN,GAAiB,IAAjB;AACD;AACJ;;;;;;MAGUY,Q,WAAAA,Q;AACT,sBAAY0B,MAAZ,EAAoB;AAAA;;AAClB,WAAKA,MAAL,GAAcA,MAAd;AACA,WAAKc,WAAL,GAAmB,qCAAnB;AACD;;;;gCACS7C,K,EAAO;AACf,aAAK6C,WAAL,CAAiBR,SAAjB,GAA6BrC,MAAMZ,GAAnC;AACA,YAAImD,QAAQ,KAAKM,WAAL,CAAiBP,IAAjB,CAAsBtC,MAAMtF,IAA5B,CAAZ;AACA,YAAI6H,KAAJ,EAAW;AACT,cAAI,CAACA,MAAM,CAAN,CAAD,IAAaA,MAAM,CAAN,EAASf,MAAT,CAAgB,CAAhB,EAAmB,CAAnB,MAA0B,KAA3C,EAAkD;AAChDxB,kBAAMd,IAAN,GAAahH,KAAKO,OAAlB;AACAuH,kBAAML,cAAN,GAAuB,GAAvB;AACAK,kBAAMZ,GAAN,IAAa,CAAb;AACA;AACD;AACD,cAAI,CAACmD,MAAM,CAAN,CAAD,IAAaA,MAAM,CAAN,EAASf,MAAT,CAAgB,CAAhB,EAAmB,CAAnB,MAA0B,UAA3C,EAAuD;AACrDxB,kBAAMd,IAAN,GAAahH,KAAKK,KAAlB;AACAyH,kBAAMZ,GAAN,IAAa,CAAb;AACA;AACD;AACD,cAAI,CAACmD,MAAM,CAAN,CAAD,IAAaA,MAAM,CAAN,EAASf,MAAT,CAAgB,CAAhB,EAAmB,CAAnB,MAA0B,UAA3C,EAAuD;AACrDxB,kBAAMd,IAAN,GAAahH,KAAKM,OAAlB;AACAwH,kBAAMZ,GAAN,IAAa,CAAb;AACA;AACD;AACD,cAAI,CAACY,MAAMrG,IAAP,IAAeqG,MAAMZ,GAAN,GAAYmD,MAAM,CAAN,EAASnI,MAArB,KAAgC4F,MAAMtF,IAAN,CAAWN,MAA9D,EAAsE;AACpE;AACA4F,kBAAMP,QAAN,GAAiB,IAAjB;AACA;AACD;AACD,cAAIqD,GAAJ;AACA,cAAIP,MAAM,CAAN,MAAa,GAAjB,EAAsB;AACpBvC,kBAAMd,IAAN,GAAahH,KAAKC,IAAlB;AACA2K,kBAAMP,MAAM,CAAN,EAASf,MAAT,CAAgB,CAAhB,EAAmBe,MAAM,CAAN,EAASnI,MAAT,GAAkB,CAArC,CAAN;AACD,WAHD,MAGO;AACL4F,kBAAMd,IAAN,GAAahH,KAAKI,IAAlB;AACAwK,kBAAMP,MAAM,CAAN,CAAN;AACD;AACDvC,gBAAMZ,GAAN,IAAamD,MAAM,CAAN,EAASnI,MAAtB;AACA,cAAI2I,MAAM,EAAEzI,MAAMpC,KAAKG,GAAb,EAAkBgC,MAAMkI,MAAM,CAAN,IAAWA,MAAM,CAAN,CAAnC,EAA6CO,KAAKA,GAAlD,EAAV;AACA,cAAI9C,MAAMd,IAAN,KAAehH,KAAKI,IAAxB,EAA8B;AAC5B0H,kBAAMT,OAAN,GAAgBwD,GAAhB;AACD;AACD,cAAIA,IAAI1I,IAAJ,CAAS2I,WAAT,OAA2B,QAA/B,EAAyC;AACvChD,kBAAMR,QAAN,GAAiB,IAAjB;AACD,WAFD,MAEO,IAAIuD,IAAI1I,IAAJ,CAAS2I,WAAT,OAA2B,SAA/B,EAA0C;AAC/ChD,kBAAMR,QAAN,GAAiB,KAAjB;AACD;AACD,cAAIuD,IAAI1I,IAAJ,CAAS2I,WAAT,OAA2B,UAA/B,EAA2C;AACzChD,kBAAMR,QAAN,GAAiB,IAAjB;AACD,WAFD,MAEO,IAAIuD,IAAI1I,IAAJ,CAAS2I,WAAT,OAA2B,WAA/B,EAA4C;AACjDhD,kBAAMR,QAAN,GAAiB,KAAjB;AACD;AACD,cAAIQ,MAAMd,IAAN,KAAehH,KAAKI,IAAxB,EAA8B;AAC5B,iBAAKyJ,MAAL,CAAYkB,aAAZ,CAA0BF,GAA1B;AACD,WAFD,MAEO;AACL,iBAAKhB,MAAL,CAAYW,MAAZ,CAAmBK,GAAnB;AACD;AACF,SAlDD,MAkDO;AACL;AACA;AACA/C,gBAAMP,QAAN,GAAiB,IAAjB;AACD;AACF;;;;;;MAIQyD,kB,WAAAA,kB;AACT,gCAAYnB,MAAZ,EAAoB;AAAA;;AAClB,WAAKA,MAAL,GAAcA,MAAd;AACA,WAAKoB,qBAAL,GAA6B,wBAA7B;AACD;;;;0CACmBnD,K,EAAO;AACzB,aAAKmD,qBAAL,CAA2Bd,SAA3B,GAAuCrC,MAAMZ,GAA7C;AACA,YAAImD,QAAQ,KAAKY,qBAAL,CAA2Bb,IAA3B,CAAgCtC,MAAMtF,IAAtC,CAAZ;AACA,YAAI,CAAC6H,KAAL,EAAY;AACV,iBAAO,IAAP;AACD;AACD,YACEvC,MAAMZ,GAAN,GAAYmD,MAAM,CAAN,EAASnI,MAArB,KACA,KAAK+I,qBAAL,CAA2Bd,SAF7B,EAGE;AACA,iBAAO,IAAP;AACD;AACD,eAAO;AACLE,iBAAOA,MAAM,CAAN,CADF;AAELlI,gBAAMkI,MAAM,CAAN;AAFD,SAAP;AAID;;;;;;MAIQa,mB,WAAAA,mB;AACT,iCAAYrB,MAAZ,EAAoB;AAAA;;AAClB,WAAKA,MAAL,GAAcA,MAAd;AACA,WAAKsB,sBAAL,GAA8B,kDAA9B;AACA,WAAKC,2BAAL,GAAmC,oBAAnC;AACD;;;;2CACoBtD,K,EAAO;AAC1B,aAAKqD,sBAAL,CAA4BhB,SAA5B,GAAwCrC,MAAMZ,GAA9C;AACA,YAAImD,QAAQ,KAAKc,sBAAL,CAA4Bf,IAA5B,CAAiCtC,MAAMtF,IAAvC,CAAZ;AACA,YAAI,CAAC6H,KAAL,EAAY;AACV,cAAI,CAACvC,MAAMrG,IAAX,EAAiB;AACf,mBAAO,IAAP;AACD;AACD,eAAK2J,2BAAL,CAAiCjB,SAAjC,GAA6CrC,MAAMZ,GAAnD;AACAmD,kBAAQ,KAAKe,2BAAL,CAAiChB,IAAjC,CAAsCtC,MAAMtF,IAA5C,CAAR;AACA,cAAI,CAAC6H,KAAL,EAAY;AACV,mBAAO,IAAP;AACD;AACD,iBAAO;AACLA,mBAAOA,MAAM,CAAN,CADF;AAELrI,mBAAOqI,MAAM,CAAN,MAAa,EAAb,GAAkBA,MAAM,CAAN,CAAlB,GAA6B;AAF/B,WAAP;AAID;AACD,YACEvC,MAAMZ,GAAN,GAAYmD,MAAM,CAAN,EAASnI,MAArB,KACA,KAAKiJ,sBAAL,CAA4BhB,SAF9B,EAGE;AACA,iBAAO,IAAP;AACD;AACD,eAAO;AACLE,iBAAOA,MAAM,CAAN,CADF;AAELrI,iBAAOqI,MAAM,CAAN,KAAYA,MAAM,CAAN,CAAZ,IAAwBA,MAAM,CAAN;AAF1B,SAAP;AAID;;;;;;MAGQ/B,S,WAAAA,S;AACT,uBAAYuB,MAAZ,EAAoB;AAAA;;AAClB,WAAKA,MAAL,GAAcA,MAAd;AACA,WAAKwB,uBAAL,GAA+B,gBAA/B;AACA,WAAKC,sBAAL,GAA8B,iBAA9B;AACA,WAAKC,kBAAL,GAA0B,IAAIP,kBAAJ,CAAuBnB,MAAvB,CAA1B;AACA,WAAK2B,mBAAL,GAA2B,IAAIN,mBAAJ,CAAwBrB,MAAxB,CAA3B;AACD;;;;iCACU/B,K,EAAO;AAChB,YAAI2D,YAAY,KAAKF,kBAAL,CAAwBG,mBAAxB,CAA4C5D,KAA5C,CAAhB;AACA,YAAI,CAAC2D,SAAD,IAAcA,UAAUtJ,IAAV,KAAmB,GAArC,EAA0C;AACxC,eAAKmJ,sBAAL,CAA4BnB,SAA5B,GAAwCrC,MAAMZ,GAA9C;AACA,cAAIyE,qBAAqB,KAAKL,sBAAL,CAA4BlB,IAA5B,CAAiCtC,MAAMtF,IAAvC,CAAzB;AACA,cAAImJ,sBAAsBA,mBAAmB1I,KAAnB,KAA6B6E,MAAMZ,GAA7D,EAAkE;AAChE,gBACE,CAACY,MAAMrG,IAAP,IACA,CAACkK,mBAAmB,CAAnB,CADD,IAEA7D,MAAMZ,GAAN,GAAYyE,mBAAmB,CAAnB,EAAsBzJ,MAAlC,KAA6C4F,MAAMtF,IAAN,CAAWN,MAH1D,EAIE;AACA4F,oBAAMP,QAAN,GAAiB,IAAjB;AACA;AACD;AACDO,kBAAMT,OAAN,CAAcuD,GAAd,IAAqBe,mBAAmB,CAAnB,CAArB;AACA;AACA,iBAAK9B,MAAL,CAAYW,MAAZ,CAAmB;AACjBpI,oBAAMpC,KAAKG,GADM;AAEjBgC,oBAAM,MAAM2F,MAAMT,OAAN,CAAclF,IAFT;AAGjByI,mBAAK;AAHY,aAAnB;AAKA9C,kBAAMZ,GAAN,IAAayE,mBAAmB,CAAnB,EAAsBzJ,MAAnC;AACD;AACD,cAAIgI,WAAWpC,MAAMtF,IAAN,CAAWoJ,OAAX,CAAmB,GAAnB,EAAwB9D,MAAMZ,GAA9B,CAAf;AACA,cAAIgD,WAAW,CAAf,EAAkB;AAChB,gBAAIpC,MAAMrG,IAAV,EAAgB;AACd;AACAqG,oBAAMT,OAAN,CAAcuD,GAAd,IAAqB9C,MAAMtF,IAAN,CAAW8G,MAAX,CAAkBxB,MAAMZ,GAAxB,CAArB;AACAY,oBAAMZ,GAAN,GAAYY,MAAMtF,IAAN,CAAWN,MAAvB;AACA;AACD;AACD4F,kBAAMP,QAAN,GAAiB,IAAjB;AACD,WARD,MAQO;AACL;AACAO,kBAAMZ,GAAN,GAAYgD,WAAW,CAAvB;AACApC,kBAAMd,IAAN,GAAahH,KAAKC,IAAlB;AACD;AACD;AACD;AACD,YACE,CAAC6H,MAAMrG,IAAP,IACAqG,MAAMZ,GAAN,GAAYuE,UAAUpB,KAAV,CAAgBnI,MAA5B,KAAuC4F,MAAMtF,IAAN,CAAWN,MAFpD,EAGE;AACA4F,gBAAMP,QAAN,GAAiB,IAAjB;AACA,iBAAO,IAAP;AACD;AACDO,cAAMZ,GAAN,IAAauE,UAAUpB,KAAV,CAAgBnI,MAA7B;AACA,YAAI2J,aAAa,KAAKL,mBAAL,CAAyBM,oBAAzB,CAA8ChE,KAA9C,CAAjB;AACA,YAAI+D,UAAJ,EAAgB;AACd,cACE,CAAC/D,MAAMrG,IAAP,IACAqG,MAAMZ,GAAN,GAAY2E,WAAWxB,KAAX,CAAiBnI,MAA7B,KAAwC4F,MAAMtF,IAAN,CAAWN,MAFrD,EAGE;AACA4F,kBAAMP,QAAN,GAAiB,IAAjB;AACAO,kBAAMZ,GAAN,IAAauE,UAAUpB,KAAV,CAAgBnI,MAA7B;AACA;AACD;AACD4F,gBAAMZ,GAAN,IAAa2E,WAAWxB,KAAX,CAAiBnI,MAA9B;AACD,SAVD,MAUO;AACL,eAAKmJ,uBAAL,CAA6BlB,SAA7B,GAAyCrC,MAAMZ,GAA/C;AACA,cAAI,KAAKmE,uBAAL,CAA6BjB,IAA7B,CAAkCtC,MAAMtF,IAAxC,CAAJ,EAAmD;AACjDsF,kBAAMP,QAAN,GAAiB,IAAjB;AACAO,kBAAMZ,GAAN,IAAauE,UAAUpB,KAAV,CAAgBnI,MAA7B;AACA;AACD;AACD2J,uBAAa;AACXxB,mBAAO,EADI;AAEXrI,mBAAO;AAFI,WAAb;AAID;AACD8F,cAAMT,OAAN,CAAcuD,GAAd,IAAqBa,UAAUpB,KAAV,GAAkBwB,WAAWxB,KAAlD;;AAEA,YAAI0B,sBAAsB,CAAC,CAA3B;AACA,YAAIvJ,OAAO,EAAX;AACA,YAAIqJ,WAAW7J,KAAf,EAAsB;AACpB,cAAI8D,UAAU,IAAIC,WAAJ,CAAgB,UAAUiG,GAAV,EAAe/J,GAAf,EAAoB,CAAG,CAAvC,EACZ,KAAK4H,MAAL,CAAY/C,QAAZ,CAAqBP,QADT,CAAd;AAEA,cAAI0F,SAAS,IAAIjG,MAAJ,CAAWF,OAAX,CAAb;AACAmG,iBAAOhG,aAAP,CAAqB4F,WAAW7J,KAAhC;AACAQ,iBAAOsD,QAAQ7D,GAAf;AACD;;AAED,aAAK4H,MAAL,CAAYkB,aAAZ,CAA0B,EAAE3I,MAAMpC,KAAKI,IAAb,EAAmB+B,MAAMsJ,UAAUtJ,IAAnC,EAAyCK,MAAMA,IAA/C,EAA1B;AACD;;;;;;MAIQiG,U,WAAAA,U;AACT,wBAAYoB,MAAZ,EAAoB;AAAA;;AAClB,WAAKA,MAAL,GAAcA,MAAd;AACA,WAAKqC,wBAAL,GAAgC,UAAhC;AACD;;;;kCACWpE,K,EAAO;AACjB,YAAIoC,WAAWpC,MAAMtF,IAAN,CAAWoJ,OAAX,CAAmB,KAAnB,EAA0B9D,MAAMZ,GAAhC,CAAf;AACA,YAAIgD,WAAW,CAAX,IAAgBpC,MAAMrG,IAA1B,EAAgC;AAC9ByI,qBAAWpC,MAAMtF,IAAN,CAAWN,MAAtB;AACD;AACD,YAAIgI,WAAW,CAAf,EAAkB;AAChB,eAAKgC,wBAAL,CAA8B/B,SAA9B,GAA0CrC,MAAMZ,GAAhD;AACA,cAAIiF,uBAAuB,KAAKD,wBAAL,CAA8B9B,IAA9B,CACzBtC,MAAMtF,IADmB,CAA3B;AAGA,cAAI2J,oBAAJ,EAA0B;AACxBrE,kBAAMP,QAAN,GAAiB,IAAjB;AACA;AACD;AACD,cAAI,CAACO,MAAMX,WAAX,EAAwB;AACtBW,kBAAMX,WAAN,GAAoB,EAApB;AACD;AACDW,gBAAMX,WAAN,CAAkBlG,IAAlB,CAAuB6G,MAAMtF,IAAN,CAAW8G,MAAX,CAAkBxB,MAAMZ,GAAxB,EAA6BY,MAAMtF,IAAN,CAAWN,MAAxC,CAAvB;AACA4F,gBAAMZ,GAAN,GAAYY,MAAMtF,IAAN,CAAWN,MAAvB;AACA4F,gBAAMP,QAAN,GAAiB,IAAjB;AACD,SAfD,MAeO;AACL,cAAI+C,IAAJ;AACA,cAAIxC,MAAMX,WAAV,EAAuB;AACrBW,kBAAMX,WAAN,CAAkBlG,IAAlB,CAAuB6G,MAAMtF,IAAN,CAAW+H,SAAX,CAAqBzC,MAAMZ,GAA3B,EAAgCgD,QAAhC,CAAvB;AACAI,mBAAOxC,MAAMX,WAAN,CAAkB4C,IAAlB,CAAuB,EAAvB,CAAP;AACAjC,kBAAMX,WAAN,GAAoB,IAApB;AACD,WAJD,MAIO;AACLmD,mBAAOxC,MAAMtF,IAAN,CAAW+H,SAAX,CAAqBzC,MAAMZ,GAA3B,EAAgCgD,QAAhC,CAAP;AACD;AACD,eAAKL,MAAL,CAAYW,MAAZ,CAAmB,EAAEpI,MAAMpC,KAAKK,KAAb,EAAoBmC,MAAM8H,IAA1B,EAAnB;AACAxC,gBAAMd,IAAN,GAAahH,KAAKC,IAAlB;AACA6H,gBAAMZ,GAAN,GAAYgD,WAAW,CAAvB;AACD;AACF;;;;;;MAGQtB,Y,WAAAA,Y;AACT,0BAAYiB,MAAZ,EAAoB;AAAA;;AAClB,WAAKA,MAAL,GAAcA,MAAd;AACD;;;;oCACa/B,K,EAAO;AACnB,YAAIoC,WAAWpC,MAAMtF,IAAN,CAAWoJ,OAAX,CAAmB,GAAnB,EAAwB9D,MAAMZ,GAA9B,CAAf;AACA,YAAIgD,WAAW,CAAX,IAAgBpC,MAAMrG,IAA1B,EAAgC;AAC9ByI,qBAAWpC,MAAMtF,IAAN,CAAWN,MAAtB;AACD;AACD,YAAIgI,WAAW,CAAf,EAAkB;AAChB,eAAKgC,wBAAL,CAA8B/B,SAA9B,GAA0CrC,MAAMZ,GAAhD;AACA,cAAI,CAACY,MAAMX,WAAX,EAAwB;AACtBW,kBAAMX,WAAN,GAAoB,EAApB;AACD;AACDW,gBAAMX,WAAN,CAAkBlG,IAAlB,CAAuB6G,MAAMtF,IAAN,CAAW8G,MAAX,CAAkBxB,MAAMZ,GAAxB,EAA6BY,MAAMtF,IAAN,CAAWN,MAAxC,CAAvB;AACA4F,gBAAMZ,GAAN,GAAYY,MAAMtF,IAAN,CAAWN,MAAvB;AACA4F,gBAAMP,QAAN,GAAiB,IAAjB;AACD,SARD,MAQO;AACL,cAAI+C,IAAJ;AACA,cAAIxC,MAAMX,WAAV,EAAuB;AACrBW,kBAAMX,WAAN,CAAkBlG,IAAlB,CAAuB6G,MAAMtF,IAAN,CAAW+H,SAAX,CAAqBzC,MAAMZ,GAA3B,EAAgCgD,QAAhC,CAAvB;AACAI,mBAAOxC,MAAMX,WAAN,CAAkB4C,IAAlB,CAAuB,EAAvB,CAAP;AACAjC,kBAAMX,WAAN,GAAoB,IAApB;AACD,WAJD,MAIO;AACLmD,mBAAOxC,MAAMtF,IAAN,CAAW+H,SAAX,CAAqBzC,MAAMZ,GAA3B,EAAgCgD,QAAhC,CAAP;AACD;AACD,eAAKL,MAAL,CAAYW,MAAZ,CAAmB,EAAEpI,MAAMpC,KAAKM,OAAb,EAAsBkC,MAAM8H,IAA5B,EAAnB;AACAxC,gBAAMd,IAAN,GAAahH,KAAKC,IAAlB;AACA6H,gBAAMZ,GAAN,GAAYgD,WAAW,CAAvB;AACD;AACF;;;;;;MAGQnB,Y,WAAAA,Y;AACT,0BAAYc,MAAZ,EAAoB;AAAA;;AAClB,WAAKA,MAAL,GAAcA,MAAd;AACA,WAAKuC,0BAAL,GAAkC,UAAlC;AACD;;;;oCACatE,K,EAAO;AACnB,YAAIoC,WAAWpC,MAAMtF,IAAN,CAAWoJ,OAAX,CAAmB,OAAO9D,MAAML,cAAhC,EAAgDK,MAAMZ,GAAtD,CAAf;AACA,YAAIgD,WAAW,CAAX,IAAgBpC,MAAMrG,IAA1B,EAAgC;AAC9ByI,qBAAWpC,MAAMtF,IAAN,CAAWN,MAAtB;AACD;AACD,YAAIgI,WAAW,CAAf,EAAkB;AAChB,eAAKkC,0BAAL,CAAgCjC,SAAhC,GAA4CrC,MAAMZ,GAAlD;AACA,cAAImF,yBAAyB,KAAKD,0BAAL,CAAgChC,IAAhC,CAC3BtC,MAAMtF,IADqB,CAA7B;AAGA,cAAI6J,sBAAJ,EAA4B;AAC1BvE,kBAAMP,QAAN,GAAiB,IAAjB;AACA;AACD;AACD,cAAI,CAACO,MAAMX,WAAX,EAAwB;AACtBW,kBAAMX,WAAN,GAAoB,EAApB;AACD;AACDW,gBAAMX,WAAN,CAAkBlG,IAAlB,CAAuB6G,MAAMtF,IAAN,CAAW8G,MAAX,CAAkBxB,MAAMZ,GAAxB,EAA6BY,MAAMtF,IAAN,CAAWN,MAAxC,CAAvB;AACA4F,gBAAMZ,GAAN,GAAYY,MAAMtF,IAAN,CAAWN,MAAvB;AACA4F,gBAAMP,QAAN,GAAiB,IAAjB;AACD,SAfD,MAeO;AACL,cAAI+C,IAAJ;AACA,cAAIxC,MAAMX,WAAV,EAAuB;AACrBW,kBAAMX,WAAN,CAAkBlG,IAAlB,CAAuB6G,MAAMtF,IAAN,CAAW+H,SAAX,CAAqBzC,MAAMZ,GAA3B,EAAgCgD,QAAhC,CAAvB;AACAI,mBAAOxC,MAAMX,WAAN,CAAkB4C,IAAlB,CAAuB,EAAvB,CAAP;AACAjC,kBAAMX,WAAN,GAAoB,IAApB;AACD,WAJD,MAIO;AACLmD,mBAAOxC,MAAMtF,IAAN,CAAW+H,SAAX,CAAqBzC,MAAMZ,GAA3B,EAAgCgD,QAAhC,CAAP;AACD;AACD,eAAKL,MAAL,CAAYW,MAAZ,CAAmB,EAAEpI,MAAMpC,KAAKO,OAAb,EAAsBiC,MAAM8H,IAA5B,EAAnB;AACAxC,gBAAMd,IAAN,GAAahH,KAAKC,IAAlB;AACA6H,gBAAMZ,GAAN,GAAYgD,WAAW,CAAvB;AACD;AACF;;;;;;MAIQnE,W;AACT,yBAAY5E,QAAZ,EAAsB0C,OAAtB,EAA+B;AAAA;;AAC7B;AACA,WAAK0C,QAAL,GAAgB,IAAhB,CAF6B,CAEP;AACtB,WAAK+F,SAAL,GAAiB,IAAjB,CAH6B,CAGN;AACvB,WAAKC,KAAL,GAAa,KAAb,CAJ6B,CAIT;AACpB,WAAKC,SAAL,GAAiB,IAAjB,CAL6B,CAKN;AACvB,WAAKvK,GAAL,GAAW,IAAX,CAN6B,CAMZ;;AAEjB;AACA,WAAKwK,UAAL,GAAkB;AAChBC,cAAM,CADU;AAEhBC,cAAM,CAFU;AAGhBC,kBAAU,CAHM;AAIhBC,YAAI,CAJY;AAKhBC,aAAK,CALW;AAMhBC,eAAO,CANS;AAOhBC,YAAI,CAPY;AAQhBC,aAAK,CARW;AAShBC,eAAO,CATS;AAUhBC,iBAAS,CAVO;AAWhBzK,cAAM,CAXU;AAYhB0K,cAAM,CAZU;AAahBC,eAAO,CAbS;AAchBC,eAAO,CAdS;AAehB,gBAAQ,CAfQ;AAgBhBC,aAAK;AAhBW,OAAlB;AAkBA;AACA,WAAKC,YAAL,GAAoB,OAApB;;AAEA,WAAK9G,KAAL;AACA,UAAI,OAAOvF,QAAP,IAAmB,UAAvB,EAAmC;AACjC,aAAKmL,SAAL,GAAiBnL,QAAjB;AACD,OAFD,MAEO;AACL0C,kBAAU1C,QAAV;AACD;AACD,WAAKoF,QAAL,GAAgB1C,UAAUA,OAAV,GAAoB,EAApC;AACA,UAAI,KAAK0C,QAAL,CAAclF,gBAAd,KAAmCmD,SAAvC,EAAkD;AAChD,aAAK+B,QAAL,CAAclF,gBAAd,GAAiC,KAAjC,CADgD,CACR;AACzC;AACD,UAAI,KAAKkF,QAAL,CAAckH,eAAd,KAAkCjJ,SAAtC,EAAiD;AAC/C,aAAK+B,QAAL,CAAckH,eAAd,GAAgC,KAAhC,CAD+C,CACR;AACxC;AACD,UAAI,KAAKlH,QAAL,CAAcjF,OAAd,KAA0BkD,SAA9B,EAAyC;AACvC,aAAK+B,QAAL,CAAcjF,OAAd,GAAwB,IAAxB,CADuC,CACT;AAC/B;AACD,UAAI,KAAKiF,QAAL,CAAchF,gBAAd,KAAmCiD,SAAvC,EAAkD;AAChD,aAAK+B,QAAL,CAAchF,gBAAd,GAAiC,IAAjC,CADgD,CACT;AACxC;AACD,UAAI,KAAKgF,QAAL,CAAc/E,iBAAd,KAAoCgD,SAAxC,EAAmD;AACjD,aAAK+B,QAAL,CAAc/E,iBAAd,GAAkC,KAAlC,CADiD,CACR;AAC1C;AACD,UAAI,KAAK+E,QAAL,CAAcmH,iBAAd,KAAoClJ,SAAxC,EAAmD;AACjD,aAAK+B,QAAL,CAAcmH,iBAAd,GAAkC,KAAlC,CADiD,CACR;AAC1C;AACF;AACD;;;;6CAEuBnJ,K,EAAO,CAAE;;;8BAExB;AACN,aAAKtC,GAAL,GAAW,EAAX;AACA,aAAKqC,sBAAL,CAA4B,KAAKrC,GAAjC;AACA;AACA,aAAKsK,KAAL,GAAa,KAAb;AACA,aAAKC,SAAL,GAAiB,EAAjB;AACA,aAAKmB,QAAL,GAAgB,IAAhB;AACA,aAAKnB,SAAL,CAAeoB,IAAf,GAAsB,SAASC,0BAAT,GAAsC;AAC1D,iBAAO,KAAK3L,MAAL,GAAc,KAAK,KAAKA,MAAL,GAAc,CAAnB,CAAd,GAAsC,IAA7C;AACD,SAFD;AAGA,aAAK4L,KAAL,GAAa,CAAb;AACA,aAAKC,IAAL,GAAY,CAAZ;AACD;;;6BAEM;AACL,aAAKxB,KAAL,GAAa,IAAb;AACA,aAAKyB,cAAL,CAAoB,IAApB;AACD;;;4BAEKpH,M,EAAO;AACX,aAAKoH,cAAL,CAAoBpH,MAApB;AACD;;;qCAEcA,K,EAAO;AACpB,YAAI,OAAO,KAAK0F,SAAZ,IAAyB,UAA7B,EAAyC;AACvC,cAAI1F,KAAJ,EAAW;AACT,kBAAMA,KAAN;AACD,WAFD,MAEO;AACL;AACD;AACF;AACD,aAAK0F,SAAL,CAAe1F,KAAf,EAAsB,KAAK3E,GAA3B;AACD;;;iCAEU6B,O,EAAS;AAClB,YAAI3B,OAAO2B,QAAQ3B,IAAR,CAAa2I,WAAb,EAAX;AACA,YAAI3I,KAAKuI,MAAL,CAAY,CAAZ,KAAkB,GAAtB,EAA2B;AACzB,iBAAO,IAAP;AACD;AACD,YAAIvI,KAAKuI,MAAL,CAAY,CAAZ,KAAkB,GAAtB,EAA2B;AACzBvI,iBAAOA,KAAKoI,SAAL,CAAe,CAAf,CAAP;AACD;AACD,eAAO,KAAKhE,QAAL,CAAchF,gBAAd,IAAkC,CAAC,CAAC,KAAKkL,UAAL,CAAgBtK,IAAhB,CAA3C;AACD;;;qCAEc;AACb,eAAO,EAAE8L,MAAM,KAAKH,KAAb,EAAoBhB,KAAK,KAAKiB,IAA9B,EAAP;AACD;;;sCAGepE,I,EAAM;AACpB,YAAIuE,eAAevE,KAAKvH,IAAL,KAAcpC,KAAKG,GAAnB,GAAyBwJ,KAAKiB,GAA9B,GAAoCjB,KAAKnH,IAA5D;AACA,YAAI0L,iBAAiB,IAArB,EAA2B;AACzB;AACD;AACD;AACA,YAAIC,QAAQD,aAAaE,KAAb,CAAmB,IAAnB,CAAZ;AACA,aAAKN,KAAL,IAAcK,MAAMjM,MAAN,GAAe,CAA7B;AACA,YAAIiM,MAAMjM,MAAN,GAAe,CAAnB,EAAsB;AACpB,eAAK6L,IAAL,GAAY,CAAZ;AACD;AACD,aAAKA,IAAL,IAAaI,MAAMA,MAAMjM,MAAN,GAAe,CAArB,EAAwBA,MAArC;AACA,YAAIyH,KAAKvH,IAAL,KAAcpC,KAAKG,GAAvB,EAA4B;AAC1B,eAAK4N,IAAL,IAAa,CAAb;AACD,SAFD,MAEO,IAAIpE,KAAKvH,IAAL,KAAcpC,KAAKO,OAAvB,EAAgC;AACrC,eAAKwN,IAAL,IAAa,CAAb;AACD,SAFM,MAEA,IAAIpE,KAAKvH,IAAL,KAAcpC,KAAKK,KAAvB,EAA8B;AACnC,eAAK0N,IAAL,IAAa,EAAb;AACD;AACF;;;mCAEYjK,O,EAASsC,U,EAAY;AAChC;AACA,YAAIF,aAAa,IAAIC,OAAJ,CAAYrC,QAAQ1B,IAApB,EAA0BgE,UAA1B,CAAjB;;AAEA,YAAI,KAAKG,QAAL,CAAcjF,OAAd,IAAyBwC,QAAQ,KAAR,MAAmBU,SAAhD,EAA2D;AACzD0B,qBAAW0E,GAAX,GAAiB9G,QAAQ8G,GAAzB;AACD;AACD,YAAI9G,QAAQ,MAAR,MAAoBU,SAAxB,EAAmC;AACjC,kBAAQV,QAAQ1B,IAAhB;AACE,iBAAKpC,KAAKG,GAAV;AACE+F,yBAAW/D,IAAX,GAAkB,KAAKoE,QAAL,CAAc/E,iBAAd,GACdsC,QAAQ3B,IADM,GAEd2B,QAAQ3B,IAAR,CAAa2I,WAAb,EAFJ;AAGA;;AAEF,iBAAK9K,KAAKI,IAAV;AACE8F,yBAAW/D,IAAX,GAAkB,KAAKoE,QAAL,CAAcmH,iBAAd,GACd5J,QAAQ3B,IADM,GAEd2B,QAAQ3B,IAAR,CAAa2I,WAAb,EAFJ;AAGA;;AAEF;AACE5E,yBAAW/D,IAAX,GAAkB,KAAKoE,QAAL,CAAc/E,iBAAd,GACdsC,QAAQ3B,IADM,GAEd2B,QAAQ3B,IAAR,CAAa2I,WAAb,EAFJ;AAGA;AAjBJ;AAmBD;AACD,YAAIhH,QAAQ,MAAR,MAAoBU,SAAxB,EAAmC;AACjChE,kBAAQO,OAAR,CAAgB,UAAUC,OAAV,EAAmB;AACjC8C,oBAAQtB,IAAR,GAAesB,QAAQtB,IAAR,CACZgH,OADY,CACJ,IAAIC,MAAJ,CAAWzI,QAAQJ,QAAnB,EAA6B,GAA7B,CADI,EAC+BI,QAAQN,IADvC,EAEZ8I,OAFY,CAEJ,IAAIC,MAAJ,CAAWzI,QAAQH,SAAnB,EAA8B,GAA9B,CAFI,EAEgCG,QAAQL,KAFxC,CAAf;AAGD,WAJD,EAIG,IAJH;AAKAuF,qBAAW1D,IAAX,GAAkBsB,QAAQtB,IAA1B;AACD;;AAED,YAAIsB,QAAQ,UAAR,MAAwBU,SAA5B,EAAuC;AACrC0B,qBAAWzF,QAAX,GAAsBqD,QAAQrD,QAA9B;AACD;;AAED,YAAIqD,QAAQuK,QAAZ,EAAsB;AACpBnI,qBAAWmI,QAAX,GAAsB;AACpBJ,kBAAMnK,QAAQuK,QAAR,CAAiBJ,IADH;AAEpBnB,iBAAKhJ,QAAQuK,QAAR,CAAiBvB;AAFF,WAAtB;AAID;;AAED,eAAO5G,UAAP;AACD;;;4BAEKpC,O,EAAS;AACb,YAAI,KAAKyI,KAAT,EAAgB;AACd,eAAKyB,cAAL,CACE,IAAIvH,KAAJ,CACE,6EADF,CADF;AAKD;AACD,YAAI,KAAKF,QAAL,CAAckH,eAAlB,EAAmC;AACjC,cAAI3J,QAAQ1B,IAAR,KAAiBpC,KAAKI,IAA1B,EAAgC;AAC9B0D,oBAAQuK,QAAR,GAAmB,KAAKC,YAAL,EAAnB;AACA,iBAAKC,eAAL,CAAqBzK,OAArB;AACD;AACF;AACD,YAAIA,QAAQ1B,IAAR,KAAiBpC,KAAKC,IAAtB,IAA8B,KAAKsG,QAAL,CAAclF,gBAAhD,EAAkE;AAChE,cAAI,KAAKmM,YAAL,CAAkBgB,IAAlB,CAAuB1K,QAAQtB,IAA/B,CAAJ,EAA0C;AACxC;AACD;AACF;AACD,YAAIiM,MAAJ;AACA,YAAI9E,IAAJ;AACA,YAAI,CAAC,KAAK6C,SAAL,CAAeoB,IAAf,EAAL,EAA4B;AAC1B;AACA;AACA,cAAI9J,QAAQ1B,IAAR,KAAiBpC,KAAKG,GAA1B,EAA+B;AAC7B,gBAAI2D,QAAQ3B,IAAR,CAAauI,MAAb,CAAoB,CAApB,KAA0B,GAA9B,EAAmC;AACjC;AACAf,qBAAO,KAAK+E,YAAL,CAAkB5K,OAAlB,CAAP;AACA,mBAAK7B,GAAL,CAAShB,IAAT,CAAc0I,IAAd;AACA,kBAAI,CAAC,KAAKgF,UAAL,CAAgBhF,IAAhB,CAAL,EAA4B;AAC1B;AACA,qBAAK6C,SAAL,CAAevL,IAAf,CAAoB0I,IAApB;AACD;AACD,mBAAKgE,QAAL,GAAgBhE,IAAhB;AACD;AACF,WAXD,MAWO,IAAI7F,QAAQ1B,IAAR,KAAiBpC,KAAKI,IAAtB,IAA8B,KAAKuN,QAAvC,EAAiD;AACtD,gBAAI,CAAC,KAAKA,QAAL,CAActK,UAAnB,EAA+B;AAC7B,mBAAKsK,QAAL,CAActK,UAAd,GAA2B,EAA3B;AACD;AACD,iBAAKsK,QAAL,CAActK,UAAd,CACE,KAAKkD,QAAL,CAAcmH,iBAAd,GACI5J,QAAQ3B,IADZ,GAEI2B,QAAQ3B,IAAR,CAAa2I,WAAb,EAHN,IAKEhH,QAAQtB,IALV;AAMD,WAVM,MAUA,IAAIsB,QAAQ1B,IAAR,KAAiBpC,KAAKE,MAA1B,EAAkC;AACvC,gBAAI4D,QAAQ3B,IAAR,IAAgB2B,QAAQ3B,IAAR,CAAauI,MAAb,CAAoB,CAApB,KAA0B,GAA9C,EAAmD;AACjD;AACD,aAFD,MAEO,IAAI5G,QAAQ3B,IAAR,IAAgB2B,QAAQ3B,IAAR,CAAauI,MAAb,CAAoB,CAApB,KAA0B,GAA9C,EAAmD;AACxD5G,sBAAQ3B,IAAR,GAAe,KAAKoE,QAAL,CAAc/E,iBAAd,GACXsC,QAAQ3B,IAAR,CAAaoI,SAAb,CAAuB,CAAvB,CADW,GAEXzG,QAAQ3B,IAAR,CAAaoI,SAAb,CAAuB,CAAvB,EAA0BO,WAA1B,EAFJ;AAGAnB,qBAAO,KAAK+E,YAAL,CAAkB5K,OAAlB,CAAP;AACA,mBAAK7B,GAAL,CAAShB,IAAT,CAAc0I,IAAd;AACA,mBAAKgE,QAAL,GAAgBhE,IAAhB;AACD,aAPM,MAOA,IAAI7F,QAAQ3B,IAAZ,EAAkB;AACvB,kBAAI2B,QAAQ3B,IAAZ,EACE2B,QAAQ3B,IAAR,GAAe,KAAKoE,QAAL,CAAc/E,iBAAd,GACXsC,QAAQ3B,IAAR,CAAaoI,SAAb,CAAuB,CAAvB,CADW,GAEXzG,QAAQ3B,IAAR,CAAaoI,SAAb,CAAuB,CAAvB,EAA0BO,WAA1B,EAFJ;AAGFnB,qBAAO,KAAK+E,YAAL,CAAkB5K,OAAlB,CAAP;AACA,mBAAK7B,GAAL,CAAShB,IAAT,CAAc0I,IAAd;AACA,mBAAK6C,SAAL,CAAevL,IAAf,CAAoB0I,IAApB,EAPuB,CAOI;AAC3B,mBAAKgE,QAAL,GAAgBhE,IAAhB;AACD,aATM,MASA;AACL;AACAA,qBAAO,KAAK+E,YAAL,CAAkB5K,OAAlB,CAAP;AACA,mBAAK7B,GAAL,CAAShB,IAAT,CAAc0I,IAAd;AACA,mBAAKgE,QAAL,GAAgBhE,IAAhB;AACD;AACF,WAzBM,MAyBA;AACL;AACA,iBAAK1H,GAAL,CAAShB,IAAT,CAAc,KAAKyN,YAAL,CAAkB5K,OAAlB,CAAd;AACD;AACF,SArDD,MAqDO;AACL;AACA;AACA;AACA,cAAIA,QAAQ1B,IAAR,KAAiBpC,KAAKG,GAA1B,EAA+B;AAC7B,gBAAI2D,QAAQ3B,IAAR,CAAauI,MAAb,CAAoB,CAApB,KAA0B,GAA9B,EAAmC;AACjC;AACA;AACA,kBAAIkE,WAAW,KAAKrI,QAAL,CAAc/E,iBAAd,GACXsC,QAAQ3B,IAAR,CAAaoI,SAAb,CAAuB,CAAvB,CADW,GAEXzG,QAAQ3B,IAAR,CAAaoI,SAAb,CAAuB,CAAvB,EAA0BO,WAA1B,EAFJ;AAGA,kBAAI,CAAC,KAAK6D,UAAL,CAAgB7K,OAAhB,CAAL,EAA+B;AAC7B,oBAAIoD,MAAM,KAAKsF,SAAL,CAAetK,MAAf,GAAwB,CAAlC;AACA,uBAAOgF,MAAM,CAAC,CAAP,IAAY,KAAKsF,SAAL,CAAetF,KAAf,EAAsB/E,IAAtB,IAA8ByM,QAAjD,EAA2D,CAAG;AAC9D,oBAAI1H,MAAM,CAAC,CAAP,IAAY,KAAKsF,SAAL,CAAe,CAAf,EAAkBrK,IAAlB,IAA0ByM,QAA1C,EAAoD;AAClD,yBAAO1H,MAAM,KAAKsF,SAAL,CAAetK,MAAf,GAAwB,CAArC,EAAwC;AACtC,yBAAKsK,SAAL,CAAeqC,GAAf;AACD;AACF;AACF;AACF,aAfD,MAeO;AACL;AACAJ,uBAAS,KAAKjC,SAAL,CAAeoB,IAAf,EAAT;AACA,kBAAI9J,QAAQ1B,IAAR,KAAiBpC,KAAKI,IAA1B,EAAgC;AAC9B,oBAAI,CAACqO,OAAOpL,UAAZ,EAAwB;AACtBoL,yBAAOpL,UAAP,GAAoB,EAApB;AACD;AACDoL,uBAAOpL,UAAP,CACE,KAAKkD,QAAL,CAAcmH,iBAAd,GACI5J,QAAQ3B,IADZ,GAEI2B,QAAQ3B,IAAR,CAAa2I,WAAb,EAHN,IAKEhH,QAAQtB,IALV;AAMD,eAVD,MAUO;AACLmH,uBAAO,KAAK+E,YAAL,CAAkB5K,OAAlB,EAA2B2K,MAA3B,CAAP;AACA,oBAAI,CAACA,OAAOpM,QAAZ,EAAsB;AACpBoM,yBAAOpM,QAAP,GAAkB,EAAlB;AACD;AACDoM,uBAAOpM,QAAP,CAAgBpB,IAAhB,CAAqB0I,IAArB;AACA,oBAAI,CAAC,KAAKgF,UAAL,CAAgBhF,IAAhB,CAAL,EAA4B;AAC1B;AACA,uBAAK6C,SAAL,CAAevL,IAAf,CAAoB0I,IAApB;AACD;AACD,oBAAI7F,QAAQ1B,IAAR,KAAiBpC,KAAKG,GAA1B,EAA+B;AAC7B,uBAAKwN,QAAL,GAAgBhE,IAAhB;AACD;AACF;AACF;AACF,WA5CD,MA4CO,IAAI7F,QAAQ1B,IAAR,KAAiBpC,KAAKE,MAA1B,EAAkC;AACvC,gBAAI4D,QAAQ3B,IAAR,IAAgB2B,QAAQ3B,IAAR,CAAauI,MAAb,CAAoB,CAApB,KAA0B,GAA9C,EAAmD;AACjD;AACA;AACA,kBAAIkE,WAAW,KAAKrI,QAAL,CAAc/E,iBAAd,GACXsC,QAAQ3B,IAAR,CAAaoI,SAAb,CAAuB,CAAvB,CADW,GAEXzG,QAAQ3B,IAAR,CAAaoI,SAAb,CAAuB,CAAvB,EAA0BO,WAA1B,EAFJ;AAGA,kBAAI,CAAC,KAAK6D,UAAL,CAAgB7K,OAAhB,CAAL,EAA+B;AAC7B,oBAAIoD,MAAM,KAAKsF,SAAL,CAAetK,MAAf,GAAwB,CAAlC;AACA,uBAAOgF,MAAM,CAAC,CAAP,IAAY,KAAKsF,SAAL,CAAetF,KAAf,EAAsB/E,IAAtB,IAA8ByM,QAAjD,EAA2D,CAAG;AAC9D,oBAAI1H,MAAM,CAAC,CAAP,IAAY,KAAKsF,SAAL,CAAe,CAAf,EAAkBrK,IAAlB,IAA0ByM,QAA1C,EAAoD;AAClD,yBAAO1H,MAAM,KAAKsF,SAAL,CAAetK,MAAf,GAAwB,CAArC,EAAwC;AACtC,yBAAKsK,SAAL,CAAeqC,GAAf;AACD;AACF;AACF;AACF,aAfD,MAeO,IAAI/K,QAAQ3B,IAAR,IAAgB2B,QAAQ3B,IAAR,CAAauI,MAAb,CAAoB,CAApB,KAA0B,GAA9C,EAAmD;AACxD+D,uBAAS,KAAKjC,SAAL,CAAeoB,IAAf,EAAT;AACA,kBAAI9J,QAAQ3B,IAAZ,EACE2B,QAAQ3B,IAAR,GAAe,KAAKoE,QAAL,CAAc/E,iBAAd,GACXsC,QAAQ3B,IAAR,CAAaoI,SAAb,CAAuB,CAAvB,CADW,GAEXzG,QAAQ3B,IAAR,CAAaoI,SAAb,CAAuB,CAAvB,EAA0BO,WAA1B,EAFJ;AAGFnB,qBAAO,KAAK+E,YAAL,CAAkB5K,OAAlB,EAA2B2K,MAA3B,CAAP;AACA,kBAAI,CAACA,OAAOpM,QAAZ,EAAsB;AACpBoM,uBAAOpM,QAAP,GAAkB,EAAlB;AACD;AACDoM,qBAAOpM,QAAP,CAAgBpB,IAAhB,CAAqB0I,IAArB;AACA,mBAAKgE,QAAL,GAAgBhE,IAAhB;AACD,aAZM,MAYA;AACL;AACA8E,uBAAS,KAAKjC,SAAL,CAAeoB,IAAf,EAAT;AACA,kBAAI9J,QAAQ3B,IAAZ,EACE2B,QAAQ3B,IAAR,GAAe,KAAKoE,QAAL,CAAc/E,iBAAd,GACXsC,QAAQ3B,IAAR,CAAaoI,SAAb,CAAuB,CAAvB,CADW,GAEXzG,QAAQ3B,IAAR,CAAaoI,SAAb,CAAuB,CAAvB,EAA0BO,WAA1B,EAFJ;AAGFnB,qBAAO,KAAK+E,YAAL,CAAkB5K,OAAlB,EAA2B2K,MAA3B,CAAP;AACA,kBAAI,CAACA,OAAOpM,QAAZ,EAAsB;AACpBoM,uBAAOpM,QAAP,GAAkB,EAAlB;AACD;AACDoM,qBAAOpM,QAAP,CAAgBpB,IAAhB,CAAqB0I,IAArB;AACA,kBAAI7F,QAAQ3B,IAAZ,EAAkB;AAChB;AACA,qBAAKqK,SAAL,CAAevL,IAAf,CAAoB0I,IAApB,EAFgB,CAEW;AAC5B;AACD,mBAAKgE,QAAL,GAAgBhE,IAAhB;AACD;AACF,WA9CM,MA8CA;AACL;AACA8E,qBAAS,KAAKjC,SAAL,CAAeoB,IAAf,EAAT;AACA,gBAAI9J,QAAQ1B,IAAR,KAAiBpC,KAAKI,IAA1B,EAAgC;AAC9B,kBAAI,CAAC,KAAKuN,QAAL,CAActK,UAAnB,EAA+B;AAC7B,qBAAKsK,QAAL,CAActK,UAAd,GAA2B,EAA3B;AACD;AACD,mBAAKsK,QAAL,CAActK,UAAd,CACE,KAAKkD,QAAL,CAAcmH,iBAAd,GACI5J,QAAQ3B,IADZ,GAEI2B,QAAQ3B,IAAR,CAAa2I,WAAb,EAHN,IAKEhH,QAAQtB,IALV;AAMA;;;;;;;AAOD,aAjBD,MAiBO;AACL,kBAAI,CAACiM,OAAOpM,QAAZ,EAAsB;AACpBoM,uBAAOpM,QAAP,GAAkB,EAAlB;AACD;AACDoM,qBAAOpM,QAAP,CAAgBpB,IAAhB,CAAqB,KAAKyN,YAAL,CAAkB5K,OAAlB,EAA2B2K,MAA3B,CAArB;AACD;AACF;AACF;AACF;;;;;;;UAMmBK,c,GAAf/I,W;;MAEII,O,WAAAA,O;AACT;AACA;AACA,qBAAY4I,KAAZ,EAAmBC,WAAnB,EAAgC;AAAA;;AAC9B,WAAK5M,IAAL,GAAY2M,KAAZ;AACA,WAAK3I,UAAL,GAAkB4I,WAAlB;AACD;;;;qCAqBc1M,E,EAAI8B,O,EAAS;AAC1B,eAAOtC,SAASkD,cAAT,CAAwB1C,EAAxB,EAA4B,IAA5B,EAAkC8B,OAAlC,CAAP;AACD;;;2CACoB9B,E,EAAI8B,O,EAASC,K,EAAO;AACvC,eAAOvC,SAASC,oBAAT,CAA8BO,EAA9B,EAAkC,IAAlC,EAAwC8B,OAAxC,EAAiDC,KAAjD,CAAP;AACD;;;2CACoBjC,I,EAAMgC,O,EAASC,K,EAAO;AACzC,eAAOvC,SAASuD,oBAAT,CAA8BjD,IAA9B,EAAoC,IAApC,EAA0CgC,OAA1C,EAAmDC,KAAnD,CAAP;AACD;;;kCACWR,O,EAASO,O,EAASC,K,EAAO;AACnC,eAAOvC,SAASmC,WAAT,CAAqBJ,OAArB,EAA8B,IAA9B,EAAoCO,OAApC,EAA6CC,KAA7C,CAAP;AACD;;;uCACgB;AACf,eAAOvC,SAAS6D,cAAT,CAAwB,IAAxB,CAAP;AACD;;;kCACW7B,O,EAAS;AACnB,eAAOhC,SAAS0D,WAAT,CAAqB1B,OAArB,EAA8B,IAA9B,CAAP;AACD;;;iCACU1B,I,EAAMgE,U,EAAY;AAC3B,eAAO,IAAID,OAAJ,CAAY/D,IAAZ,EAAkBgE,cAAc,IAAhC,CAAP;AACD;;;oCACa6I,O,EAAS7I,U,EAAY;AACjC,YAAIF,aAAa,IAAIC,OAAJ,CAAY,KAAZ,EAAmBC,cAAc,IAAjC,CAAjB;AACAF,mBAAW/D,IAAX,GAAkB8M,OAAlB;AACA,eAAO/I,UAAP;AACD;;;qCACcoE,I,EAAMlE,U,EAAY;AAC/B,YAAIF,aAAa,IAAIC,OAAJ,CAAY,MAAZ,EAAoBC,cAAc,IAAlC,CAAjB;AACAF,mBAAW1D,IAAX,GAAkB8H,IAAlB;AACA,eAAOpE,UAAP;AACD;;;kCAEWpC,O,EAAS;AACnB,aAAKzB,QAAL,GAAgB,KAAKA,QAAL,IAAiB,EAAjC;AACAyB,gBAAQsC,UAAR,GAAqB,IAArB;AACA,aAAK/D,QAAL,CAAcpB,IAAd,CAAmB6C,OAAnB;AACD;;;mCAEYoL,O,EAASC,a,EAAe;AACnC,aAAK9M,QAAL,GAAgB,KAAKA,QAAL,IAAiB,EAAjC;AACA,YAAIY,QAAQ,KAAKZ,QAAL,CAAcuJ,OAAd,CAAsBuD,aAAtB,CAAZ;AACA,aAAK9M,QAAL,CAAcqD,MAAd,CAAqBzC,KAArB,EAA4B,CAA5B,EAA+BiM,OAA/B;AACD;;;mCAEY/M,I,EAAM;AACjB,aAAKkB,UAAL,CAAgBlB,IAAhB;AACD;;;mCAEYiE,U,EAAY;AACvB,iBAASgJ,eAAT,CAAyB/L,UAAzB,EAAqC;AACnC,cAAIgM,gBAAgB,EAApB;AACA,eAAK,IAAItL,GAAT,IAAgBV,UAAhB,EAA4B;AAC1B,gBAAIiM,YAAYjM,WAAWU,GAAX,CAAhB,CAD0B,CACO;AACjC,gBAAIwL,aAAa,EAAjB;AACA,iBAAK,IAAI7L,IAAI,CAAb,EAAgBA,IAAI4L,UAAUpN,MAA9B,EAAsCwB,GAAtC,EAA2C;AACzC,kBAAI8L,mBAAmBF,UAAU5L,CAAV,CAAvB,CADyC,CACJ;AACrC,kBAAI+L,oBAAoB;AACtBrN,sBAAMoN,iBAAiBpN,IADD;AAEtBI,sBAAMgN,iBAAiBhN;AAFD,eAAxB;AAIA,kBAAIgN,iBAAiB/O,QAArB,EACEgP,kBAAkBhP,QAAlB,GAA6B+O,iBAAiB/O,QAA9C;AACF8O,yBAAWtO,IAAX,CAAgBwO,iBAAhB;AACD;AACDJ,0BAActL,GAAd,IAAqBwL,UAArB;AACD;AACD,iBAAOF,aAAP;AACD;AACD,YAAInJ,aAAa,KAAKwJ,UAAL,CAAgB,KAAKtN,IAArB,EAA2BgE,cAAc,EAAzC,CAAjB;AACA,YAAI,KAAKjE,IAAT,EAAe+D,WAAW/D,IAAX,GAAkB,KAAKA,IAAvB;AACf,YAAI,KAAKyI,GAAT,EAAc1E,WAAW0E,GAAX,GAAiB,KAAKA,GAAtB;AACd,YAAI,KAAKyD,QAAT,EACEnI,WAAWmI,QAAX,GAAsB;AACpBJ,gBAAM,KAAKI,QAAL,CAAcJ,IADA;AAEpBnB,eAAK,KAAKuB,QAAL,CAAcvB;AAFC,SAAtB;AAIF,YAAI,KAAKrM,QAAT,EAAmByF,WAAWzF,QAAX,GAAsB,KAAKA,QAA3B;AACnB,YAAI,KAAK+B,IAAT,EAAe0D,WAAW1D,IAAX,GAAkB,KAAKA,IAAvB;;AAEf,YAAI,KAAKa,UAAT,EACE6C,WAAW7C,UAAX,GAAwB+L,gBAAgB,KAAK/L,UAArB,CAAxB;AACF,YAAI,KAAKhB,QAAT,EAAmB;AACjB6D,qBAAW7D,QAAX,GAAsB,EAAtB;AACA,eAAK,IAAIqB,IAAI,CAAb,EAAgBA,IAAI,KAAKrB,QAAL,CAAcH,MAAlC,EAA0CwB,GAA1C,EAA+C;AAC7C,gBAAIiM,QAAQ,KAAKtN,QAAL,CAAcqB,CAAd,CAAZ;AACAiM,kBAAMC,YAAN,CAAmB1J,UAAnB;AACD;AACF;AACD,YAAIA,WAAWE,UAAX,CAAsB/D,QAA1B,EAAoC;AAClC6D,qBAAWE,UAAX,CAAsB/D,QAAtB,CAA+BpB,IAA/B,CAAoCiF,UAApC;AACD,SAFD,MAEO;AACLA,qBAAWE,UAAX,CAAsB/D,QAAtB,GAAiC,CAAC6D,UAAD,CAAjC;AACD;AACD,eAAOA,UAAP;AACD;;;0BAlHiB;AAChB,YAAI,CAAC,KAAKE,UAAN,IAAoB,CAAC,KAAKA,UAAL,CAAgB/D,QAAzC,EAAmD,OAAO,IAAP;AACnD,YAAIqB,IAAI,KAAK0C,UAAL,CAAgB/D,QAAhB,CAAyBuJ,OAAzB,CAAiC,IAAjC,CAAR;AACA,YAAIlI,KAAK,CAAC,CAAN,IAAW,KAAK0C,UAAL,CAAgB/D,QAAhB,CAAyBwN,MAAzB,IAAmCnM,CAAlD,EAAqD,OAAO,IAAP;AACrD,eAAO,KAAK0C,UAAL,CAAgB/D,QAAhB,CAAyBqB,IAAI,CAA7B,CAAP;AACD;;;0BACa;AACZ,YAAI,CAAC,KAAKL,UAAV,EAAsB,OAAO,IAAP;AACtB,YAAIyM,MAAM,EAAV;AACA,aAAK,IAAIC,IAAT,IAAiB,KAAK1M,UAAtB,EAAkC;AAChC,cAAI2M,UAAU,EAAd;AACA,eAAK3M,UAAL,CAAgB0M,IAAhB,EAAsBhP,OAAtB,CAA8B,UAAUkP,IAAV,EAAgB;AAC5CD,sBAAUC,KAAKzN,IAAL,IAAa,EAAvB;AACD,WAFD;AAGAsN,cAAIC,IAAJ,IAAYC,OAAZ;AACD;AACDE,gBAAQC,GAAR,CAAY,SAAZ,EAAuBL,GAAvB;AACA,eAAOA,GAAP;AACD","file":"htmlparser.js","sourcesContent":["/***********************************************\nCopyright 2010 - 2012 Chris Winberry <chris@winberry.net>. All rights reserved.\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to\ndeal in the Software without restriction, including without limitation the\nrights to use, copy, modify, merge, publish, distribute, sublicense, and/or\nsell copies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\nIN THE SOFTWARE.\n***********************************************/\n/* v3.0.0 */\n(function () {\n  /*\n  var exports;\n  if (typeof module !== \"undefined\" && typeof module.exports !== \"undefined\") {\n    exports = module.exports;\n  } else {\n    exports = {};\n    if (!this.Tautologistics) {\n      this.Tautologistics = {};\n    }\n    if (this.Tautologistics.NodeHtmlParser) {\n      return;\n    }\n    this.Tautologistics.NodeHtmlParser = exports;\n  }\n  */\n\n  if (typeof window !== 'undefined') {\n    if (!window.Tautologistics) {\n      window.Tautologistics = {};\n    }\n    window.Tautologistics.NodeHtmlParser = exports;\n  }\n\n\n})();\n\n  function inherits(ctor, superCtor) {\n    var tempCtor = function () { };\n    tempCtor.prototype = superCtor.prototype;\n    ctor.super_ = superCtor;\n    ctor.prototype = new tempCtor();\n    ctor.prototype.constructor = ctor;\n  }\n\n  var Mode = {\n    Text: \"text\",\n    Script: \"script\",\n    Tag: \"tag\",\n    Attr: \"attr\",\n    CData: \"cdata\",\n    Doctype: \"doctype\",\n    Comment: \"comment\"\n  };\n  var TagType = [\n    {\n      langName: \"mustache\",\n      open: \"{{\",\n      close: \"}}\",\n      openCode: \"\\uFFF0\",\n      closeCode: \"\\uFFF1\"\n    },\n    {\n      langName: \"singleMustache\",\n      open: \"{\",\n      close: \"}\",\n      openCode: \"\\uFFF2\",\n      closeCode: \"\\uFFF3\"\n    }\n  ];\n\n  var opentags = [];\n  TagType.forEach(function (tagtype) {\n    opentags.push(tagtype.openCode);\n  }, this);\n\n//Node版の場合はParserをStreamからの継承にする\n/*\n//ES6だとこの方法は動かないので別の方法を考えなくてはならない\n  if (typeof module !== \"undefined\" && typeof module.exports !== \"undefined\") {\n    var Stream = require(\"stream\");\n    inherits(Parser, Stream);\n  }\n*/\n\n  function RssBuilder(callback) {\n    RssBuilder.super_.call(this, callback, {\n      ignoreWhitespace: true,\n      verbose: false,\n      enforceEmptyTags: false,\n      caseSensitiveTags: true\n    });\n  }\n // inherits(RssBuilder, HtmlBuilder);\n\n\n  RssBuilder.prototype.done = function RssBuilder$done() {\n    var feed = {};\n    var feedRoot;\n\n    var found = DomUtils.getElementsByTagName(\n      function (value) {\n        return value == \"rss\" || value == \"feed\";\n      },\n      this.dom,\n      false\n    );\n    if (found.length) {\n      feedRoot = found[0];\n    }\n    if (feedRoot) {\n      if (feedRoot.name == \"rss\") {\n        feed.type = \"rss\";\n        feedRoot = feedRoot.children[0]; //<channel/>\n        feed.id = \"\";\n        try {\n          feed.title = DomUtils.getElementsByTagName(\n            \"title\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.link = DomUtils.getElementsByTagName(\n            \"link\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.description = DomUtils.getElementsByTagName(\n            \"description\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.updated = new Date(\n            DomUtils.getElementsByTagName(\n              \"lastBuildDate\",\n              feedRoot.children,\n              false\n            )[0].children[0].data\n          );\n        } catch (ex) { }\n        try {\n          feed.author = DomUtils.getElementsByTagName(\n            \"managingEditor\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        feed.items = [];\n        DomUtils.getElementsByTagName(\"item\", feedRoot.children).forEach(\n          function (item, index, list) {\n            var entry = {};\n            try {\n              entry.id = DomUtils.getElementsByTagName(\n                \"guid\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.title = DomUtils.getElementsByTagName(\n                \"title\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.link = DomUtils.getElementsByTagName(\n                \"link\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.description = DomUtils.getElementsByTagName(\n                \"description\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.pubDate = new Date(\n                DomUtils.getElementsByTagName(\n                  \"pubDate\",\n                  item.children,\n                  false\n                )[0].children[0].data\n              );\n            } catch (ex) { }\n            feed.items.push(entry);\n          }\n        );\n      } else {\n        feed.type = \"atom\";\n        try {\n          feed.id = DomUtils.getElementsByTagName(\n            \"id\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.title = DomUtils.getElementsByTagName(\n            \"title\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.link = DomUtils.getElementsByTagName(\n            \"link\",\n            feedRoot.children,\n            false\n          )[0].attributes.href.value;\n        } catch (ex) { }\n        try {\n          feed.description = DomUtils.getElementsByTagName(\n            \"subtitle\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.updated = new Date(\n            DomUtils.getElementsByTagName(\n              \"updated\",\n              feedRoot.children,\n              false\n            )[0].children[0].data\n          );\n        } catch (ex) { }\n        try {\n          feed.author = DomUtils.getElementsByTagName(\n            \"email\",\n            feedRoot.children,\n            true\n          )[0].children[0].data;\n        } catch (ex) { }\n        feed.items = [];\n        DomUtils.getElementsByTagName(\"entry\", feedRoot.children).forEach(\n          function (item, index, list) {\n            var entry = {};\n            try {\n              entry.id = DomUtils.getElementsByTagName(\n                \"id\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.title = DomUtils.getElementsByTagName(\n                \"title\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.link = DomUtils.getElementsByTagName(\n                \"link\",\n                item.children,\n                false\n              )[0].attributes.href.value;\n            } catch (ex) { }\n            try {\n              entry.description = DomUtils.getElementsByTagName(\n                \"summary\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.pubDate = new Date(\n                DomUtils.getElementsByTagName(\n                  \"updated\",\n                  item.children,\n                  false\n                )[0].children[0].data\n              );\n            } catch (ex) { }\n            feed.items.push(entry);\n          }\n        );\n      }\n\n      this.dom = feed;\n    }\n    RssBuilder.super_.prototype.done.call(this);\n  };\n\n  var DomUtils = {\n    testAttribute: function DomUtils$testAttribute(option, attributes) {\n      for (var i = 0; i < attributes.length; i++) {\n        if (option(attributes[i].data)) return true;\n      }\n      return false;\n    },\n    testElement: function DomUtils$testElement(options, element) {\n      if (!element) {\n        return false;\n      }\n\n      for (var key in options) {\n        if (!options.hasOwnProperty(key)) {\n          continue;\n        }\n        if (key == \"tag_name\") {\n          if (element.type !== Mode.Tag) {\n            return false;\n          }\n          if (!options[\"tag_name\"](element.name)) {\n            return false;\n          }\n        } else if (key == \"tag_type\") {\n          if (!options[\"tag_type\"](element.type)) {\n            return false;\n          }\n        } else if (key == \"tag_contains\") {\n          if (\n            element.type !== Mode.Text &&\n            element.type !== Mode.Comment &&\n            element.type !== Mode.CData\n          ) {\n            return false;\n          }\n          if (!options[\"tag_contains\"](element.data)) {\n            return false;\n          }\n        } else {\n          //if (!element.attributes || !element.attributes[key] || !options[key](element.attributes[key].value)) {\n          if (\n            !element.attributes ||\n            !element.attributes[key] ||\n            !DomUtils.testAttribute(options[key], element.attributes[key])\n          ) {\n            return false;\n          }\n        }\n      }\n\n      return true;\n    },\n\n    getElements: function DomUtils$getElements(\n      options,\n      currentElement,\n      recurse,\n      limit\n    ) {\n      \n      setPrototypeOfDomUtils = function(array) {};\n      recurse = recurse === undefined || recurse === null || !!recurse;\n      limit = isNaN(parseInt(limit)) ? -1 : parseInt(limit);\n\n      var found = [];\n      var elementList;\n      setPrototypeOfDomUtils(found);\n\n      if (!currentElement) {\n        return found;\n      }\n\n      function getTest(checkVal) {\n        return function (value) {\n          return value == checkVal;\n        };\n      }\n      for (var key in options) {\n        if (typeof options[key] != \"function\") {\n          options[key] = getTest(options[key]);\n        }\n      }\n\n      if (DomUtils.testElement(options, currentElement)) {\n        found.push(currentElement);\n      }\n\n      if (limit >= 0 && found.length >= limit) {\n        return found;\n      }\n\n      if (recurse && currentElement.children) {\n        elementList = currentElement.children;\n      } else if (currentElement instanceof Array) {\n        elementList = currentElement;\n      } else {\n        return found;\n      }\n\n      for (var i = 0; i < elementList.length; i++) {\n        found = found.concat(\n          DomUtils.getElements(options, elementList[i], recurse, limit)\n        );\n        if (limit >= 0 && found.length >= limit) {\n          break;\n        }\n      }\n\n      return found;\n    },\n\n    getElementById: function DomUtils$getElementById(\n      id,\n      currentElement,\n      recurse\n    ) {\n      var result = DomUtils.getElements({ id: id }, currentElement, recurse, 1);\n      return result.length ? result[0] : null;\n    },\n\n    getElementsByTagName: function DomUtils$getElementsByTagName(\n      name,\n      currentElement,\n      recurse,\n      limit\n    ) {\n      return DomUtils.getElements(\n        { tag_name: name },\n        currentElement,\n        recurse,\n        limit\n      );\n    },\n\n    getElementsByTagType: function DomUtils$getElementsByTagType(\n      type,\n      currentElement,\n      recurse,\n      limit\n    ) {\n      return DomUtils.getElements(\n        { tag_type: type },\n        currentElement,\n        recurse,\n        limit\n      );\n    },\n    removeChild: function DomUtils$removeChild(element, currentElement) {\n      for (var i = 0; i < currentElement.children.length; i++) {\n        if (element === currentElement.children[i]) {\n          currentElement.children.splice(i, 1);//i番目から1つだけ削除\n        }\n      }\n    },\n    removeChildAll: function DomUtils$removeChildAll(currentElement) {\n      currentElement.children = [];\n    }\n  };\n\n  function parseDOM(data, options) {\n    var handler = new HtmlBuilder(options);\n    new Parser(handler, options).parseComplete(data);\n\n    var newElement = new Element(\"#document\", data);\n    newElement.parentNode = {};\n    newElement.children = handler.dom || [];\n    return newElement;\n    //return handler.dom;\n  }\n\n  /*\n  exports.Parser = Parser;\n\n  exports.HtmlBuilder = HtmlBuilder;\n  exports.DefaultHandler = HtmlBuilder;\n\n  exports.parseDOM = parseDOM;\n\n  exports.RssBuilder = RssBuilder;\n\n  exports.ElementType = Mode;\n\n  exports.DomUtils = DomUtils;\n*/\n\n//export { HtmlBuilder as HtmlBuilder, HtmlBuilder as DefaultHandler };\r\n\r\nexport class Parser {\n    constructor(builder, options) {\n      //Properties//\n      this.writable = true;\n\n      this._options = options ? options : {};\n      // if (this._options.includeLocation === undefined) {\n      //     this._options.includeLocation = false; //Include position of element (row, col) on nodes\n      // }\n      \n      this._validateBuilder = function(builder) {\n        if (typeof builder != \"object\") {\n          throw new Error(\"Builder is not an object\");\n        }\n        if (typeof builder.reset != \"function\") {\n          throw new Error(\"Builder method 'reset' is invalid\");\n        }\n        if (typeof builder.done != \"function\") {\n          throw new Error(\"Builder method 'done' is invalid\");\n        }\n        if (typeof builder.write != \"function\") {\n          throw new Error(\"Builder method 'write' is invalid\");\n        }\n        if (typeof builder.error != \"function\") {\n          throw new Error(\"Builder method 'error' is invalid\");\n        }\n      };\n      \n      this._validateBuilder(builder);\n      var self = this;\n      this._builder = builder;\n      \n      \n      this.reset=function() {\n        this._state = {\n          mode: Mode.Text,\n          lastMode: Mode.Text,\n          pos: 0,\n          data: null,\n          pendingText: null,\n          pendingWrite: null,\n          lastTag: null,\n          isScript: false,\n          needData: false,\n          output: [],\n          done: false,\n          commentTagType: \">\",\n          scriptTagType: null\n          // line: 1,\n          // col: 1\n        };\n        this._builder.reset();\n      }\n      \n      this.reset();\n\n      let parseText = new ParseText(this);\n      this._parseText = (state) => parseText._parseText(state);\n      let parseScript = new ParseScript(this);\n      this._parseScript = (state) => parseScript._parseScript(state);\n      let parseTag = new ParseTag(this);\n      this._parseTag = (state) => parseTag._parseTag(state);\n      let parseAttr = new ParseAttr(this);\n      this._parseAttr = (state) => parseAttr._parseAttr(state);\n      let parseCData = new ParseCData(this);\n      this._parseCData = (state) => parseCData._parseCData(state);\n      let parseDoctype = new ParseDoctype(this);\n      this._parseDoctype = (state) => parseDoctype._parseDoctype(state);\n      let parseComment = new ParseComment(this);\n      this._parseComment = (state) => parseComment._parseComment(state);\n   \n    }\n    //**Public**//\n    write(data) {\n      if (data instanceof Buffer) {\n        data = data.toString();\n      }\n      this.parseChunk(data);\n    }\n    end(data) {\n      if (arguments.length) {\n        this.write(data);\n      }\n      this.writable = false;\n      this.done();\n    }\n    destroy() {\n      this.writable = false;\n    }\n    \n    parseChunk(chunk) {\n      this._state.needData = false;\n      this._state.data =\n        this._state.data !== null\n          ? this._state.data.substr(this.pos) + chunk\n          : chunk;\n      while (\n        this._state.pos < this._state.data.length &&\n        !this._state.needData\n      ) {\n        this._parse(this._state);\n      }\n    }\n    parseComplete(data) {\n      if (!data) return;\n      this.reset();\n      TagType.forEach(function(tagtype) {\n        data = data\n          .replace(new RegExp(tagtype.open, \"g\"), tagtype.openCode)\n          .replace(new RegExp(tagtype.close, \"g\"), tagtype.closeCode);\n      }, this);\n      this.parseChunk(data);\n      this.done();\n    }\n    done() {\n      this._state.done = true;\n      this._parse(this._state);\n      this._flushWrite();\n      this._builder.done();\n    }\n\n    //**Private**//\n    _parse() {\n      switch (this._state.mode) {\n        case Mode.Text:\n          return this._parseText(this._state);\n        case Mode.Script:\n          return this._parseScript(this._state);\n        case Mode.Tag:\n          return this._parseTag(this._state);\n        case Mode.Attr:\n          return this._parseAttr(this._state);\n        case Mode.CData:\n          return this._parseCData(this._state);\n        case Mode.Doctype:\n          return this._parseDoctype(this._state);\n        case Mode.Comment:\n          return this._parseComment(this._state);\n      }\n    }\n    _writePending(node) {\n      if (!this._state.pendingWrite) {\n        this._state.pendingWrite = [];\n      }\n      this._state.pendingWrite.push(node);\n    }\n    _flushWrite() {\n      if (this._state.pendingWrite) {\n        for (var i = 0, len = this._state.pendingWrite.length; i < len; i++) {\n          var node = this._state.pendingWrite[i];\n          this._builder.write(node);\n        }\n        this._state.pendingWrite = null;\n      }\n    }\n    _write(node) {\n      this._flushWrite();\n      this._builder.write(node);\n    }\n  }\n\r\n\r\nexport class ParseText {\n    constructor(perser) {\n      this.perser = perser;\n      this._re_parseText_tagOpen = new RegExp(\"([\\\\<\" + opentags.join(\"\") + \"])\", \"g\");\n      this._re_parseText_scriptClose = /<\\s*\\/\\s*(x\\-)?script/gi;\n    }\n\n    _parseText(state){\n      var nextMode = Mode.Tag;\n      var foundPos;\n      if (state.isScript) {\n        this._re_parseText_scriptClose.lastIndex = state.pos;\n        foundPos = this._re_parseText_scriptClose.exec(state.data);\n        foundPos = foundPos ? foundPos.index : -1;\n      } else {\n        this._re_parseText_tagOpen.lastIndex = state.pos;\n        var match = this._re_parseText_tagOpen.exec(state.data);\n        if (match) {\n          if (match[0] == \"<\") {\n            nextMode = Mode.Tag;\n            foundPos = match.index;\n          } else {\n            TagType.forEach(function(tagtype) {\n              if (match[0] == tagtype.openCode) {\n                nextMode = Mode.Script;\n                state.lastMode = Mode.Text;\n                foundPos = match.index;\n                state.scriptTagType = tagtype;\n              }\n            }, this.perser);\n          }\n        } else {\n          nextMode = Mode.Tag;\n          foundPos = -1;\n        }\n      }\n      var text =\n        foundPos === -1\n          ? state.data.substring(state.pos, state.data.length)\n          : state.data.substring(state.pos, foundPos);\n      if (foundPos < 0 && state.done) {\n        foundPos = state.data.length;\n      }\n      if (foundPos < 0) {\n        if (state.isScript) {\n          state.needData = true;\n          return;\n        }\n        if (!state.pendingText) {\n          state.pendingText = [];\n        }\n        state.pendingText.push(\n          state.data.substring(state.pos, state.data.length)\n        );\n        state.pos = state.data.length;\n      } else {\n        if (state.pendingText) {\n          state.pendingText.push(state.data.substring(state.pos, foundPos));\n          text = state.pendingText.join(\"\");\n          state.pendingText = null;\n        } else {\n          text = state.data.substring(state.pos, foundPos);\n        }\n        if (text !== \"\") {\n          this.perser._write({ type: Mode.Text, data: text });\n        }\n        state.pos = foundPos + 1;\n        state.mode = nextMode;\n      }\n    }\n  }\r\n\r\nexport class ParseScript {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseScript = /\\s*([\\/\\#][^\\s\\}]+)?(\\!\\-*)?\\s*([^\\}]*?)\\}/g;\r\n    }\r\n    _parseScript(state){\r\n      var re_parseScript =\r\n        \"\\\\s*([\\\\/\\\\#][^\\\\s\" +\r\n        state.scriptTagType.closeCode +\r\n        \"]+)?(\\\\!\\\\-*)?\\\\s*([^\" +\r\n        state.scriptTagType.closeCode +\r\n        \"]*?)\" +\r\n        state.scriptTagType.closeCode;\r\n      this.re_parseScript = new RegExp(re_parseScript, \"g\");\r\n\r\n      this.re_parseScript.lastIndex = state.pos;\r\n      var match = this.re_parseScript.exec(state.data);\r\n      if (match) {\r\n        state.mode = Mode.Script;\r\n        if (match[2] && match[2].substr(0, 3) === \"!--\") {\r\n          state.mode = Mode.Comment;\r\n          state.commentTagType = state.scriptTagType.closeCode;\r\n          state.pos += 3;\r\n          return;\r\n        }\r\n        if (match[2] && match[2].charAt(0) == \"!\") {\r\n          state.mode = Mode.Comment;\r\n          state.commentTagType = state.scriptTagType.closeCode;\r\n          state.pos += 1;\r\n        }\r\n        var text = match[3];\r\n        if (state.pendingText) {\r\n          state.pendingText.push(text);\r\n          text = state.pendingText.join(\"\");\r\n          state.pendingText = null;\r\n        }\r\n        if (text !== \"\") {\r\n          this.perser._write({\r\n            type: state.mode,\r\n            name: match[1] || match[2],\r\n            data: text,\r\n            langName: state.scriptTagType.langName\r\n          });\r\n        }\r\n        state.pos += match[0].length;\r\n        state.mode = state.lastMode;\r\n      } else {\r\n        //TODO: end of tag?\r\n        //TODO: push to pending?\r\n        state.needData = true;\r\n      }\r\n  };\r\n}\r\n\r\nexport class ParseTag {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseTag = /\\s*(\\/?)\\s*([^\\s>\\/]+)(\\s*)\\??(>?)/g;\r\n    }\r\n    _parseTag(state) {\r\n      this.re_parseTag.lastIndex = state.pos;\r\n      var match = this.re_parseTag.exec(state.data);\r\n      if (match) {\r\n        if (!match[1] && match[2].substr(0, 3) === \"!--\") {\r\n          state.mode = Mode.Comment;\r\n          state.commentTagType = \">\";\r\n          state.pos += 3;\r\n          return;\r\n        }\r\n        if (!match[1] && match[2].substr(0, 8) === \"![CDATA[\") {\r\n          state.mode = Mode.CData;\r\n          state.pos += 8;\r\n          return;\r\n        }\r\n        if (!match[1] && match[2].substr(0, 8) === \"!DOCTYPE\") {\r\n          state.mode = Mode.Doctype;\r\n          state.pos += 8;\r\n          return;\r\n        }\r\n        if (!state.done && state.pos + match[0].length === state.data.length) {\r\n          //We're at the and of the data, might be incomplete\r\n          state.needData = true;\r\n          return;\r\n        }\r\n        var raw;\r\n        if (match[4] === \">\") {\r\n          state.mode = Mode.Text;\r\n          raw = match[0].substr(0, match[0].length - 1);\r\n        } else {\r\n          state.mode = Mode.Attr;\r\n          raw = match[0];\r\n        }\r\n        state.pos += match[0].length;\r\n        var tag = { type: Mode.Tag, name: match[1] + match[2], raw: raw };\r\n        if (state.mode === Mode.Attr) {\r\n          state.lastTag = tag;\r\n        }\r\n        if (tag.name.toLowerCase() === \"script\") {\r\n          state.isScript = true;\r\n        } else if (tag.name.toLowerCase() === \"/script\") {\r\n          state.isScript = false;\r\n        }\r\n        if (tag.name.toLowerCase() === \"x-script\") {\r\n          state.isScript = true;\r\n        } else if (tag.name.toLowerCase() === \"/x-script\") {\r\n          state.isScript = false;\r\n        }\r\n        if (state.mode === Mode.Attr) {\r\n          this.perser._writePending(tag);\r\n        } else {\r\n          this.perser._write(tag);\r\n        }\r\n      } else {\r\n        //TODO: end of tag?\r\n        //TODO: push to pending?\r\n        state.needData = true;\r\n      }\r\n    };\r\n\r\n  }\r\n\r\nexport class ParseAttr_findName {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseAttr_findName = /\\s*([^=<>\\s'\"\\/]+)\\s*/g;\r\n    }\r\n    _parseAttr_findName(state) {\r\n      this.re_parseAttr_findName.lastIndex = state.pos;\r\n      var match = this.re_parseAttr_findName.exec(state.data);\r\n      if (!match) {\r\n        return null;\r\n      }\r\n      if (\r\n        state.pos + match[0].length !==\r\n        this.re_parseAttr_findName.lastIndex\r\n      ) {\r\n        return null;\r\n      }\r\n      return {\r\n        match: match[0],\r\n        name: match[1]\r\n      };\r\n    };\r\n\r\n  }\r\n\r\nexport class ParseAttr_findValue {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseAttr_findValue = /\\s*=\\s*(?:'([^']*)'|\"([^\"]*)\"|([^'\"\\s\\/>]+))\\s*/g;\r\n      this.re_parseAttr_findValue_last = /\\s*=\\s*['\"]?(.*)$/g;\r\n    }\r\n    _parseAttr_findValue(state) {\r\n      this.re_parseAttr_findValue.lastIndex = state.pos;\r\n      var match = this.re_parseAttr_findValue.exec(state.data);\r\n      if (!match) {\r\n        if (!state.done) {\r\n          return null;\r\n        }\r\n        this.re_parseAttr_findValue_last.lastIndex = state.pos;\r\n        match = this.re_parseAttr_findValue_last.exec(state.data);\r\n        if (!match) {\r\n          return null;\r\n        }\r\n        return {\r\n          match: match[0],\r\n          value: match[1] !== \"\" ? match[1] : null\r\n        };\r\n      }\r\n      if (\r\n        state.pos + match[0].length !==\r\n        this.re_parseAttr_findValue.lastIndex\r\n      ) {\r\n        return null;\r\n      }\r\n      return {\r\n        match: match[0],\r\n        value: match[1] || match[2] || match[3]\r\n      };\r\n    };\r\n  }\r\n\r\nexport class ParseAttr {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseAttr_splitValue = /^\\s*=\\s*['\"]?/g;\r\n      this.re_parseAttr_selfClose = /(\\s*\\/\\s*)(>?)/g;\r\n      this.parseAttr_findName = new ParseAttr_findName(perser);\r\n      this.parseAttr_findValue = new ParseAttr_findValue(perser);\r\n    }\r\n    _parseAttr(state) {\r\n      var name_data = this.parseAttr_findName._parseAttr_findName(state);\r\n      if (!name_data || name_data.name === \"?\") {\r\n        this.re_parseAttr_selfClose.lastIndex = state.pos;\r\n        var matchTrailingSlash = this.re_parseAttr_selfClose.exec(state.data);\r\n        if (matchTrailingSlash && matchTrailingSlash.index === state.pos) {\r\n          if (\r\n            !state.done &&\r\n            !matchTrailingSlash[2] &&\r\n            state.pos + matchTrailingSlash[0].length === state.data.length\r\n          ) {\r\n            state.needData = true;\r\n            return;\r\n          }\r\n          state.lastTag.raw += matchTrailingSlash[1];\r\n          // state.output.push({ type: Mode.Tag, name: '/' + state.lastTag.name, raw: null });\r\n          this.perser._write({\r\n            type: Mode.Tag,\r\n            name: \"/\" + state.lastTag.name,\r\n            raw: null\r\n          });\r\n          state.pos += matchTrailingSlash[1].length;\r\n        }\r\n        var foundPos = state.data.indexOf(\">\", state.pos);\r\n        if (foundPos < 0) {\r\n          if (state.done) {\r\n            //TODO: is this needed?\r\n            state.lastTag.raw += state.data.substr(state.pos);\r\n            state.pos = state.data.length;\r\n            return;\r\n          }\r\n          state.needData = true;\r\n        } else {\r\n          // state.lastTag = null;\r\n          state.pos = foundPos + 1;\r\n          state.mode = Mode.Text;\r\n        }\r\n        return;\r\n      }\r\n      if (\r\n        !state.done &&\r\n        state.pos + name_data.match.length === state.data.length\r\n      ) {\r\n        state.needData = true;\r\n        return null;\r\n      }\r\n      state.pos += name_data.match.length;\r\n      var value_data = this.parseAttr_findValue._parseAttr_findValue(state);\r\n      if (value_data) {\r\n        if (\r\n          !state.done &&\r\n          state.pos + value_data.match.length === state.data.length\r\n        ) {\r\n          state.needData = true;\r\n          state.pos -= name_data.match.length;\r\n          return;\r\n        }\r\n        state.pos += value_data.match.length;\r\n      } else {\r\n        this.re_parseAttr_splitValue.lastIndex = state.pos;\r\n        if (this.re_parseAttr_splitValue.exec(state.data)) {\r\n          state.needData = true;\r\n          state.pos -= name_data.match.length;\r\n          return;\r\n        }\r\n        value_data = {\r\n          match: \"\",\r\n          value: null\r\n        };\r\n      }\r\n      state.lastTag.raw += name_data.match + value_data.match;\r\n\r\n      var foundCloseScriptPos = -1;\r\n      var data = [];\r\n      if (value_data.value) {\r\n        var handler = new HtmlBuilder(function (err, dom) { },\r\n          this.perser._builder._options);\r\n        var parser = new Parser(handler);\r\n        parser.parseComplete(value_data.value);\r\n        data = handler.dom;\r\n      }\r\n\r\n      this.perser._writePending({ type: Mode.Attr, name: name_data.name, data: data });\r\n    };\r\n\r\n  }\r\n\r\nexport class ParseCData {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseCData_findEnding = /\\]{1,2}$/;\r\n    }\r\n    _parseCData(state) {\r\n      var foundPos = state.data.indexOf(\"]]>\", state.pos);\r\n      if (foundPos < 0 && state.done) {\r\n        foundPos = state.data.length;\r\n      }\r\n      if (foundPos < 0) {\r\n        this.re_parseCData_findEnding.lastIndex = state.pos;\r\n        var matchPartialCDataEnd = this.re_parseCData_findEnding.exec(\r\n          state.data\r\n        );\r\n        if (matchPartialCDataEnd) {\r\n          state.needData = true;\r\n          return;\r\n        }\r\n        if (!state.pendingText) {\r\n          state.pendingText = [];\r\n        }\r\n        state.pendingText.push(state.data.substr(state.pos, state.data.length));\r\n        state.pos = state.data.length;\r\n        state.needData = true;\r\n      } else {\r\n        var text;\r\n        if (state.pendingText) {\r\n          state.pendingText.push(state.data.substring(state.pos, foundPos));\r\n          text = state.pendingText.join(\"\");\r\n          state.pendingText = null;\r\n        } else {\r\n          text = state.data.substring(state.pos, foundPos);\r\n        }\r\n        this.perser._write({ type: Mode.CData, data: text });\r\n        state.mode = Mode.Text;\r\n        state.pos = foundPos + 3;\r\n      }\r\n    };\r\n  }\r\n\r\nexport class ParseDoctype {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n    }\r\n    _parseDoctype(state) {\r\n      var foundPos = state.data.indexOf(\">\", state.pos);\r\n      if (foundPos < 0 && state.done) {\r\n        foundPos = state.data.length;\r\n      }\r\n      if (foundPos < 0) {\r\n        this.re_parseCData_findEnding.lastIndex = state.pos;\r\n        if (!state.pendingText) {\r\n          state.pendingText = [];\r\n        }\r\n        state.pendingText.push(state.data.substr(state.pos, state.data.length));\r\n        state.pos = state.data.length;\r\n        state.needData = true;\r\n      } else {\r\n        var text;\r\n        if (state.pendingText) {\r\n          state.pendingText.push(state.data.substring(state.pos, foundPos));\r\n          text = state.pendingText.join(\"\");\r\n          state.pendingText = null;\r\n        } else {\r\n          text = state.data.substring(state.pos, foundPos);\r\n        }\r\n        this.perser._write({ type: Mode.Doctype, data: text });\r\n        state.mode = Mode.Text;\r\n        state.pos = foundPos + 1;\r\n      }\r\n    };\r\n  }\r\n\r\nexport class ParseComment {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseComment_findEnding = /\\-{1,2}$/;\r\n    }\r\n    _parseComment(state) {\r\n      var foundPos = state.data.indexOf(\"--\" + state.commentTagType, state.pos);\r\n      if (foundPos < 0 && state.done) {\r\n        foundPos = state.data.length;\r\n      }\r\n      if (foundPos < 0) {\r\n        this.re_parseComment_findEnding.lastIndex = state.pos;\r\n        var matchPartialCommentEnd = this.re_parseComment_findEnding.exec(\r\n          state.data\r\n        );\r\n        if (matchPartialCommentEnd) {\r\n          state.needData = true;\r\n          return;\r\n        }\r\n        if (!state.pendingText) {\r\n          state.pendingText = [];\r\n        }\r\n        state.pendingText.push(state.data.substr(state.pos, state.data.length));\r\n        state.pos = state.data.length;\r\n        state.needData = true;\r\n      } else {\r\n        var text;\r\n        if (state.pendingText) {\r\n          state.pendingText.push(state.data.substring(state.pos, foundPos));\r\n          text = state.pendingText.join(\"\");\r\n          state.pendingText = null;\r\n        } else {\r\n          text = state.data.substring(state.pos, foundPos);\r\n        }\r\n        this.perser._write({ type: Mode.Comment, data: text });\r\n        state.mode = Mode.Text;\r\n        state.pos = foundPos + 3;\r\n      }\r\n    };\r\n\r\n  }\r\n\r\nexport class HtmlBuilder {\r\n    constructor(callback, options) {\r\n      //Properties//\r\n      this._options = null; //Builder options for how to behave\r\n      this._callback = null; //Callback to respond to when parsing done\r\n      this._done = false; //Flag indicating whether builder has been notified of parsing completed\r\n      this._tagStack = null; //List of parents to the currently element being processed\r\n      this.dom = null; //The hierarchical object containing the parsed HTML\r\n\r\n      //HTML Tags that shouldn't contain child nodes\r\n      this._emptyTags = {\r\n        area: 1,\r\n        base: 1,\r\n        basefont: 1,\r\n        br: 1,\r\n        col: 1,\r\n        frame: 1,\r\n        hr: 1,\r\n        img: 1,\r\n        input: 1,\r\n        isindex: 1,\r\n        link: 1,\r\n        meta: 1,\r\n        param: 1,\r\n        embed: 1,\r\n        \"?xml\": 1,\r\n        wbr: 1\r\n      };\r\n      //Regex to detect whitespace only text nodes\r\n      this.reWhitespace = /^\\s*$/;\r\n\r\n      this.reset();\r\n      if (typeof callback == \"function\") {\r\n        this._callback = callback;\r\n      } else {\r\n        options = callback;\r\n      }\r\n      this._options = options ? options : {};\r\n      if (this._options.ignoreWhitespace === undefined) {\r\n        this._options.ignoreWhitespace = false; //Keep whitespace-only text nodes\r\n      }\r\n      if (this._options.includeLocation === undefined) {\r\n        this._options.includeLocation = false; //Include position of element (row, col) on nodes\r\n      }\r\n      if (this._options.verbose === undefined) {\r\n        this._options.verbose = true; //Keep data property for tags and raw property for all\r\n      }\r\n      if (this._options.enforceEmptyTags === undefined) {\r\n        this._options.enforceEmptyTags = true; //Don't allow children for HTML tags defined as empty in spec\r\n      }\r\n      if (this._options.caseSensitiveTags === undefined) {\r\n        this._options.caseSensitiveTags = false; //Lowercase all tag names\r\n      }\r\n      if (this._options.caseSensitiveAttr === undefined) {\r\n        this._options.caseSensitiveAttr = false; //Lowercase all attribute names\r\n      }\r\n    }\r\n    //Methods//\r\n    \r\n    setPrototypeOfDomUtils(array) {}\r\n    //Resets the builder back to starting state\r\n    reset() {\r\n      this.dom = [];\r\n      this.setPrototypeOfDomUtils(this.dom);\r\n      // this._raw = [];\r\n      this._done = false;\r\n      this._tagStack = [];\r\n      this._lastTag = null;\r\n      this._tagStack.last = function HtmlBuilder$_tagStack$last() {\r\n        return this.length ? this[this.length - 1] : null;\r\n      };\r\n      this._line = 1;\r\n      this._col = 1;\r\n    };\r\n    //Signals the builder that parsing is done\r\n    done() {\r\n      this._done = true;\r\n      this.handleCallback(null);\r\n    };\r\n\r\n    error(error) {\r\n      this.handleCallback(error);\r\n    };\r\n\r\n    handleCallback(error) {\r\n      if (typeof this._callback != \"function\") {\r\n        if (error) {\r\n          throw error;\r\n        } else {\r\n          return;\r\n        }\r\n      }\r\n      this._callback(error, this.dom);\r\n    };\r\n\r\n    isEmptyTag(element) {\r\n      var name = element.name.toLowerCase();\r\n      if (name.charAt(0) == \"?\") {\r\n        return true;\r\n      }\r\n      if (name.charAt(0) == \"/\") {\r\n        name = name.substring(1);\r\n      }\r\n      return this._options.enforceEmptyTags && !!this._emptyTags[name];\r\n    };\r\n\r\n    _getLocation() {\r\n      return { line: this._line, col: this._col };\r\n    };\r\n\r\n    // HtmlBuilder.reLineSplit = /(\\r\\n|\\r|\\n)/g;\r\n    _updateLocation(node) {\r\n      var positionData = node.type === Mode.Tag ? node.raw : node.data;\r\n      if (positionData === null) {\r\n        return;\r\n      }\r\n      // var lines = positionData.split(HtmlBuilder.reLineSplit);\r\n      var lines = positionData.split(\"\\n\");\r\n      this._line += lines.length - 1;\r\n      if (lines.length > 1) {\r\n        this._col = 1;\r\n      }\r\n      this._col += lines[lines.length - 1].length;\r\n      if (node.type === Mode.Tag) {\r\n        this._col += 2;\r\n      } else if (node.type === Mode.Comment) {\r\n        this._col += 7;\r\n      } else if (node.type === Mode.CData) {\r\n        this._col += 12;\r\n      }\r\n    };\r\n\r\n    _copyElement(element, parentNode) {\r\n      //var newElement = { type: element.type, parentNode: parentNode};\r\n      var newElement = new Element(element.type, parentNode);\r\n\r\n      if (this._options.verbose && element[\"raw\"] !== undefined) {\r\n        newElement.raw = element.raw;\r\n      }\r\n      if (element[\"name\"] !== undefined) {\r\n        switch (element.type) {\r\n          case Mode.Tag:\r\n            newElement.name = this._options.caseSensitiveTags\r\n              ? element.name\r\n              : element.name.toLowerCase();\r\n            break;\r\n\r\n          case Mode.Attr:\r\n            newElement.name = this._options.caseSensitiveAttr\r\n              ? element.name\r\n              : element.name.toLowerCase();\r\n            break;\r\n\r\n          default:\r\n            newElement.name = this._options.caseSensitiveTags\r\n              ? element.name\r\n              : element.name.toLowerCase();\r\n            break;\r\n        }\r\n      }\r\n      if (element[\"data\"] !== undefined) {\r\n        TagType.forEach(function (tagtype) {\r\n          element.data = element.data\r\n            .replace(new RegExp(tagtype.openCode, \"g\"), tagtype.open)\r\n            .replace(new RegExp(tagtype.closeCode, \"g\"), tagtype.close);\r\n        }, this);\r\n        newElement.data = element.data;\r\n      }\r\n\r\n      if (element[\"langName\"] !== undefined) {\r\n        newElement.langName = element.langName;\r\n      }\r\n\r\n      if (element.location) {\r\n        newElement.location = {\r\n          line: element.location.line,\r\n          col: element.location.col\r\n        };\r\n      }\r\n\r\n      return newElement;\r\n    };\r\n\r\n    write(element) {\r\n      if (this._done) {\r\n        this.handleCallback(\r\n          new Error(\r\n            \"Writing to the builder after done() called is not allowed without a reset()\"\r\n          )\r\n        );\r\n      }\r\n      if (this._options.includeLocation) {\r\n        if (element.type !== Mode.Attr) {\r\n          element.location = this._getLocation();\r\n          this._updateLocation(element);\r\n        }\r\n      }\r\n      if (element.type === Mode.Text && this._options.ignoreWhitespace) {\r\n        if (this.reWhitespace.test(element.data)) {\r\n          return;\r\n        }\r\n      }\r\n      var parent;\r\n      var node;\r\n      if (!this._tagStack.last()) {\r\n        //There are no parent elements\r\n        //If the element can be a container, add it to the tag stack and the top level list\r\n        if (element.type === Mode.Tag) {\r\n          if (element.name.charAt(0) != \"/\") {\r\n            //Ignore closing tags that obviously don't have an opening tag\r\n            node = this._copyElement(element);\r\n            this.dom.push(node);\r\n            if (!this.isEmptyTag(node)) {\r\n              //Don't add tags to the tag stack that can't have children\r\n              this._tagStack.push(node);\r\n            }\r\n            this._lastTag = node;\r\n          }\r\n        } else if (element.type === Mode.Attr && this._lastTag) {\r\n          if (!this._lastTag.attributes) {\r\n            this._lastTag.attributes = {};\r\n          }\r\n          this._lastTag.attributes[\r\n            this._options.caseSensitiveAttr\r\n              ? element.name\r\n              : element.name.toLowerCase()\r\n          ] =\r\n            element.data;\r\n        } else if (element.type === Mode.Script) {\r\n          if (element.name && element.name.charAt(0) == \"/\") {\r\n            return;\r\n          } else if (element.name && element.name.charAt(0) == \"!\") {\r\n            element.name = this._options.caseSensitiveTags\r\n              ? element.name.substring(1)\r\n              : element.name.substring(1).toLowerCase();\r\n            node = this._copyElement(element);\r\n            this.dom.push(node);\r\n            this._lastTag = node;\r\n          } else if (element.name) {\r\n            if (element.name)\r\n              element.name = this._options.caseSensitiveTags\r\n                ? element.name.substring(1)\r\n                : element.name.substring(1).toLowerCase();\r\n            node = this._copyElement(element);\r\n            this.dom.push(node);\r\n            this._tagStack.push(node); //Don't add tags to the tag stack that can't have children\r\n            this._lastTag = node;\r\n          } else {\r\n            //This is not a closing tag\r\n            node = this._copyElement(element);\r\n            this.dom.push(node);\r\n            this._lastTag = node;\r\n          }\r\n        } else {\r\n          //Otherwise just add to the top level list\r\n          this.dom.push(this._copyElement(element));\r\n        }\r\n      } else {\r\n        //There are parent elements\r\n        //If the element can be a container, add it as a child of the element\r\n        //on top of the tag stack and then add it to the tag stack\r\n        if (element.type === Mode.Tag) {\r\n          if (element.name.charAt(0) == \"/\") {\r\n            //This is a closing tag, scan the tagStack to find the matching opening tag\r\n            //and pop the stack up to the opening tag's parent\r\n            var baseName = this._options.caseSensitiveTags\r\n              ? element.name.substring(1)\r\n              : element.name.substring(1).toLowerCase();\r\n            if (!this.isEmptyTag(element)) {\r\n              var pos = this._tagStack.length - 1;\r\n              while (pos > -1 && this._tagStack[pos--].name != baseName) { }\r\n              if (pos > -1 || this._tagStack[0].name == baseName) {\r\n                while (pos < this._tagStack.length - 1) {\r\n                  this._tagStack.pop();\r\n                }\r\n              }\r\n            }\r\n          } else {\r\n            //This is not a closing tag\r\n            parent = this._tagStack.last();\r\n            if (element.type === Mode.Attr) {\r\n              if (!parent.attributes) {\r\n                parent.attributes = {};\r\n              }\r\n              parent.attributes[\r\n                this._options.caseSensitiveAttr\r\n                  ? element.name\r\n                  : element.name.toLowerCase()\r\n              ] =\r\n                element.data;\r\n            } else {\r\n              node = this._copyElement(element, parent);\r\n              if (!parent.children) {\r\n                parent.children = [];\r\n              }\r\n              parent.children.push(node);\r\n              if (!this.isEmptyTag(node)) {\r\n                //Don't add tags to the tag stack that can't have children\r\n                this._tagStack.push(node);\r\n              }\r\n              if (element.type === Mode.Tag) {\r\n                this._lastTag = node;\r\n              }\r\n            }\r\n          }\r\n        } else if (element.type === Mode.Script) {\r\n          if (element.name && element.name.charAt(0) == \"/\") {\r\n            //This is a closing tag, scan the tagStack to find the matching opening tag\r\n            //and pop the stack up to the opening tag's parent\r\n            var baseName = this._options.caseSensitiveTags\r\n              ? element.name.substring(1)\r\n              : element.name.substring(1).toLowerCase();\r\n            if (!this.isEmptyTag(element)) {\r\n              var pos = this._tagStack.length - 1;\r\n              while (pos > -1 && this._tagStack[pos--].name != baseName) { }\r\n              if (pos > -1 || this._tagStack[0].name == baseName) {\r\n                while (pos < this._tagStack.length - 1) {\r\n                  this._tagStack.pop();\r\n                }\r\n              }\r\n            }\r\n          } else if (element.name && element.name.charAt(0) == \"!\") {\r\n            parent = this._tagStack.last();\r\n            if (element.name)\r\n              element.name = this._options.caseSensitiveTags\r\n                ? element.name.substring(1)\r\n                : element.name.substring(1).toLowerCase();\r\n            node = this._copyElement(element, parent);\r\n            if (!parent.children) {\r\n              parent.children = [];\r\n            }\r\n            parent.children.push(node);\r\n            this._lastTag = node;\r\n          } else {\r\n            //This is not a closing tag\r\n            parent = this._tagStack.last();\r\n            if (element.name)\r\n              element.name = this._options.caseSensitiveTags\r\n                ? element.name.substring(1)\r\n                : element.name.substring(1).toLowerCase();\r\n            node = this._copyElement(element, parent);\r\n            if (!parent.children) {\r\n              parent.children = [];\r\n            }\r\n            parent.children.push(node);\r\n            if (element.name) {\r\n              //Don't add tags to the tag stack that can't have children\r\n              this._tagStack.push(node); //子要素にする\r\n            }\r\n            this._lastTag = node;\r\n          }\r\n        } else {\r\n          //This is not a container element\r\n          parent = this._tagStack.last();\r\n          if (element.type === Mode.Attr) {\r\n            if (!this._lastTag.attributes) {\r\n              this._lastTag.attributes = {};\r\n            }\r\n            this._lastTag.attributes[\r\n              this._options.caseSensitiveAttr\r\n                ? element.name\r\n                : element.name.toLowerCase()\r\n            ] =\r\n              element.data;\r\n            /*\r\n                      if (!parent.attributes) {\r\n                          parent.attributes = {};\r\n                      }\r\n                      parent.attributes[this._options.caseSensitiveAttr ? element.name : element.name.toLowerCase()] =\r\n                          element.data;\r\n                    */\r\n          } else {\r\n            if (!parent.children) {\r\n              parent.children = [];\r\n            }\r\n            parent.children.push(this._copyElement(element, parent));\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    //**Private**//\r\n    //Methods//\r\n\r\n  }\r\nexport { HtmlBuilder as DefaultHandler };\r\n\r\nexport class Element {\r\n    //Properties//\r\n    //Methods//\r\n    constructor(_type, _parentNode) {\r\n      this.type = _type;\r\n      this.parentNode = _parentNode;\r\n    }\r\n    get nextSibling() {\r\n      if (!this.parentNode || !this.parentNode.children) return null;\r\n      var i = this.parentNode.children.indexOf(this);\r\n      if (i == -1 || this.parentNode.children.lenght <= i) return null;\r\n      return this.parentNode.children[i + 1];\r\n    };\r\n    get attribs() {\r\n      if (!this.attributes) return null;\r\n      var ret = {};\r\n      for (var _key in this.attributes) {\r\n        var content = \"\";\r\n        this.attributes[_key].forEach(function (_row) {\r\n          content = _row.data || \"\";\r\n        });\r\n        ret[_key] = content;\r\n      }\r\n      console.log(\"attribs\", ret);\r\n      return ret;\r\n    }\r\n\r\n    getElementById(id, recurse) {\r\n      return DomUtils.getElementById(id, this, recurse);\r\n    };\r\n    getElementsByTagName(id, recurse, limit) {\r\n      return DomUtils.getElementsByTagName(id, this, recurse, limit);\r\n    };\r\n    getElementsByTagType(type, recurse, limit) {\r\n      return DomUtils.getElementsByTagType(type, this, recurse, limit);\r\n    };\r\n    getElements(options, recurse, limit) {\r\n      return DomUtils.getElements(options, this, recurse, limit);\r\n    };\r\n    removeChildAll() {\r\n      return DomUtils.removeChildAll(this);\r\n    };\r\n    removeChild(element) {\r\n      return DomUtils.removeChild(element, this);\r\n    };\r\n    createNode(type, parentNode) {\r\n      return new Element(type, parentNode || null);\r\n    };\r\n    createElement(tagName, parentNode) {\r\n      var newElement = new Element(\"tag\", parentNode || null);\r\n      newElement.name = tagName;\r\n      return newElement;\r\n    };\r\n    createTextNode(text, parentNode) {\r\n      var newElement = new Element(\"text\", parentNode || null);\r\n      newElement.data = text;\r\n      return newElement;\r\n    };\r\n\r\n    appendChild(element) {\r\n      this.children = this.children || [];\r\n      element.parentNode = this;\r\n      this.children.push(element);\r\n    };\r\n\r\n    insertBefore(newNode, referenceNode) {\r\n      this.children = this.children || [];\r\n      var index = this.children.indexOf(referenceNode);\r\n      this.children.splice(index, 0, newNode);\r\n    };\r\n\r\n    getAttribute(name) {\r\n      this.attributes[name];\r\n    };\r\n\r\n    cloneElement(parentNode) {\r\n      function cloneAttributes(attributes) {\r\n        var newAttributes = {};\r\n        for (var key in attributes) {\r\n          var attribute = attributes[key]; //list\r\n          var _attribute = [];\r\n          for (var i = 0; i < attribute.length; i++) {\r\n            var attributeElement = attribute[i]; //object {type,data,langName}\r\n            var _attributeElement = {\r\n              type: attributeElement.type,\r\n              data: attributeElement.data\r\n            };\r\n            if (attributeElement.langName)\r\n              _attributeElement.langName = attributeElement.langName;\r\n            _attribute.push(_attributeElement);\r\n          }\r\n          newAttributes[key] = _attribute;\r\n        }\r\n        return newAttributes;\r\n      }\r\n      var newElement = this.createNode(this.type, parentNode || {});\r\n      if (this.name) newElement.name = this.name;\r\n      if (this.raw) newElement.raw = this.raw;\r\n      if (this.location)\r\n        newElement.location = {\r\n          line: this.location.line,\r\n          col: this.location.col\r\n        };\r\n      if (this.langName) newElement.langName = this.langName;\r\n      if (this.data) newElement.data = this.data;\r\n\r\n      if (this.attributes)\r\n        newElement.attributes = cloneAttributes(this.attributes);\r\n      if (this.children) {\r\n        newElement.children = [];\r\n        for (var i = 0; i < this.children.length; i++) {\r\n          var child = this.children[i];\r\n          child.cloneElement(newElement);\r\n        }\r\n      }\r\n      if (newElement.parentNode.children) {\r\n        newElement.parentNode.children.push(newElement);\r\n      } else {\r\n        newElement.parentNode.children = [newElement];\r\n      }\r\n      return newElement;\r\n    };\r\n    //getElementsByClassName\r\n    //getAttribute\r\n    //setAttribute\r\n    //removeAttribute\r\n\r\n  }"]}