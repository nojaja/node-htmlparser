{"version":3,"sources":["htmlparser.es6"],"names":["parseDOM","window","Tautologistics","NodeHtmlParser","exports","inherits","ctor","superCtor","tempCtor","prototype","super_","constructor","Mode","Text","Script","Tag","Attr","CData","Doctype","Comment","TagType","langName","open","close","openCode","closeCode","opentags","forEach","tagtype","push","data","options","handler","HtmlBuilder","Parser","parseComplete","newElement","Element","parentNode","children","dom","builder","writable","_options","_validateBuilder","Error","reset","done","write","error","self","_builder","_state","mode","lastMode","pos","pendingText","pendingWrite","lastTag","isScript","needData","output","commentTagType","scriptTagType","parseText","ParseText","_parseText","state","parseScript","ParseScript","_parseScript","parseTag","ParseTag","_parseTag","parseAttr","ParseAttr","_parseAttr","parseCData","ParseCData","_parseCData","parseDoctype","ParseDoctype","_parseDoctype","parseComment","ParseComment","_parseComment","Buffer","toString","parseChunk","arguments","length","chunk","substr","_parse","replace","RegExp","_flushWrite","node","i","len","perser","_re_parseText_tagOpen","join","_re_parseText_scriptClose","nextMode","foundPos","lastIndex","exec","index","match","text","substring","_write","type","re_parseScript","charAt","name","re_parseTag","raw","tag","toLowerCase","_writePending","ParseAttr_findName","re_parseAttr_findName","ParseAttr_findValue","re_parseAttr_findValue","re_parseAttr_findValue_last","value","re_parseAttr_splitValue","re_parseAttr_selfClose","parseAttr_findName","parseAttr_findValue","name_data","_parseAttr_findName","matchTrailingSlash","indexOf","value_data","_parseAttr_findValue","foundCloseScriptPos","err","parser","re_parseCData_findEnding","matchPartialCDataEnd","re_parseComment_findEnding","matchPartialCommentEnd","callback","_callback","_done","_tagStack","_emptyTags","area","base","basefont","br","col","frame","hr","img","input","isindex","link","meta","param","embed","wbr","reWhitespace","ignoreWhitespace","undefined","includeLocation","verbose","enforceEmptyTags","caseSensitiveTags","caseSensitiveAttr","array","setPrototypeOfDomUtils","_lastTag","last","HtmlBuilder$_tagStack$last","_line","_col","handleCallback","element","line","positionData","lines","split","location","_getLocation","_updateLocation","test","parent","_copyElement","isEmptyTag","attributes","baseName","pop","DefaultHandler","_type","_parentNode","id","recurse","DomUtils","getElementById","limit","getElementsByTagName","getElementsByTagType","getElements","removeChildAll","removeChild","tagName","newNode","referenceNode","splice","cloneAttributes","newAttributes","key","attribute","_attribute","attributeElement","_attributeElement","createNode","child","cloneElement","lenght","ret","_key","content","_row","console","log","option","hasOwnProperty","testAttribute","currentElement","isNaN","parseInt","found","elementList","getTest","checkVal","testElement","Array","concat","result","tag_name","tag_type"],"mappings":"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","file":"htmlparser.js","sourcesContent":["/***********************************************\nCopyright 2010 - 2012 Chris Winberry <chris@winberry.net>. All rights reserved.\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to\ndeal in the Software without restriction, including without limitation the\nrights to use, copy, modify, merge, publish, distribute, sublicense, and/or\nsell copies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\nIN THE SOFTWARE.\n***********************************************/\n/* v3.0.0 */\n(function () {\n  if (typeof window !== 'undefined') {\n    if (!window.Tautologistics) {\n      window.Tautologistics = {};\n    }\n    window.Tautologistics.NodeHtmlParser = exports;\n  }\n})();\n\n  function inherits(ctor, superCtor) {\n    var tempCtor = function () { };\n    tempCtor.prototype = superCtor.prototype;\n    ctor.super_ = superCtor;\n    ctor.prototype = new tempCtor();\n    ctor.prototype.constructor = ctor;\n  }\n\n  var Mode = {\n    Text: \"text\",\n    Script: \"script\",\n    Tag: \"tag\",\n    Attr: \"attr\",\n    CData: \"cdata\",\n    Doctype: \"doctype\",\n    Comment: \"comment\"\n  };\n  var TagType = [\n    {\n      langName: \"mustache\",\n      open: \"{{\",\n      close: \"}}\",\n      openCode: \"\\uFFF0\",\n      closeCode: \"\\uFFF1\"\n    },\n    {\n      langName: \"singleMustache\",\n      open: \"{%\",\n      close: \"%}\",\n      openCode: \"\\uFFF2\",\n      closeCode: \"\\uFFF3\"\n    }\n  ];\n\n  var opentags = [];\n  TagType.forEach(function (tagtype) {\n    opentags.push(tagtype.openCode);\n  }, this);\n\n//Node版の場合はParserをStreamからの継承にする\n/*\n//ES6だとこの方法は動かないので別の方法を考えなくてはならない\n  if (typeof module !== \"undefined\" && typeof module.exports !== \"undefined\") {\n    var Stream = require(\"stream\");\n    inherits(Parser, Stream);\n  }\n*/\n\n/*\n  function RssBuilder(callback) {\n    RssBuilder.super_.call(this, callback, {\n      ignoreWhitespace: true,\n      verbose: false,\n      enforceEmptyTags: false,\n      caseSensitiveTags: true\n    });\n  }\n  inherits(RssBuilder, HtmlBuilder);\n\n  RssBuilder.prototype.done = function RssBuilder$done() {\n    var feed = {};\n    var feedRoot;\n\n    var found = DomUtils.getElementsByTagName(\n      function (value) {\n        return value == \"rss\" || value == \"feed\";\n      },\n      this.dom,\n      false\n    );\n    if (found.length) {\n      feedRoot = found[0];\n    }\n    if (feedRoot) {\n      if (feedRoot.name == \"rss\") {\n        feed.type = \"rss\";\n        feedRoot = feedRoot.children[0]; //<channel/>\n        feed.id = \"\";\n        try {\n          feed.title = DomUtils.getElementsByTagName(\n            \"title\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.link = DomUtils.getElementsByTagName(\n            \"link\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.description = DomUtils.getElementsByTagName(\n            \"description\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.updated = new Date(\n            DomUtils.getElementsByTagName(\n              \"lastBuildDate\",\n              feedRoot.children,\n              false\n            )[0].children[0].data\n          );\n        } catch (ex) { }\n        try {\n          feed.author = DomUtils.getElementsByTagName(\n            \"managingEditor\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        feed.items = [];\n        DomUtils.getElementsByTagName(\"item\", feedRoot.children).forEach(\n          function (item, index, list) {\n            var entry = {};\n            try {\n              entry.id = DomUtils.getElementsByTagName(\n                \"guid\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.title = DomUtils.getElementsByTagName(\n                \"title\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.link = DomUtils.getElementsByTagName(\n                \"link\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.description = DomUtils.getElementsByTagName(\n                \"description\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.pubDate = new Date(\n                DomUtils.getElementsByTagName(\n                  \"pubDate\",\n                  item.children,\n                  false\n                )[0].children[0].data\n              );\n            } catch (ex) { }\n            feed.items.push(entry);\n          }\n        );\n      } else {\n        feed.type = \"atom\";\n        try {\n          feed.id = DomUtils.getElementsByTagName(\n            \"id\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.title = DomUtils.getElementsByTagName(\n            \"title\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.link = DomUtils.getElementsByTagName(\n            \"link\",\n            feedRoot.children,\n            false\n          )[0].attributes.href.value;\n        } catch (ex) { }\n        try {\n          feed.description = DomUtils.getElementsByTagName(\n            \"subtitle\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.updated = new Date(\n            DomUtils.getElementsByTagName(\n              \"updated\",\n              feedRoot.children,\n              false\n            )[0].children[0].data\n          );\n        } catch (ex) { }\n        try {\n          feed.author = DomUtils.getElementsByTagName(\n            \"email\",\n            feedRoot.children,\n            true\n          )[0].children[0].data;\n        } catch (ex) { }\n        feed.items = [];\n        DomUtils.getElementsByTagName(\"entry\", feedRoot.children).forEach(\n          function (item, index, list) {\n            var entry = {};\n            try {\n              entry.id = DomUtils.getElementsByTagName(\n                \"id\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.title = DomUtils.getElementsByTagName(\n                \"title\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.link = DomUtils.getElementsByTagName(\n                \"link\",\n                item.children,\n                false\n              )[0].attributes.href.value;\n            } catch (ex) { }\n            try {\n              entry.description = DomUtils.getElementsByTagName(\n                \"summary\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.pubDate = new Date(\n                DomUtils.getElementsByTagName(\n                  \"updated\",\n                  item.children,\n                  false\n                )[0].children[0].data\n              );\n            } catch (ex) { }\n            feed.items.push(entry);\n          }\n        );\n      }\n\n      this.dom = feed;\n    }\n    RssBuilder.super_.prototype.done.call(this);\n  };\n\n  */\n\nexport function parseDOM(data, options) {\n    var handler = new HtmlBuilder(options);\n    new Parser(handler, options).parseComplete(data);\n\n    var newElement = new Element(\"#document\", data);\n    newElement.parentNode = {};\n    newElement.children = handler.dom || [];\n    return newElement;\n}\n\r\n\r\nexport class Parser {\n    constructor(builder, options) {\n      //Properties//\n      this.writable = true;\n\n      this._options = options ? options : {};\n      // if (this._options.includeLocation === undefined) {\n      //     this._options.includeLocation = false; //Include position of element (row, col) on nodes\n      // }\n      \n      this._validateBuilder = function(builder) {\n        if (typeof builder != \"object\") {\n          throw new Error(\"Builder is not an object\");\n        }\n        if (typeof builder.reset != \"function\") {\n          throw new Error(\"Builder method 'reset' is invalid\");\n        }\n        if (typeof builder.done != \"function\") {\n          throw new Error(\"Builder method 'done' is invalid\");\n        }\n        if (typeof builder.write != \"function\") {\n          throw new Error(\"Builder method 'write' is invalid\");\n        }\n        if (typeof builder.error != \"function\") {\n          throw new Error(\"Builder method 'error' is invalid\");\n        }\n      };\n      \n      this._validateBuilder(builder);\n      var self = this;\n      this._builder = builder;\n      \n      \n      this.reset=function() {\n        this._state = {\n          mode: Mode.Text,\n          lastMode: Mode.Text,\n          pos: 0,\n          data: null,\n          pendingText: null,\n          pendingWrite: null,\n          lastTag: null,\n          isScript: false,\n          needData: false,\n          output: [],\n          done: false,\n          commentTagType: \">\",\n          scriptTagType: null\n          // line: 1,\n          // col: 1\n        };\n        this._builder.reset();\n      }\n      \n      this.reset();\n\n      let parseText = new ParseText(this);\n      this._parseText = (state) => parseText._parseText(state);\n      let parseScript = new ParseScript(this);\n      this._parseScript = (state) => parseScript._parseScript(state);\n      let parseTag = new ParseTag(this);\n      this._parseTag = (state) => parseTag._parseTag(state);\n      let parseAttr = new ParseAttr(this);\n      this._parseAttr = (state) => parseAttr._parseAttr(state);\n      let parseCData = new ParseCData(this);\n      this._parseCData = (state) => parseCData._parseCData(state);\n      let parseDoctype = new ParseDoctype(this);\n      this._parseDoctype = (state) => parseDoctype._parseDoctype(state);\n      let parseComment = new ParseComment(this);\n      this._parseComment = (state) => parseComment._parseComment(state);\n   \n    }\n    //**Public**//\n    write(data) {\n      if (data instanceof Buffer) {\n        data = data.toString();\n      }\n      this.parseChunk(data);\n    }\n    end(data) {\n      if (arguments.length) {\n        this.write(data);\n      }\n      this.writable = false;\n      this.done();\n    }\n    destroy() {\n      this.writable = false;\n    }\n    \n    parseChunk(chunk) {\n      this._state.needData = false;\n      this._state.data =\n        this._state.data !== null\n          ? this._state.data.substr(this.pos) + chunk\n          : chunk;\n      while (\n        this._state.pos < this._state.data.length &&\n        !this._state.needData\n      ) {\n        this._parse(this._state);\n      }\n    }\n    parseComplete(data) {\n      if (!data) return;\n      this.reset();\n      TagType.forEach(function(tagtype) {\n        data = data\n          .replace(new RegExp(tagtype.open, \"g\"), tagtype.openCode)\n          .replace(new RegExp(tagtype.close, \"g\"), tagtype.closeCode);\n      }, this);\n      this.parseChunk(data);\n      this.done();\n    }\n    done() {\n      this._state.done = true;\n      this._parse(this._state);\n      this._flushWrite();\n      this._builder.done();\n    }\n\n    //**Private**//\n    _parse() {\n      switch (this._state.mode) {\n        case Mode.Text:\n          return this._parseText(this._state);\n        case Mode.Script:\n          return this._parseScript(this._state);\n        case Mode.Tag:\n          return this._parseTag(this._state);\n        case Mode.Attr:\n          return this._parseAttr(this._state);\n        case Mode.CData:\n          return this._parseCData(this._state);\n        case Mode.Doctype:\n          return this._parseDoctype(this._state);\n        case Mode.Comment:\n          return this._parseComment(this._state);\n      }\n    }\n    _writePending(node) {\n      if (!this._state.pendingWrite) {\n        this._state.pendingWrite = [];\n      }\n      this._state.pendingWrite.push(node);\n    }\n    _flushWrite() {\n      if (this._state.pendingWrite) {\n        for (var i = 0, len = this._state.pendingWrite.length; i < len; i++) {\n          var node = this._state.pendingWrite[i];\n          this._builder.write(node);\n        }\n        this._state.pendingWrite = null;\n      }\n    }\n    _write(node) {\n      this._flushWrite();\n      this._builder.write(node);\n    }\n  }\n\r\n\r\nexport class ParseText {\n    constructor(perser) {\n      this.perser = perser;\n      this._re_parseText_tagOpen = new RegExp(\"([\\\\<\" + opentags.join(\"\") + \"])\", \"g\");\n      this._re_parseText_scriptClose = /<\\s*\\/\\s*(x\\-)?script/gi;\n    }\n\n    _parseText(state){\n      var nextMode = Mode.Tag;\n      var foundPos;\n      if (state.isScript) {\n        this._re_parseText_scriptClose.lastIndex = state.pos;\n        foundPos = this._re_parseText_scriptClose.exec(state.data);\n        foundPos = foundPos ? foundPos.index : -1;\n      } else {\n        this._re_parseText_tagOpen.lastIndex = state.pos;\n        var match = this._re_parseText_tagOpen.exec(state.data);\n        if (match) {\n          if (match[0] == \"<\") {\n            nextMode = Mode.Tag;\n            foundPos = match.index;\n          } else {\n            TagType.forEach(function(tagtype) {\n              if (match[0] == tagtype.openCode) {\n                nextMode = Mode.Script;\n                state.lastMode = Mode.Text;\n                foundPos = match.index;\n                state.scriptTagType = tagtype;\n              }\n            }, this.perser);\n          }\n        } else {\n          nextMode = Mode.Tag;\n          foundPos = -1;\n        }\n      }\n      var text =\n        foundPos === -1\n          ? state.data.substring(state.pos, state.data.length)\n          : state.data.substring(state.pos, foundPos);\n      if (foundPos < 0 && state.done) {\n        foundPos = state.data.length;\n      }\n      if (foundPos < 0) {\n        if (state.isScript) {\n          state.needData = true;\n          return;\n        }\n        if (!state.pendingText) {\n          state.pendingText = [];\n        }\n        state.pendingText.push(\n          state.data.substring(state.pos, state.data.length)\n        );\n        state.pos = state.data.length;\n      } else {\n        if (state.pendingText) {\n          state.pendingText.push(state.data.substring(state.pos, foundPos));\n          text = state.pendingText.join(\"\");\n          state.pendingText = null;\n        } else {\n          text = state.data.substring(state.pos, foundPos);\n        }\n        if (text !== \"\") {\n          this.perser._write({ type: Mode.Text, data: text });\n        }\n        state.pos = foundPos + 1;\n        state.mode = nextMode;\n      }\n    }\n  }\r\n\r\nexport class ParseScript {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseScript = /\\s*([\\/\\#][^\\s\\}]+)?(\\!\\-*)?\\s*([^\\}]*?)\\}/g;\r\n    }\r\n    _parseScript(state){\r\n      var re_parseScript =\r\n        \"\\\\s*([\\\\/\\\\#][^\\\\s\" +\r\n        state.scriptTagType.closeCode +\r\n        \"]+)?(\\\\!\\\\-*)?\\\\s*([^\" +\r\n        state.scriptTagType.closeCode +\r\n        \"]*?)\" +\r\n        state.scriptTagType.closeCode;\r\n      this.re_parseScript = new RegExp(re_parseScript, \"g\");\r\n\r\n      this.re_parseScript.lastIndex = state.pos;\r\n      var match = this.re_parseScript.exec(state.data);\r\n      if (match) {\r\n        state.mode = Mode.Script;\r\n        if (match[2] && match[2].substr(0, 3) === \"!--\") {\r\n          state.mode = Mode.Comment;\r\n          state.commentTagType = state.scriptTagType.closeCode;\r\n          state.pos += 3;\r\n          return;\r\n        }\r\n        if (match[2] && match[2].charAt(0) == \"!\") {\r\n          state.mode = Mode.Comment;\r\n          state.commentTagType = state.scriptTagType.closeCode;\r\n          state.pos += 1;\r\n        }\r\n        var text = match[3];\r\n        if (state.pendingText) {\r\n          state.pendingText.push(text);\r\n          text = state.pendingText.join(\"\");\r\n          state.pendingText = null;\r\n        }\r\n        if (text !== \"\") {\r\n          this.perser._write({\r\n            type: state.mode,\r\n            name: match[1] || match[2],\r\n            data: text,\r\n            langName: state.scriptTagType.langName\r\n          });\r\n        }\r\n        state.pos += match[0].length;\r\n        state.mode = state.lastMode;\r\n      } else {\r\n        //TODO: end of tag?\r\n        //TODO: push to pending?\r\n        state.needData = true;\r\n      }\r\n  };\r\n}\r\n\r\nexport class ParseTag {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseTag = /\\s*(\\/?)\\s*([^\\s>\\/]+)(\\s*)\\??(>?)/g;\r\n    }\r\n    _parseTag(state) {\r\n      this.re_parseTag.lastIndex = state.pos;\r\n      var match = this.re_parseTag.exec(state.data);\r\n      if (match) {\r\n        if (!match[1] && match[2].substr(0, 3) === \"!--\") {\r\n          state.mode = Mode.Comment;\r\n          state.commentTagType = \">\";\r\n          state.pos += 3;\r\n          return;\r\n        }\r\n        if (!match[1] && match[2].substr(0, 8) === \"![CDATA[\") {\r\n          state.mode = Mode.CData;\r\n          state.pos += 8;\r\n          return;\r\n        }\r\n        if (!match[1] && match[2].substr(0, 8) === \"!DOCTYPE\") {\r\n          state.mode = Mode.Doctype;\r\n          state.pos += 8;\r\n          return;\r\n        }\r\n        if (!state.done && state.pos + match[0].length === state.data.length) {\r\n          //We're at the and of the data, might be incomplete\r\n          state.needData = true;\r\n          return;\r\n        }\r\n        var raw;\r\n        if (match[4] === \">\") {\r\n          state.mode = Mode.Text;\r\n          raw = match[0].substr(0, match[0].length - 1);\r\n        } else {\r\n          state.mode = Mode.Attr;\r\n          raw = match[0];\r\n        }\r\n        state.pos += match[0].length;\r\n        var tag = { type: Mode.Tag, name: match[1] + match[2], raw: raw };\r\n        if (state.mode === Mode.Attr) {\r\n          state.lastTag = tag;\r\n        }\r\n        if (tag.name.toLowerCase() === \"script\") {\r\n          state.isScript = true;\r\n        } else if (tag.name.toLowerCase() === \"/script\") {\r\n          state.isScript = false;\r\n        }\r\n        if (tag.name.toLowerCase() === \"x-script\") {\r\n          state.isScript = true;\r\n        } else if (tag.name.toLowerCase() === \"/x-script\") {\r\n          state.isScript = false;\r\n        }\r\n        if (state.mode === Mode.Attr) {\r\n          this.perser._writePending(tag);\r\n        } else {\r\n          this.perser._write(tag);\r\n        }\r\n      } else {\r\n        //TODO: end of tag?\r\n        //TODO: push to pending?\r\n        state.needData = true;\r\n      }\r\n    };\r\n\r\n  }\r\n\r\nexport class ParseAttr_findName {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseAttr_findName = /\\s*([^=<>\\s'\"\\/]+)\\s*/g;\r\n    }\r\n    _parseAttr_findName(state) {\r\n      this.re_parseAttr_findName.lastIndex = state.pos;\r\n      var match = this.re_parseAttr_findName.exec(state.data);\r\n      if (!match) {\r\n        return null;\r\n      }\r\n      if (\r\n        state.pos + match[0].length !==\r\n        this.re_parseAttr_findName.lastIndex\r\n      ) {\r\n        return null;\r\n      }\r\n      return {\r\n        match: match[0],\r\n        name: match[1]\r\n      };\r\n    };\r\n\r\n  }\r\n\r\nexport class ParseAttr_findValue {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseAttr_findValue = /\\s*=\\s*(?:'([^']*)'|\"([^\"]*)\"|([^'\"\\s\\/>]+))\\s*/g;\r\n      this.re_parseAttr_findValue_last = /\\s*=\\s*['\"]?(.*)$/g;\r\n    }\r\n    _parseAttr_findValue(state) {\r\n      this.re_parseAttr_findValue.lastIndex = state.pos;\r\n      var match = this.re_parseAttr_findValue.exec(state.data);\r\n      if (!match) {\r\n        if (!state.done) {\r\n          return null;\r\n        }\r\n        this.re_parseAttr_findValue_last.lastIndex = state.pos;\r\n        match = this.re_parseAttr_findValue_last.exec(state.data);\r\n        if (!match) {\r\n          return null;\r\n        }\r\n        return {\r\n          match: match[0],\r\n          value: match[1] !== \"\" ? match[1] : null\r\n        };\r\n      }\r\n      if (\r\n        state.pos + match[0].length !==\r\n        this.re_parseAttr_findValue.lastIndex\r\n      ) {\r\n        return null;\r\n      }\r\n      return {\r\n        match: match[0],\r\n        value: match[1] || match[2] || match[3]\r\n      };\r\n    };\r\n  }\r\n\r\nexport class ParseAttr {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseAttr_splitValue = /^\\s*=\\s*['\"]?/g;\r\n      this.re_parseAttr_selfClose = /(\\s*\\/\\s*)(>?)/g;\r\n      this.parseAttr_findName = new ParseAttr_findName(perser);\r\n      this.parseAttr_findValue = new ParseAttr_findValue(perser);\r\n    }\r\n    _parseAttr(state) {\r\n      var name_data = this.parseAttr_findName._parseAttr_findName(state);\r\n      if (!name_data || name_data.name === \"?\") {\r\n        this.re_parseAttr_selfClose.lastIndex = state.pos;\r\n        var matchTrailingSlash = this.re_parseAttr_selfClose.exec(state.data);\r\n        if (matchTrailingSlash && matchTrailingSlash.index === state.pos) {\r\n          if (\r\n            !state.done &&\r\n            !matchTrailingSlash[2] &&\r\n            state.pos + matchTrailingSlash[0].length === state.data.length\r\n          ) {\r\n            state.needData = true;\r\n            return;\r\n          }\r\n          state.lastTag.raw += matchTrailingSlash[1];\r\n          // state.output.push({ type: Mode.Tag, name: '/' + state.lastTag.name, raw: null });\r\n          this.perser._write({\r\n            type: Mode.Tag,\r\n            name: \"/\" + state.lastTag.name,\r\n            raw: null\r\n          });\r\n          state.pos += matchTrailingSlash[1].length;\r\n        }\r\n        var foundPos = state.data.indexOf(\">\", state.pos);\r\n        if (foundPos < 0) {\r\n          if (state.done) {\r\n            //TODO: is this needed?\r\n            state.lastTag.raw += state.data.substr(state.pos);\r\n            state.pos = state.data.length;\r\n            return;\r\n          }\r\n          state.needData = true;\r\n        } else {\r\n          // state.lastTag = null;\r\n          state.pos = foundPos + 1;\r\n          state.mode = Mode.Text;\r\n        }\r\n        return;\r\n      }\r\n      if (\r\n        !state.done &&\r\n        state.pos + name_data.match.length === state.data.length\r\n      ) {\r\n        state.needData = true;\r\n        return null;\r\n      }\r\n      state.pos += name_data.match.length;\r\n      var value_data = this.parseAttr_findValue._parseAttr_findValue(state);\r\n      if (value_data) {\r\n        if (\r\n          !state.done &&\r\n          state.pos + value_data.match.length === state.data.length\r\n        ) {\r\n          state.needData = true;\r\n          state.pos -= name_data.match.length;\r\n          return;\r\n        }\r\n        state.pos += value_data.match.length;\r\n      } else {\r\n        this.re_parseAttr_splitValue.lastIndex = state.pos;\r\n        if (this.re_parseAttr_splitValue.exec(state.data)) {\r\n          state.needData = true;\r\n          state.pos -= name_data.match.length;\r\n          return;\r\n        }\r\n        value_data = {\r\n          match: \"\",\r\n          value: null\r\n        };\r\n      }\r\n      state.lastTag.raw += name_data.match + value_data.match;\r\n\r\n      var foundCloseScriptPos = -1;\r\n      var data = [];\r\n      if (value_data.value) {\r\n        var handler = new HtmlBuilder(function (err, dom) { },\r\n          this.perser._builder._options);\r\n        var parser = new Parser(handler);\r\n        parser.parseComplete(value_data.value);\r\n        data = handler.dom;\r\n      }\r\n\r\n      this.perser._writePending({ type: Mode.Attr, name: name_data.name, data: data });\r\n    };\r\n\r\n  }\r\n\r\nexport class ParseCData {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseCData_findEnding = /\\]{1,2}$/;\r\n    }\r\n    _parseCData(state) {\r\n      var foundPos = state.data.indexOf(\"]]>\", state.pos);\r\n      if (foundPos < 0 && state.done) {\r\n        foundPos = state.data.length;\r\n      }\r\n      if (foundPos < 0) {\r\n        this.re_parseCData_findEnding.lastIndex = state.pos;\r\n        var matchPartialCDataEnd = this.re_parseCData_findEnding.exec(\r\n          state.data\r\n        );\r\n        if (matchPartialCDataEnd) {\r\n          state.needData = true;\r\n          return;\r\n        }\r\n        if (!state.pendingText) {\r\n          state.pendingText = [];\r\n        }\r\n        state.pendingText.push(state.data.substr(state.pos, state.data.length));\r\n        state.pos = state.data.length;\r\n        state.needData = true;\r\n      } else {\r\n        var text;\r\n        if (state.pendingText) {\r\n          state.pendingText.push(state.data.substring(state.pos, foundPos));\r\n          text = state.pendingText.join(\"\");\r\n          state.pendingText = null;\r\n        } else {\r\n          text = state.data.substring(state.pos, foundPos);\r\n        }\r\n        this.perser._write({ type: Mode.CData, data: text });\r\n        state.mode = Mode.Text;\r\n        state.pos = foundPos + 3;\r\n      }\r\n    };\r\n  }\r\n\r\nexport class ParseDoctype {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n    }\r\n    _parseDoctype(state) {\r\n      var foundPos = state.data.indexOf(\">\", state.pos);\r\n      if (foundPos < 0 && state.done) {\r\n        foundPos = state.data.length;\r\n      }\r\n      if (foundPos < 0) {\r\n        this.re_parseCData_findEnding.lastIndex = state.pos;\r\n        if (!state.pendingText) {\r\n          state.pendingText = [];\r\n        }\r\n        state.pendingText.push(state.data.substr(state.pos, state.data.length));\r\n        state.pos = state.data.length;\r\n        state.needData = true;\r\n      } else {\r\n        var text;\r\n        if (state.pendingText) {\r\n          state.pendingText.push(state.data.substring(state.pos, foundPos));\r\n          text = state.pendingText.join(\"\");\r\n          state.pendingText = null;\r\n        } else {\r\n          text = state.data.substring(state.pos, foundPos);\r\n        }\r\n        this.perser._write({ type: Mode.Doctype, data: text });\r\n        state.mode = Mode.Text;\r\n        state.pos = foundPos + 1;\r\n      }\r\n    };\r\n  }\r\n\r\nexport class ParseComment {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseComment_findEnding = /\\-{1,2}$/;\r\n    }\r\n    _parseComment(state) {\r\n      var foundPos = state.data.indexOf(\"--\" + state.commentTagType, state.pos);\r\n      if (foundPos < 0 && state.done) {\r\n        foundPos = state.data.length;\r\n      }\r\n      if (foundPos < 0) {\r\n        this.re_parseComment_findEnding.lastIndex = state.pos;\r\n        var matchPartialCommentEnd = this.re_parseComment_findEnding.exec(\r\n          state.data\r\n        );\r\n        if (matchPartialCommentEnd) {\r\n          state.needData = true;\r\n          return;\r\n        }\r\n        if (!state.pendingText) {\r\n          state.pendingText = [];\r\n        }\r\n        state.pendingText.push(state.data.substr(state.pos, state.data.length));\r\n        state.pos = state.data.length;\r\n        state.needData = true;\r\n      } else {\r\n        var text;\r\n        if (state.pendingText) {\r\n          state.pendingText.push(state.data.substring(state.pos, foundPos));\r\n          text = state.pendingText.join(\"\");\r\n          state.pendingText = null;\r\n        } else {\r\n          text = state.data.substring(state.pos, foundPos);\r\n        }\r\n        this.perser._write({ type: Mode.Comment, data: text });\r\n        state.mode = Mode.Text;\r\n        state.pos = foundPos + 3;\r\n      }\r\n    };\r\n\r\n  }\r\n\r\nexport class HtmlBuilder {\r\n    constructor(callback, options) {\r\n      //Properties//\r\n      this._options = null; //Builder options for how to behave\r\n      this._callback = null; //Callback to respond to when parsing done\r\n      this._done = false; //Flag indicating whether builder has been notified of parsing completed\r\n      this._tagStack = null; //List of parents to the currently element being processed\r\n      this.dom = null; //The hierarchical object containing the parsed HTML\r\n\r\n      //HTML Tags that shouldn't contain child nodes\r\n      this._emptyTags = {\r\n        area: 1,\r\n        base: 1,\r\n        basefont: 1,\r\n        br: 1,\r\n        col: 1,\r\n        frame: 1,\r\n        hr: 1,\r\n        img: 1,\r\n        input: 1,\r\n        isindex: 1,\r\n        link: 1,\r\n        meta: 1,\r\n        param: 1,\r\n        embed: 1,\r\n        \"?xml\": 1,\r\n        wbr: 1\r\n      };\r\n      //Regex to detect whitespace only text nodes\r\n      this.reWhitespace = /^\\s*$/;\r\n\r\n      this.reset();\r\n      if (typeof callback == \"function\") {\r\n        this._callback = callback;\r\n      } else {\r\n        options = callback;\r\n      }\r\n      this._options = options ? options : {};\r\n      if (this._options.ignoreWhitespace === undefined) {\r\n        this._options.ignoreWhitespace = false; //Keep whitespace-only text nodes\r\n      }\r\n      if (this._options.includeLocation === undefined) {\r\n        this._options.includeLocation = false; //Include position of element (row, col) on nodes\r\n      }\r\n      if (this._options.verbose === undefined) {\r\n        this._options.verbose = true; //Keep data property for tags and raw property for all\r\n      }\r\n      if (this._options.enforceEmptyTags === undefined) {\r\n        this._options.enforceEmptyTags = true; //Don't allow children for HTML tags defined as empty in spec\r\n      }\r\n      if (this._options.caseSensitiveTags === undefined) {\r\n        this._options.caseSensitiveTags = false; //Lowercase all tag names\r\n      }\r\n      if (this._options.caseSensitiveAttr === undefined) {\r\n        this._options.caseSensitiveAttr = false; //Lowercase all attribute names\r\n      }\r\n    }\r\n    //Methods//\r\n    \r\n    setPrototypeOfDomUtils(array) {}\r\n    //Resets the builder back to starting state\r\n    reset() {\r\n      this.dom = [];\r\n      this.setPrototypeOfDomUtils(this.dom);\r\n      // this._raw = [];\r\n      this._done = false;\r\n      this._tagStack = [];\r\n      this._lastTag = null;\r\n      this._tagStack.last = function HtmlBuilder$_tagStack$last() {\r\n        return this.length ? this[this.length - 1] : null;\r\n      };\r\n      this._line = 1;\r\n      this._col = 1;\r\n    };\r\n    //Signals the builder that parsing is done\r\n    done() {\r\n      this._done = true;\r\n      this.handleCallback(null);\r\n    };\r\n\r\n    error(error) {\r\n      this.handleCallback(error);\r\n    };\r\n\r\n    handleCallback(error) {\r\n      if (typeof this._callback != \"function\") {\r\n        if (error) {\r\n          throw error;\r\n        } else {\r\n          return;\r\n        }\r\n      }\r\n      this._callback(error, this.dom);\r\n    };\r\n\r\n    isEmptyTag(element) {\r\n      var name = element.name.toLowerCase();\r\n      if (name.charAt(0) == \"?\") {\r\n        return true;\r\n      }\r\n      if (name.charAt(0) == \"/\") {\r\n        name = name.substring(1);\r\n      }\r\n      return this._options.enforceEmptyTags && !!this._emptyTags[name];\r\n    };\r\n\r\n    _getLocation() {\r\n      return { line: this._line, col: this._col };\r\n    };\r\n\r\n    // HtmlBuilder.reLineSplit = /(\\r\\n|\\r|\\n)/g;\r\n    _updateLocation(node) {\r\n      var positionData = node.type === Mode.Tag ? node.raw : node.data;\r\n      if (positionData === null) {\r\n        return;\r\n      }\r\n      // var lines = positionData.split(HtmlBuilder.reLineSplit);\r\n      var lines = positionData.split(\"\\n\");\r\n      this._line += lines.length - 1;\r\n      if (lines.length > 1) {\r\n        this._col = 1;\r\n      }\r\n      this._col += lines[lines.length - 1].length;\r\n      if (node.type === Mode.Tag) {\r\n        this._col += 2;\r\n      } else if (node.type === Mode.Comment) {\r\n        this._col += 7;\r\n      } else if (node.type === Mode.CData) {\r\n        this._col += 12;\r\n      }\r\n    };\r\n\r\n    _copyElement(element, parentNode) {\r\n      //var newElement = { type: element.type, parentNode: parentNode};\r\n      var newElement = new Element(element.type, parentNode);\r\n\r\n      if (this._options.verbose && element[\"raw\"] !== undefined) {\r\n        newElement.raw = element.raw;\r\n      }\r\n      if (element[\"name\"] !== undefined) {\r\n        switch (element.type) {\r\n          case Mode.Tag:\r\n            newElement.name = this._options.caseSensitiveTags\r\n              ? element.name\r\n              : element.name.toLowerCase();\r\n            break;\r\n\r\n          case Mode.Attr:\r\n            newElement.name = this._options.caseSensitiveAttr\r\n              ? element.name\r\n              : element.name.toLowerCase();\r\n            break;\r\n\r\n          default:\r\n            newElement.name = this._options.caseSensitiveTags\r\n              ? element.name\r\n              : element.name.toLowerCase();\r\n            break;\r\n        }\r\n      }\r\n      if (element[\"data\"] !== undefined) {\r\n        TagType.forEach(function (tagtype) {\r\n          element.data = element.data\r\n            .replace(new RegExp(tagtype.openCode, \"g\"), tagtype.open)\r\n            .replace(new RegExp(tagtype.closeCode, \"g\"), tagtype.close);\r\n        }, this);\r\n        newElement.data = element.data;\r\n      }\r\n\r\n      if (element[\"langName\"] !== undefined) {\r\n        newElement.langName = element.langName;\r\n      }\r\n\r\n      if (element.location) {\r\n        newElement.location = {\r\n          line: element.location.line,\r\n          col: element.location.col\r\n        };\r\n      }\r\n\r\n      return newElement;\r\n    };\r\n\r\n    write(element) {\r\n      if (this._done) {\r\n        this.handleCallback(\r\n          new Error(\r\n            \"Writing to the builder after done() called is not allowed without a reset()\"\r\n          )\r\n        );\r\n      }\r\n      if (this._options.includeLocation) {\r\n        if (element.type !== Mode.Attr) {\r\n          element.location = this._getLocation();\r\n          this._updateLocation(element);\r\n        }\r\n      }\r\n      if (element.type === Mode.Text && this._options.ignoreWhitespace) {\r\n        if (this.reWhitespace.test(element.data)) {\r\n          return;\r\n        }\r\n      }\r\n      var parent;\r\n      var node;\r\n      if (!this._tagStack.last()) {\r\n        //There are no parent elements\r\n        //If the element can be a container, add it to the tag stack and the top level list\r\n        if (element.type === Mode.Tag) {\r\n          if (element.name.charAt(0) != \"/\") {\r\n            //Ignore closing tags that obviously don't have an opening tag\r\n            node = this._copyElement(element);\r\n            this.dom.push(node);\r\n            if (!this.isEmptyTag(node)) {\r\n              //Don't add tags to the tag stack that can't have children\r\n              this._tagStack.push(node);\r\n            }\r\n            this._lastTag = node;\r\n          }\r\n        } else if (element.type === Mode.Attr && this._lastTag) {\r\n          if (!this._lastTag.attributes) {\r\n            this._lastTag.attributes = {};\r\n          }\r\n          this._lastTag.attributes[\r\n            this._options.caseSensitiveAttr\r\n              ? element.name\r\n              : element.name.toLowerCase()\r\n          ] =\r\n            element.data;\r\n        } else if (element.type === Mode.Script) {\r\n          if (element.name && element.name.charAt(0) == \"/\") {\r\n            return;\r\n          } else if (element.name && element.name.charAt(0) == \"!\") {\r\n            element.name = this._options.caseSensitiveTags\r\n              ? element.name.substring(1)\r\n              : element.name.substring(1).toLowerCase();\r\n            node = this._copyElement(element);\r\n            this.dom.push(node);\r\n            this._lastTag = node;\r\n          } else if (element.name) {\r\n            if (element.name)\r\n              element.name = this._options.caseSensitiveTags\r\n                ? element.name.substring(1)\r\n                : element.name.substring(1).toLowerCase();\r\n            node = this._copyElement(element);\r\n            this.dom.push(node);\r\n            this._tagStack.push(node); //Don't add tags to the tag stack that can't have children\r\n            this._lastTag = node;\r\n          } else {\r\n            //This is not a closing tag\r\n            node = this._copyElement(element);\r\n            this.dom.push(node);\r\n            this._lastTag = node;\r\n          }\r\n        } else {\r\n          //Otherwise just add to the top level list\r\n          this.dom.push(this._copyElement(element));\r\n        }\r\n      } else {\r\n        //There are parent elements\r\n        //If the element can be a container, add it as a child of the element\r\n        //on top of the tag stack and then add it to the tag stack\r\n        if (element.type === Mode.Tag) {\r\n          if (element.name.charAt(0) == \"/\") {\r\n            //This is a closing tag, scan the tagStack to find the matching opening tag\r\n            //and pop the stack up to the opening tag's parent\r\n            var baseName = this._options.caseSensitiveTags\r\n              ? element.name.substring(1)\r\n              : element.name.substring(1).toLowerCase();\r\n            if (!this.isEmptyTag(element)) {\r\n              var pos = this._tagStack.length - 1;\r\n              while (pos > -1 && this._tagStack[pos--].name != baseName) { }\r\n              if (pos > -1 || this._tagStack[0].name == baseName) {\r\n                while (pos < this._tagStack.length - 1) {\r\n                  this._tagStack.pop();\r\n                }\r\n              }\r\n            }\r\n          } else {\r\n            //This is not a closing tag\r\n            parent = this._tagStack.last();\r\n            if (element.type === Mode.Attr) {\r\n              if (!parent.attributes) {\r\n                parent.attributes = {};\r\n              }\r\n              parent.attributes[\r\n                this._options.caseSensitiveAttr\r\n                  ? element.name\r\n                  : element.name.toLowerCase()\r\n              ] =\r\n                element.data;\r\n            } else {\r\n              node = this._copyElement(element, parent);\r\n              if (!parent.children) {\r\n                parent.children = [];\r\n              }\r\n              parent.children.push(node);\r\n              if (!this.isEmptyTag(node)) {\r\n                //Don't add tags to the tag stack that can't have children\r\n                this._tagStack.push(node);\r\n              }\r\n              if (element.type === Mode.Tag) {\r\n                this._lastTag = node;\r\n              }\r\n            }\r\n          }\r\n        } else if (element.type === Mode.Script) {\r\n          if (element.name && element.name.charAt(0) == \"/\") {\r\n            //This is a closing tag, scan the tagStack to find the matching opening tag\r\n            //and pop the stack up to the opening tag's parent\r\n            var baseName = this._options.caseSensitiveTags\r\n              ? element.name.substring(1)\r\n              : element.name.substring(1).toLowerCase();\r\n            if (!this.isEmptyTag(element)) {\r\n              var pos = this._tagStack.length - 1;\r\n              while (pos > -1 && this._tagStack[pos--].name != baseName) { }\r\n              if (pos > -1 || this._tagStack[0].name == baseName) {\r\n                while (pos < this._tagStack.length - 1) {\r\n                  this._tagStack.pop();\r\n                }\r\n              }\r\n            }\r\n          } else if (element.name && element.name.charAt(0) == \"!\") {\r\n            parent = this._tagStack.last();\r\n            if (element.name)\r\n              element.name = this._options.caseSensitiveTags\r\n                ? element.name.substring(1)\r\n                : element.name.substring(1).toLowerCase();\r\n            node = this._copyElement(element, parent);\r\n            if (!parent.children) {\r\n              parent.children = [];\r\n            }\r\n            parent.children.push(node);\r\n            this._lastTag = node;\r\n          } else {\r\n            //This is not a closing tag\r\n            parent = this._tagStack.last();\r\n            if (element.name)\r\n              element.name = this._options.caseSensitiveTags\r\n                ? element.name.substring(1)\r\n                : element.name.substring(1).toLowerCase();\r\n            node = this._copyElement(element, parent);\r\n            if (!parent.children) {\r\n              parent.children = [];\r\n            }\r\n            parent.children.push(node);\r\n            if (element.name) {\r\n              //Don't add tags to the tag stack that can't have children\r\n              this._tagStack.push(node); //子要素にする\r\n            }\r\n            this._lastTag = node;\r\n          }\r\n        } else {\r\n          //This is not a container element\r\n          parent = this._tagStack.last();\r\n          if (element.type === Mode.Attr) {\r\n            if (!this._lastTag.attributes) {\r\n              this._lastTag.attributes = {};\r\n            }\r\n            this._lastTag.attributes[\r\n              this._options.caseSensitiveAttr\r\n                ? element.name\r\n                : element.name.toLowerCase()\r\n            ] =\r\n              element.data;\r\n            /*\r\n                      if (!parent.attributes) {\r\n                          parent.attributes = {};\r\n                      }\r\n                      parent.attributes[this._options.caseSensitiveAttr ? element.name : element.name.toLowerCase()] =\r\n                          element.data;\r\n                    */\r\n          } else {\r\n            if (!parent.children) {\r\n              parent.children = [];\r\n            }\r\n            parent.children.push(this._copyElement(element, parent));\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    //**Private**//\r\n    //Methods//\r\n\r\n  }\r\nexport { HtmlBuilder as DefaultHandler };\r\n\r\nexport class Element {\r\n    //Properties//\r\n    //Methods//\r\n    constructor(_type, _parentNode) {\r\n      this.type = _type;\r\n      this.parentNode = _parentNode;\r\n    }\r\n    get nextSibling() {\r\n      if (!this.parentNode || !this.parentNode.children) return null;\r\n      var i = this.parentNode.children.indexOf(this);\r\n      if (i == -1 || this.parentNode.children.lenght <= i) return null;\r\n      return this.parentNode.children[i + 1];\r\n    };\r\n    get attribs() {\r\n      if (!this.attributes) return null;\r\n      var ret = {};\r\n      for (var _key in this.attributes) {\r\n        var content = \"\";\r\n        this.attributes[_key].forEach(function (_row) {\r\n          content = _row.data || \"\";\r\n        });\r\n        ret[_key] = content;\r\n      }\r\n      console.log(\"attribs\", ret);\r\n      return ret;\r\n    }\r\n\r\n    getElementById(id, recurse) {\r\n      return DomUtils.getElementById(id, this, recurse);\r\n    };\r\n    getElementsByTagName(id, recurse, limit) {\r\n      return DomUtils.getElementsByTagName(id, this, recurse, limit);\r\n    };\r\n    getElementsByTagType(type, recurse, limit) {\r\n      return DomUtils.getElementsByTagType(type, this, recurse, limit);\r\n    };\r\n    getElements(options, recurse, limit) {\r\n      return DomUtils.getElements(options, this, recurse, limit);\r\n    };\r\n    removeChildAll() {\r\n      return DomUtils.removeChildAll(this);\r\n    };\r\n    removeChild(element) {\r\n      return DomUtils.removeChild(element, this);\r\n    };\r\n    createNode(type, parentNode) {\r\n      return new Element(type, parentNode || null);\r\n    };\r\n    createElement(tagName, parentNode) {\r\n      var newElement = new Element(\"tag\", parentNode || null);\r\n      newElement.name = tagName;\r\n      return newElement;\r\n    };\r\n    createTextNode(text, parentNode) {\r\n      var newElement = new Element(\"text\", parentNode || null);\r\n      newElement.data = text;\r\n      return newElement;\r\n    };\r\n\r\n    appendChild(element) {\r\n      this.children = this.children || [];\r\n      element.parentNode = this;\r\n      this.children.push(element);\r\n    };\r\n\r\n    insertBefore(newNode, referenceNode) {\r\n      this.children = this.children || [];\r\n      var index = this.children.indexOf(referenceNode);\r\n      this.children.splice(index, 0, newNode);\r\n    };\r\n\r\n    getAttribute(name) {\r\n      this.attributes[name];\r\n    };\r\n\r\n    cloneElement(parentNode) {\r\n      function cloneAttributes(attributes) {\r\n        var newAttributes = {};\r\n        for (var key in attributes) {\r\n          var attribute = attributes[key]; //list\r\n          var _attribute = [];\r\n          for (var i = 0; i < attribute.length; i++) {\r\n            var attributeElement = attribute[i]; //object {type,data,langName}\r\n            var _attributeElement = {\r\n              type: attributeElement.type,\r\n              data: attributeElement.data\r\n            };\r\n            if (attributeElement.langName)\r\n              _attributeElement.langName = attributeElement.langName;\r\n            _attribute.push(_attributeElement);\r\n          }\r\n          newAttributes[key] = _attribute;\r\n        }\r\n        return newAttributes;\r\n      }\r\n      var newElement = this.createNode(this.type, parentNode || {});\r\n      if (this.name) newElement.name = this.name;\r\n      if (this.raw) newElement.raw = this.raw;\r\n      if (this.location)\r\n        newElement.location = {\r\n          line: this.location.line,\r\n          col: this.location.col\r\n        };\r\n      if (this.langName) newElement.langName = this.langName;\r\n      if (this.data) newElement.data = this.data;\r\n\r\n      if (this.attributes)\r\n        newElement.attributes = cloneAttributes(this.attributes);\r\n      if (this.children) {\r\n        newElement.children = [];\r\n        for (var i = 0; i < this.children.length; i++) {\r\n          var child = this.children[i];\r\n          child.cloneElement(newElement);\r\n        }\r\n      }\r\n      if (newElement.parentNode.children) {\r\n        newElement.parentNode.children.push(newElement);\r\n      } else {\r\n        newElement.parentNode.children = [newElement];\r\n      }\r\n      return newElement;\r\n    };\r\n    //getElementsByClassName\r\n    //getAttribute\r\n    //setAttribute\r\n    //removeAttribute\r\n\r\n  }\r\n\r\nexport class DomUtils {\r\n    //Properties//\r\n    //Methods//\r\n    static testAttribute(option, attributes) {\r\n        for (var i = 0; i < attributes.length; i++) {\r\n        if (option(attributes[i].data)) return true;\r\n        }\r\n        return false;\r\n    }\r\n    static testElement(options, element) {\r\n        if (!element) {\r\n        return false;\r\n        }\r\n\r\n        for (var key in options) {\r\n        if (!options.hasOwnProperty(key)) {\r\n            continue;\r\n        }\r\n        if (key == \"tag_name\") {\r\n            if (element.type !== Mode.Tag) {\r\n            return false;\r\n            }\r\n            if (!options[\"tag_name\"](element.name)) {\r\n            return false;\r\n            }\r\n        } else if (key == \"tag_type\") {\r\n            if (!options[\"tag_type\"](element.type)) {\r\n            return false;\r\n            }\r\n        } else if (key == \"tag_contains\") {\r\n            if (\r\n            element.type !== Mode.Text &&\r\n            element.type !== Mode.Comment &&\r\n            element.type !== Mode.CData\r\n            ) {\r\n            return false;\r\n            }\r\n            if (!options[\"tag_contains\"](element.data)) {\r\n            return false;\r\n            }\r\n        } else {\r\n            //if (!element.attributes || !element.attributes[key] || !options[key](element.attributes[key].value)) {\r\n            if (\r\n            !element.attributes ||\r\n            !element.attributes[key] ||\r\n            !DomUtils.testAttribute(options[key], element.attributes[key])\r\n            ) {\r\n            return false;\r\n            }\r\n        }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    static getElements(\r\n        options,\r\n        currentElement,\r\n        recurse,\r\n        limit\r\n    ) {\r\n        \r\n        let setPrototypeOfDomUtils = function(array) {};\r\n        recurse = recurse === undefined || recurse === null || !!recurse;\r\n        limit = isNaN(parseInt(limit)) ? -1 : parseInt(limit);\r\n\r\n        var found = [];\r\n        var elementList;\r\n        setPrototypeOfDomUtils(found);\r\n\r\n        if (!currentElement) {\r\n        return found;\r\n        }\r\n\r\n        function getTest(checkVal) {\r\n        return function (value) {\r\n            return value == checkVal;\r\n        };\r\n        }\r\n        for (var key in options) {\r\n        if (typeof options[key] != \"function\") {\r\n            options[key] = getTest(options[key]);\r\n        }\r\n        }\r\n\r\n        if (DomUtils.testElement(options, currentElement)) {\r\n        found.push(currentElement);\r\n        }\r\n\r\n        if (limit >= 0 && found.length >= limit) {\r\n        return found;\r\n        }\r\n\r\n        if (recurse && currentElement.children) {\r\n        elementList = currentElement.children;\r\n        } else if (currentElement instanceof Array) {\r\n        elementList = currentElement;\r\n        } else {\r\n        return found;\r\n        }\r\n\r\n        for (var i = 0; i < elementList.length; i++) {\r\n        found = found.concat(\r\n            DomUtils.getElements(options, elementList[i], recurse, limit)\r\n        );\r\n        if (limit >= 0 && found.length >= limit) {\r\n            break;\r\n        }\r\n        }\r\n\r\n        return found;\r\n    }\r\n\r\n    static getElementById(\r\n        id,\r\n        currentElement,\r\n        recurse\r\n    ) {\r\n        var result = DomUtils.getElements({ id: id }, currentElement, recurse, 1);\r\n        return result.length ? result[0] : null;\r\n    }\r\n\r\n    static getElementsByTagName(\r\n        name,\r\n        currentElement,\r\n        recurse,\r\n        limit\r\n    ) {\r\n        return DomUtils.getElements(\r\n        { tag_name: name },\r\n        currentElement,\r\n        recurse,\r\n        limit\r\n        );\r\n    }\r\n\r\n    static getElementsByTagType(\r\n        type,\r\n        currentElement,\r\n        recurse,\r\n        limit\r\n    ) {\r\n        return DomUtils.getElements(\r\n        { tag_type: type },\r\n        currentElement,\r\n        recurse,\r\n        limit\r\n        );\r\n    }\r\n\r\n    static removeChild(element, currentElement) {\r\n        for (var i = 0; i < currentElement.children.length; i++) {\r\n            if (element === currentElement.children[i]) {\r\n                currentElement.children.splice(i, 1);//i番目から1つだけ削除\r\n            }\r\n        }\r\n    }\r\n\r\n    static removeChildAll(currentElement) {\r\n        currentElement.children = [];\r\n    }\r\n}"]}