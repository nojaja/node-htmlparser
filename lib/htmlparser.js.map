{"version":3,"sources":["htmlparser.es6"],"names":["exports","module","Tautologistics","NodeHtmlParser","inherits","ctor","superCtor","tempCtor","prototype","super_","constructor","Mode","Text","Script","Tag","Attr","CData","Doctype","Comment","TagType","langName","open","close","openCode","closeCode","opentags","forEach","tagtype","push","RssBuilder","callback","call","ignoreWhitespace","verbose","enforceEmptyTags","caseSensitiveTags","done","RssBuilder$done","feed","feedRoot","found","DomUtils","getElementsByTagName","value","dom","length","name","type","children","id","title","data","ex","link","description","updated","Date","author","items","item","index","list","entry","pubDate","attributes","href","testAttribute","DomUtils$testAttribute","option","i","testElement","DomUtils$testElement","options","element","key","hasOwnProperty","getElements","DomUtils$getElements","currentElement","recurse","limit","setPrototypeOfDomUtils","array","undefined","isNaN","parseInt","elementList","getTest","checkVal","Array","concat","getElementById","DomUtils$getElementById","result","DomUtils$getElementsByTagName","tag_name","getElementsByTagType","DomUtils$getElementsByTagType","tag_type","removeChild","DomUtils$removeChild","splice","removeChildAll","DomUtils$removeChildAll","parseDOM","handler","HtmlBuilder","Parser","parseComplete","newElement","Element","parentNode","builder","writable","_options","_validateBuilder","Error","reset","write","error","self","_builder","_state","mode","lastMode","pos","pendingText","pendingWrite","lastTag","isScript","needData","output","commentTagType","scriptTagType","parseText","ParseText","_parseText","state","parseScript","ParseScript","_parseScript","parseTag","ParseTag","_parseTag","parseAttr","ParseAttr","_parseAttr","parseCData","ParseCData","_parseCData","parseDoctype","ParseDoctype","_parseDoctype","parseComment","ParseComment","_parseComment","Buffer","toString","parseChunk","arguments","chunk","substr","_parse","replace","RegExp","_flushWrite","node","len","perser","_re_parseText_tagOpen","join","_re_parseText_scriptClose","nextMode","foundPos","lastIndex","exec","match","text","substring","_write","re_parseScript","charAt","re_parseTag","raw","tag","toLowerCase","_writePending","ParseAttr_findName","re_parseAttr_findName","ParseAttr_findValue","re_parseAttr_findValue","re_parseAttr_findValue_last","re_parseAttr_splitValue","re_parseAttr_selfClose","parseAttr_findName","parseAttr_findValue","name_data","_parseAttr_findName","matchTrailingSlash","indexOf","value_data","_parseAttr_findValue","foundCloseScriptPos","err","parser","re_parseCData_findEnding","matchPartialCDataEnd","re_parseComment_findEnding","matchPartialCommentEnd","_callback","_done","_tagStack","_emptyTags","area","base","basefont","br","col","frame","hr","img","input","isindex","meta","param","embed","wbr","reWhitespace","includeLocation","caseSensitiveAttr","_lastTag","last","HtmlBuilder$_tagStack$last","_line","_col","handleCallback","line","positionData","lines","split","location","_getLocation","_updateLocation","test","parent","_copyElement","isEmptyTag","baseName","pop","DefaultHandler","_type","_parentNode","tagName","newNode","referenceNode","cloneAttributes","newAttributes","attribute","_attribute","attributeElement","_attributeElement","createNode","child","cloneElement","lenght","ret","_key","content","_row","console","log"],"mappings":"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","file":"htmlparser.js","sourcesContent":["/***********************************************\nCopyright 2010 - 2012 Chris Winberry <chris@winberry.net>. All rights reserved.\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to\ndeal in the Software without restriction, including without limitation the\nrights to use, copy, modify, merge, publish, distribute, sublicense, and/or\nsell copies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\nIN THE SOFTWARE.\n***********************************************/\n/* v3.0.0 */\n(function () {\n  var exports;\n  if (typeof module !== \"undefined\" && typeof module.exports !== \"undefined\") {\n    exports = module.exports;\n  } else {\n    exports = {};\n    if (!this.Tautologistics) {\n      this.Tautologistics = {};\n    }\n    if (this.Tautologistics.NodeHtmlParser) {\n      return;\n    }\n    this.Tautologistics.NodeHtmlParser = exports;\n  }\n\n})();\n\n  function inherits(ctor, superCtor) {\n    var tempCtor = function () { };\n    tempCtor.prototype = superCtor.prototype;\n    ctor.super_ = superCtor;\n    ctor.prototype = new tempCtor();\n    ctor.prototype.constructor = ctor;\n  }\n\n  var Mode = {\n    Text: \"text\",\n    Script: \"script\",\n    Tag: \"tag\",\n    Attr: \"attr\",\n    CData: \"cdata\",\n    Doctype: \"doctype\",\n    Comment: \"comment\"\n  };\n  var TagType = [\n    {\n      langName: \"mustache\",\n      open: \"{{\",\n      close: \"}}\",\n      openCode: \"\\uFFF0\",\n      closeCode: \"\\uFFF1\"\n    },\n    {\n      langName: \"singleMustache\",\n      open: \"{\",\n      close: \"}\",\n      openCode: \"\\uFFF2\",\n      closeCode: \"\\uFFF3\"\n    }\n  ];\n\n  var opentags = [];\n  TagType.forEach(function (tagtype) {\n    opentags.push(tagtype.openCode);\n  }, this);\n\n//Node版の場合はParserをStreamからの継承にする\n/*\n//ES6だとこの方法は動かないので別の方法を考えなくてはならない\n  if (typeof module !== \"undefined\" && typeof module.exports !== \"undefined\") {\n    var Stream = require(\"stream\");\n    inherits(Parser, Stream);\n  }\n*/\n\n  function RssBuilder(callback) {\n    RssBuilder.super_.call(this, callback, {\n      ignoreWhitespace: true,\n      verbose: false,\n      enforceEmptyTags: false,\n      caseSensitiveTags: true\n    });\n  }\n // inherits(RssBuilder, HtmlBuilder);\n\n\n  RssBuilder.prototype.done = function RssBuilder$done() {\n    var feed = {};\n    var feedRoot;\n\n    var found = DomUtils.getElementsByTagName(\n      function (value) {\n        return value == \"rss\" || value == \"feed\";\n      },\n      this.dom,\n      false\n    );\n    if (found.length) {\n      feedRoot = found[0];\n    }\n    if (feedRoot) {\n      if (feedRoot.name == \"rss\") {\n        feed.type = \"rss\";\n        feedRoot = feedRoot.children[0]; //<channel/>\n        feed.id = \"\";\n        try {\n          feed.title = DomUtils.getElementsByTagName(\n            \"title\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.link = DomUtils.getElementsByTagName(\n            \"link\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.description = DomUtils.getElementsByTagName(\n            \"description\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.updated = new Date(\n            DomUtils.getElementsByTagName(\n              \"lastBuildDate\",\n              feedRoot.children,\n              false\n            )[0].children[0].data\n          );\n        } catch (ex) { }\n        try {\n          feed.author = DomUtils.getElementsByTagName(\n            \"managingEditor\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        feed.items = [];\n        DomUtils.getElementsByTagName(\"item\", feedRoot.children).forEach(\n          function (item, index, list) {\n            var entry = {};\n            try {\n              entry.id = DomUtils.getElementsByTagName(\n                \"guid\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.title = DomUtils.getElementsByTagName(\n                \"title\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.link = DomUtils.getElementsByTagName(\n                \"link\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.description = DomUtils.getElementsByTagName(\n                \"description\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.pubDate = new Date(\n                DomUtils.getElementsByTagName(\n                  \"pubDate\",\n                  item.children,\n                  false\n                )[0].children[0].data\n              );\n            } catch (ex) { }\n            feed.items.push(entry);\n          }\n        );\n      } else {\n        feed.type = \"atom\";\n        try {\n          feed.id = DomUtils.getElementsByTagName(\n            \"id\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.title = DomUtils.getElementsByTagName(\n            \"title\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.link = DomUtils.getElementsByTagName(\n            \"link\",\n            feedRoot.children,\n            false\n          )[0].attributes.href.value;\n        } catch (ex) { }\n        try {\n          feed.description = DomUtils.getElementsByTagName(\n            \"subtitle\",\n            feedRoot.children,\n            false\n          )[0].children[0].data;\n        } catch (ex) { }\n        try {\n          feed.updated = new Date(\n            DomUtils.getElementsByTagName(\n              \"updated\",\n              feedRoot.children,\n              false\n            )[0].children[0].data\n          );\n        } catch (ex) { }\n        try {\n          feed.author = DomUtils.getElementsByTagName(\n            \"email\",\n            feedRoot.children,\n            true\n          )[0].children[0].data;\n        } catch (ex) { }\n        feed.items = [];\n        DomUtils.getElementsByTagName(\"entry\", feedRoot.children).forEach(\n          function (item, index, list) {\n            var entry = {};\n            try {\n              entry.id = DomUtils.getElementsByTagName(\n                \"id\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.title = DomUtils.getElementsByTagName(\n                \"title\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.link = DomUtils.getElementsByTagName(\n                \"link\",\n                item.children,\n                false\n              )[0].attributes.href.value;\n            } catch (ex) { }\n            try {\n              entry.description = DomUtils.getElementsByTagName(\n                \"summary\",\n                item.children,\n                false\n              )[0].children[0].data;\n            } catch (ex) { }\n            try {\n              entry.pubDate = new Date(\n                DomUtils.getElementsByTagName(\n                  \"updated\",\n                  item.children,\n                  false\n                )[0].children[0].data\n              );\n            } catch (ex) { }\n            feed.items.push(entry);\n          }\n        );\n      }\n\n      this.dom = feed;\n    }\n    RssBuilder.super_.prototype.done.call(this);\n  };\n\n  var DomUtils = {\n    testAttribute: function DomUtils$testAttribute(option, attributes) {\n      for (var i = 0; i < attributes.length; i++) {\n        if (option(attributes[i].data)) return true;\n      }\n      return false;\n    },\n    testElement: function DomUtils$testElement(options, element) {\n      if (!element) {\n        return false;\n      }\n\n      for (var key in options) {\n        if (!options.hasOwnProperty(key)) {\n          continue;\n        }\n        if (key == \"tag_name\") {\n          if (element.type !== Mode.Tag) {\n            return false;\n          }\n          if (!options[\"tag_name\"](element.name)) {\n            return false;\n          }\n        } else if (key == \"tag_type\") {\n          if (!options[\"tag_type\"](element.type)) {\n            return false;\n          }\n        } else if (key == \"tag_contains\") {\n          if (\n            element.type !== Mode.Text &&\n            element.type !== Mode.Comment &&\n            element.type !== Mode.CData\n          ) {\n            return false;\n          }\n          if (!options[\"tag_contains\"](element.data)) {\n            return false;\n          }\n        } else {\n          //if (!element.attributes || !element.attributes[key] || !options[key](element.attributes[key].value)) {\n          if (\n            !element.attributes ||\n            !element.attributes[key] ||\n            !DomUtils.testAttribute(options[key], element.attributes[key])\n          ) {\n            return false;\n          }\n        }\n      }\n\n      return true;\n    },\n\n    getElements: function DomUtils$getElements(\n      options,\n      currentElement,\n      recurse,\n      limit\n    ) {\n      \n      setPrototypeOfDomUtils = function(array) {};\n      recurse = recurse === undefined || recurse === null || !!recurse;\n      limit = isNaN(parseInt(limit)) ? -1 : parseInt(limit);\n\n      var found = [];\n      var elementList;\n      setPrototypeOfDomUtils(found);\n\n      if (!currentElement) {\n        return found;\n      }\n\n      function getTest(checkVal) {\n        return function (value) {\n          return value == checkVal;\n        };\n      }\n      for (var key in options) {\n        if (typeof options[key] != \"function\") {\n          options[key] = getTest(options[key]);\n        }\n      }\n\n      if (DomUtils.testElement(options, currentElement)) {\n        found.push(currentElement);\n      }\n\n      if (limit >= 0 && found.length >= limit) {\n        return found;\n      }\n\n      if (recurse && currentElement.children) {\n        elementList = currentElement.children;\n      } else if (currentElement instanceof Array) {\n        elementList = currentElement;\n      } else {\n        return found;\n      }\n\n      for (var i = 0; i < elementList.length; i++) {\n        found = found.concat(\n          DomUtils.getElements(options, elementList[i], recurse, limit)\n        );\n        if (limit >= 0 && found.length >= limit) {\n          break;\n        }\n      }\n\n      return found;\n    },\n\n    getElementById: function DomUtils$getElementById(\n      id,\n      currentElement,\n      recurse\n    ) {\n      var result = DomUtils.getElements({ id: id }, currentElement, recurse, 1);\n      return result.length ? result[0] : null;\n    },\n\n    getElementsByTagName: function DomUtils$getElementsByTagName(\n      name,\n      currentElement,\n      recurse,\n      limit\n    ) {\n      return DomUtils.getElements(\n        { tag_name: name },\n        currentElement,\n        recurse,\n        limit\n      );\n    },\n\n    getElementsByTagType: function DomUtils$getElementsByTagType(\n      type,\n      currentElement,\n      recurse,\n      limit\n    ) {\n      return DomUtils.getElements(\n        { tag_type: type },\n        currentElement,\n        recurse,\n        limit\n      );\n    },\n    removeChild: function DomUtils$removeChild(element, currentElement) {\n      for (var i = 0; i < currentElement.children.length; i++) {\n        if (element === currentElement.children[i]) {\n          currentElement.children.splice(i, 1);//i番目から1つだけ削除\n        }\n      }\n    },\n    removeChildAll: function DomUtils$removeChildAll(currentElement) {\n      currentElement.children = [];\n    }\n  };\n\n  function parseDOM(data, options) {\n    var handler = new HtmlBuilder(options);\n    new Parser(handler, options).parseComplete(data);\n\n    var newElement = new Element(\"#document\", data);\n    newElement.parentNode = {};\n    newElement.children = handler.dom || [];\n    return newElement;\n    //return handler.dom;\n  }\n\n  /*\n  exports.Parser = Parser;\n\n  exports.HtmlBuilder = HtmlBuilder;\n  exports.DefaultHandler = HtmlBuilder;\n\n  exports.parseDOM = parseDOM;\n\n  exports.RssBuilder = RssBuilder;\n\n  exports.ElementType = Mode;\n\n  exports.DomUtils = DomUtils;\n*/\n\n//export { HtmlBuilder as HtmlBuilder, HtmlBuilder as DefaultHandler };\r\n\r\nexport class Parser {\n    constructor(builder, options) {\n      //Properties//\n      this.writable = true;\n\n      this._options = options ? options : {};\n      // if (this._options.includeLocation === undefined) {\n      //     this._options.includeLocation = false; //Include position of element (row, col) on nodes\n      // }\n      \n      this._validateBuilder = function(builder) {\n        if (typeof builder != \"object\") {\n          throw new Error(\"Builder is not an object\");\n        }\n        if (typeof builder.reset != \"function\") {\n          throw new Error(\"Builder method 'reset' is invalid\");\n        }\n        if (typeof builder.done != \"function\") {\n          throw new Error(\"Builder method 'done' is invalid\");\n        }\n        if (typeof builder.write != \"function\") {\n          throw new Error(\"Builder method 'write' is invalid\");\n        }\n        if (typeof builder.error != \"function\") {\n          throw new Error(\"Builder method 'error' is invalid\");\n        }\n      };\n      \n      this._validateBuilder(builder);\n      var self = this;\n      this._builder = builder;\n      \n      \n      this.reset=function() {\n        this._state = {\n          mode: Mode.Text,\n          lastMode: Mode.Text,\n          pos: 0,\n          data: null,\n          pendingText: null,\n          pendingWrite: null,\n          lastTag: null,\n          isScript: false,\n          needData: false,\n          output: [],\n          done: false,\n          commentTagType: \">\",\n          scriptTagType: null\n          // line: 1,\n          // col: 1\n        };\n        this._builder.reset();\n      }\n      \n      this.reset();\n\n      let parseText = new ParseText(this);\n      this._parseText = (state) => parseText._parseText(state);\n      let parseScript = new ParseScript(this);\n      this._parseScript = (state) => parseScript._parseScript(state);\n      let parseTag = new ParseTag(this);\n      this._parseTag = (state) => parseTag._parseTag(state);\n      let parseAttr = new ParseAttr(this);\n      this._parseAttr = (state) => parseAttr._parseAttr(state);\n      let parseCData = new ParseCData(this);\n      this._parseCData = (state) => parseCData._parseCData(state);\n      let parseDoctype = new ParseDoctype(this);\n      this._parseDoctype = (state) => parseDoctype._parseDoctype(state);\n      let parseComment = new ParseComment(this);\n      this._parseComment = (state) => parseComment._parseComment(state);\n   \n    }\n    //**Public**//\n    write(data) {\n      if (data instanceof Buffer) {\n        data = data.toString();\n      }\n      this.parseChunk(data);\n    }\n    end(data) {\n      if (arguments.length) {\n        this.write(data);\n      }\n      this.writable = false;\n      this.done();\n    }\n    destroy() {\n      this.writable = false;\n    }\n    \n    parseChunk(chunk) {\n      this._state.needData = false;\n      this._state.data =\n        this._state.data !== null\n          ? this._state.data.substr(this.pos) + chunk\n          : chunk;\n      while (\n        this._state.pos < this._state.data.length &&\n        !this._state.needData\n      ) {\n        this._parse(this._state);\n      }\n    }\n    parseComplete(data) {\n      if (!data) return;\n      this.reset();\n      TagType.forEach(function(tagtype) {\n        data = data\n          .replace(new RegExp(tagtype.open, \"g\"), tagtype.openCode)\n          .replace(new RegExp(tagtype.close, \"g\"), tagtype.closeCode);\n      }, this);\n      this.parseChunk(data);\n      this.done();\n    }\n    done() {\n      this._state.done = true;\n      this._parse(this._state);\n      this._flushWrite();\n      this._builder.done();\n    }\n\n    //**Private**//\n    _parse() {\n      switch (this._state.mode) {\n        case Mode.Text:\n          return this._parseText(this._state);\n        case Mode.Script:\n          return this._parseScript(this._state);\n        case Mode.Tag:\n          return this._parseTag(this._state);\n        case Mode.Attr:\n          return this._parseAttr(this._state);\n        case Mode.CData:\n          return this._parseCData(this._state);\n        case Mode.Doctype:\n          return this._parseDoctype(this._state);\n        case Mode.Comment:\n          return this._parseComment(this._state);\n      }\n    }\n    _writePending(node) {\n      if (!this._state.pendingWrite) {\n        this._state.pendingWrite = [];\n      }\n      this._state.pendingWrite.push(node);\n    }\n    _flushWrite() {\n      if (this._state.pendingWrite) {\n        for (var i = 0, len = this._state.pendingWrite.length; i < len; i++) {\n          var node = this._state.pendingWrite[i];\n          this._builder.write(node);\n        }\n        this._state.pendingWrite = null;\n      }\n    }\n    _write(node) {\n      this._flushWrite();\n      this._builder.write(node);\n    }\n  }\n\r\n\r\nexport class ParseText {\n    constructor(perser) {\n      this.perser = perser;\n      this._re_parseText_tagOpen = new RegExp(\"([\\\\<\" + opentags.join(\"\") + \"])\", \"g\");\n      this._re_parseText_scriptClose = /<\\s*\\/\\s*(x\\-)?script/gi;\n    }\n\n    _parseText(state){\n      var nextMode = Mode.Tag;\n      var foundPos;\n      if (state.isScript) {\n        this._re_parseText_scriptClose.lastIndex = state.pos;\n        foundPos = this._re_parseText_scriptClose.exec(state.data);\n        foundPos = foundPos ? foundPos.index : -1;\n      } else {\n        this._re_parseText_tagOpen.lastIndex = state.pos;\n        var match = this._re_parseText_tagOpen.exec(state.data);\n        if (match) {\n          if (match[0] == \"<\") {\n            nextMode = Mode.Tag;\n            foundPos = match.index;\n          } else {\n            TagType.forEach(function(tagtype) {\n              if (match[0] == tagtype.openCode) {\n                nextMode = Mode.Script;\n                state.lastMode = Mode.Text;\n                foundPos = match.index;\n                state.scriptTagType = tagtype;\n              }\n            }, this.perser);\n          }\n        } else {\n          nextMode = Mode.Tag;\n          foundPos = -1;\n        }\n      }\n      var text =\n        foundPos === -1\n          ? state.data.substring(state.pos, state.data.length)\n          : state.data.substring(state.pos, foundPos);\n      if (foundPos < 0 && state.done) {\n        foundPos = state.data.length;\n      }\n      if (foundPos < 0) {\n        if (state.isScript) {\n          state.needData = true;\n          return;\n        }\n        if (!state.pendingText) {\n          state.pendingText = [];\n        }\n        state.pendingText.push(\n          state.data.substring(state.pos, state.data.length)\n        );\n        state.pos = state.data.length;\n      } else {\n        if (state.pendingText) {\n          state.pendingText.push(state.data.substring(state.pos, foundPos));\n          text = state.pendingText.join(\"\");\n          state.pendingText = null;\n        } else {\n          text = state.data.substring(state.pos, foundPos);\n        }\n        if (text !== \"\") {\n          this.perser._write({ type: Mode.Text, data: text });\n        }\n        state.pos = foundPos + 1;\n        state.mode = nextMode;\n      }\n    }\n  }\r\n\r\nexport class ParseScript {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseScript = /\\s*([\\/\\#][^\\s\\}]+)?(\\!\\-*)?\\s*([^\\}]*?)\\}/g;\r\n    }\r\n    _parseScript(state){\r\n      var re_parseScript =\r\n        \"\\\\s*([\\\\/\\\\#][^\\\\s\" +\r\n        state.scriptTagType.closeCode +\r\n        \"]+)?(\\\\!\\\\-*)?\\\\s*([^\" +\r\n        state.scriptTagType.closeCode +\r\n        \"]*?)\" +\r\n        state.scriptTagType.closeCode;\r\n      this.re_parseScript = new RegExp(re_parseScript, \"g\");\r\n\r\n      this.re_parseScript.lastIndex = state.pos;\r\n      var match = this.re_parseScript.exec(state.data);\r\n      if (match) {\r\n        state.mode = Mode.Script;\r\n        if (match[2] && match[2].substr(0, 3) === \"!--\") {\r\n          state.mode = Mode.Comment;\r\n          state.commentTagType = state.scriptTagType.closeCode;\r\n          state.pos += 3;\r\n          return;\r\n        }\r\n        if (match[2] && match[2].charAt(0) == \"!\") {\r\n          state.mode = Mode.Comment;\r\n          state.commentTagType = state.scriptTagType.closeCode;\r\n          state.pos += 1;\r\n        }\r\n        var text = match[3];\r\n        if (state.pendingText) {\r\n          state.pendingText.push(text);\r\n          text = state.pendingText.join(\"\");\r\n          state.pendingText = null;\r\n        }\r\n        if (text !== \"\") {\r\n          this.perser._write({\r\n            type: state.mode,\r\n            name: match[1] || match[2],\r\n            data: text,\r\n            langName: state.scriptTagType.langName\r\n          });\r\n        }\r\n        state.pos += match[0].length;\r\n        state.mode = state.lastMode;\r\n      } else {\r\n        //TODO: end of tag?\r\n        //TODO: push to pending?\r\n        state.needData = true;\r\n      }\r\n  };\r\n}\r\n\r\nexport class ParseTag {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseTag = /\\s*(\\/?)\\s*([^\\s>\\/]+)(\\s*)\\??(>?)/g;\r\n    }\r\n    _parseTag(state) {\r\n      this.re_parseTag.lastIndex = state.pos;\r\n      var match = this.re_parseTag.exec(state.data);\r\n      if (match) {\r\n        if (!match[1] && match[2].substr(0, 3) === \"!--\") {\r\n          state.mode = Mode.Comment;\r\n          state.commentTagType = \">\";\r\n          state.pos += 3;\r\n          return;\r\n        }\r\n        if (!match[1] && match[2].substr(0, 8) === \"![CDATA[\") {\r\n          state.mode = Mode.CData;\r\n          state.pos += 8;\r\n          return;\r\n        }\r\n        if (!match[1] && match[2].substr(0, 8) === \"!DOCTYPE\") {\r\n          state.mode = Mode.Doctype;\r\n          state.pos += 8;\r\n          return;\r\n        }\r\n        if (!state.done && state.pos + match[0].length === state.data.length) {\r\n          //We're at the and of the data, might be incomplete\r\n          state.needData = true;\r\n          return;\r\n        }\r\n        var raw;\r\n        if (match[4] === \">\") {\r\n          state.mode = Mode.Text;\r\n          raw = match[0].substr(0, match[0].length - 1);\r\n        } else {\r\n          state.mode = Mode.Attr;\r\n          raw = match[0];\r\n        }\r\n        state.pos += match[0].length;\r\n        var tag = { type: Mode.Tag, name: match[1] + match[2], raw: raw };\r\n        if (state.mode === Mode.Attr) {\r\n          state.lastTag = tag;\r\n        }\r\n        if (tag.name.toLowerCase() === \"script\") {\r\n          state.isScript = true;\r\n        } else if (tag.name.toLowerCase() === \"/script\") {\r\n          state.isScript = false;\r\n        }\r\n        if (tag.name.toLowerCase() === \"x-script\") {\r\n          state.isScript = true;\r\n        } else if (tag.name.toLowerCase() === \"/x-script\") {\r\n          state.isScript = false;\r\n        }\r\n        if (state.mode === Mode.Attr) {\r\n          this.perser._writePending(tag);\r\n        } else {\r\n          this.perser._write(tag);\r\n        }\r\n      } else {\r\n        //TODO: end of tag?\r\n        //TODO: push to pending?\r\n        state.needData = true;\r\n      }\r\n    };\r\n\r\n  }\r\n\r\nexport class ParseAttr_findName {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseAttr_findName = /\\s*([^=<>\\s'\"\\/]+)\\s*/g;\r\n    }\r\n    _parseAttr_findName(state) {\r\n      this.re_parseAttr_findName.lastIndex = state.pos;\r\n      var match = this.re_parseAttr_findName.exec(state.data);\r\n      if (!match) {\r\n        return null;\r\n      }\r\n      if (\r\n        state.pos + match[0].length !==\r\n        this.re_parseAttr_findName.lastIndex\r\n      ) {\r\n        return null;\r\n      }\r\n      return {\r\n        match: match[0],\r\n        name: match[1]\r\n      };\r\n    };\r\n\r\n  }\r\n\r\nexport class ParseAttr_findValue {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseAttr_findValue = /\\s*=\\s*(?:'([^']*)'|\"([^\"]*)\"|([^'\"\\s\\/>]+))\\s*/g;\r\n      this.re_parseAttr_findValue_last = /\\s*=\\s*['\"]?(.*)$/g;\r\n    }\r\n    _parseAttr_findValue(state) {\r\n      this.re_parseAttr_findValue.lastIndex = state.pos;\r\n      var match = this.re_parseAttr_findValue.exec(state.data);\r\n      if (!match) {\r\n        if (!state.done) {\r\n          return null;\r\n        }\r\n        this.re_parseAttr_findValue_last.lastIndex = state.pos;\r\n        match = this.re_parseAttr_findValue_last.exec(state.data);\r\n        if (!match) {\r\n          return null;\r\n        }\r\n        return {\r\n          match: match[0],\r\n          value: match[1] !== \"\" ? match[1] : null\r\n        };\r\n      }\r\n      if (\r\n        state.pos + match[0].length !==\r\n        this.re_parseAttr_findValue.lastIndex\r\n      ) {\r\n        return null;\r\n      }\r\n      return {\r\n        match: match[0],\r\n        value: match[1] || match[2] || match[3]\r\n      };\r\n    };\r\n  }\r\n\r\nexport class ParseAttr {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseAttr_splitValue = /^\\s*=\\s*['\"]?/g;\r\n      this.re_parseAttr_selfClose = /(\\s*\\/\\s*)(>?)/g;\r\n      this.parseAttr_findName = new ParseAttr_findName(perser);\r\n      this.parseAttr_findValue = new ParseAttr_findValue(perser);\r\n    }\r\n    _parseAttr(state) {\r\n      var name_data = this.parseAttr_findName._parseAttr_findName(state);\r\n      if (!name_data || name_data.name === \"?\") {\r\n        this.re_parseAttr_selfClose.lastIndex = state.pos;\r\n        var matchTrailingSlash = this.re_parseAttr_selfClose.exec(state.data);\r\n        if (matchTrailingSlash && matchTrailingSlash.index === state.pos) {\r\n          if (\r\n            !state.done &&\r\n            !matchTrailingSlash[2] &&\r\n            state.pos + matchTrailingSlash[0].length === state.data.length\r\n          ) {\r\n            state.needData = true;\r\n            return;\r\n          }\r\n          state.lastTag.raw += matchTrailingSlash[1];\r\n          // state.output.push({ type: Mode.Tag, name: '/' + state.lastTag.name, raw: null });\r\n          this.perser._write({\r\n            type: Mode.Tag,\r\n            name: \"/\" + state.lastTag.name,\r\n            raw: null\r\n          });\r\n          state.pos += matchTrailingSlash[1].length;\r\n        }\r\n        var foundPos = state.data.indexOf(\">\", state.pos);\r\n        if (foundPos < 0) {\r\n          if (state.done) {\r\n            //TODO: is this needed?\r\n            state.lastTag.raw += state.data.substr(state.pos);\r\n            state.pos = state.data.length;\r\n            return;\r\n          }\r\n          state.needData = true;\r\n        } else {\r\n          // state.lastTag = null;\r\n          state.pos = foundPos + 1;\r\n          state.mode = Mode.Text;\r\n        }\r\n        return;\r\n      }\r\n      if (\r\n        !state.done &&\r\n        state.pos + name_data.match.length === state.data.length\r\n      ) {\r\n        state.needData = true;\r\n        return null;\r\n      }\r\n      state.pos += name_data.match.length;\r\n      var value_data = this.parseAttr_findValue._parseAttr_findValue(state);\r\n      if (value_data) {\r\n        if (\r\n          !state.done &&\r\n          state.pos + value_data.match.length === state.data.length\r\n        ) {\r\n          state.needData = true;\r\n          state.pos -= name_data.match.length;\r\n          return;\r\n        }\r\n        state.pos += value_data.match.length;\r\n      } else {\r\n        this.re_parseAttr_splitValue.lastIndex = state.pos;\r\n        if (this.re_parseAttr_splitValue.exec(state.data)) {\r\n          state.needData = true;\r\n          state.pos -= name_data.match.length;\r\n          return;\r\n        }\r\n        value_data = {\r\n          match: \"\",\r\n          value: null\r\n        };\r\n      }\r\n      state.lastTag.raw += name_data.match + value_data.match;\r\n\r\n      var foundCloseScriptPos = -1;\r\n      var data = [];\r\n      if (value_data.value) {\r\n        var handler = new HtmlBuilder(function (err, dom) { },\r\n          this.perser._builder._options);\r\n        var parser = new Parser(handler);\r\n        parser.parseComplete(value_data.value);\r\n        data = handler.dom;\r\n      }\r\n\r\n      this.perser._writePending({ type: Mode.Attr, name: name_data.name, data: data });\r\n    };\r\n\r\n  }\r\n\r\nexport class ParseCData {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseCData_findEnding = /\\]{1,2}$/;\r\n    }\r\n    _parseCData(state) {\r\n      var foundPos = state.data.indexOf(\"]]>\", state.pos);\r\n      if (foundPos < 0 && state.done) {\r\n        foundPos = state.data.length;\r\n      }\r\n      if (foundPos < 0) {\r\n        this.re_parseCData_findEnding.lastIndex = state.pos;\r\n        var matchPartialCDataEnd = this.re_parseCData_findEnding.exec(\r\n          state.data\r\n        );\r\n        if (matchPartialCDataEnd) {\r\n          state.needData = true;\r\n          return;\r\n        }\r\n        if (!state.pendingText) {\r\n          state.pendingText = [];\r\n        }\r\n        state.pendingText.push(state.data.substr(state.pos, state.data.length));\r\n        state.pos = state.data.length;\r\n        state.needData = true;\r\n      } else {\r\n        var text;\r\n        if (state.pendingText) {\r\n          state.pendingText.push(state.data.substring(state.pos, foundPos));\r\n          text = state.pendingText.join(\"\");\r\n          state.pendingText = null;\r\n        } else {\r\n          text = state.data.substring(state.pos, foundPos);\r\n        }\r\n        this.perser._write({ type: Mode.CData, data: text });\r\n        state.mode = Mode.Text;\r\n        state.pos = foundPos + 3;\r\n      }\r\n    };\r\n  }\r\n\r\nexport class ParseDoctype {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n    }\r\n    _parseDoctype(state) {\r\n      var foundPos = state.data.indexOf(\">\", state.pos);\r\n      if (foundPos < 0 && state.done) {\r\n        foundPos = state.data.length;\r\n      }\r\n      if (foundPos < 0) {\r\n        this.re_parseCData_findEnding.lastIndex = state.pos;\r\n        if (!state.pendingText) {\r\n          state.pendingText = [];\r\n        }\r\n        state.pendingText.push(state.data.substr(state.pos, state.data.length));\r\n        state.pos = state.data.length;\r\n        state.needData = true;\r\n      } else {\r\n        var text;\r\n        if (state.pendingText) {\r\n          state.pendingText.push(state.data.substring(state.pos, foundPos));\r\n          text = state.pendingText.join(\"\");\r\n          state.pendingText = null;\r\n        } else {\r\n          text = state.data.substring(state.pos, foundPos);\r\n        }\r\n        this.perser._write({ type: Mode.Doctype, data: text });\r\n        state.mode = Mode.Text;\r\n        state.pos = foundPos + 1;\r\n      }\r\n    };\r\n  }\r\n\r\nexport class ParseComment {\r\n    constructor(perser) {\r\n      this.perser = perser;\r\n      this.re_parseComment_findEnding = /\\-{1,2}$/;\r\n    }\r\n    _parseComment(state) {\r\n      var foundPos = state.data.indexOf(\"--\" + state.commentTagType, state.pos);\r\n      if (foundPos < 0 && state.done) {\r\n        foundPos = state.data.length;\r\n      }\r\n      if (foundPos < 0) {\r\n        this.re_parseComment_findEnding.lastIndex = state.pos;\r\n        var matchPartialCommentEnd = this.re_parseComment_findEnding.exec(\r\n          state.data\r\n        );\r\n        if (matchPartialCommentEnd) {\r\n          state.needData = true;\r\n          return;\r\n        }\r\n        if (!state.pendingText) {\r\n          state.pendingText = [];\r\n        }\r\n        state.pendingText.push(state.data.substr(state.pos, state.data.length));\r\n        state.pos = state.data.length;\r\n        state.needData = true;\r\n      } else {\r\n        var text;\r\n        if (state.pendingText) {\r\n          state.pendingText.push(state.data.substring(state.pos, foundPos));\r\n          text = state.pendingText.join(\"\");\r\n          state.pendingText = null;\r\n        } else {\r\n          text = state.data.substring(state.pos, foundPos);\r\n        }\r\n        this.perser._write({ type: Mode.Comment, data: text });\r\n        state.mode = Mode.Text;\r\n        state.pos = foundPos + 3;\r\n      }\r\n    };\r\n\r\n  }\r\n\r\nexport class HtmlBuilder {\r\n    constructor(callback, options) {\r\n      //Properties//\r\n      this._options = null; //Builder options for how to behave\r\n      this._callback = null; //Callback to respond to when parsing done\r\n      this._done = false; //Flag indicating whether builder has been notified of parsing completed\r\n      this._tagStack = null; //List of parents to the currently element being processed\r\n      this.dom = null; //The hierarchical object containing the parsed HTML\r\n\r\n      //HTML Tags that shouldn't contain child nodes\r\n      this._emptyTags = {\r\n        area: 1,\r\n        base: 1,\r\n        basefont: 1,\r\n        br: 1,\r\n        col: 1,\r\n        frame: 1,\r\n        hr: 1,\r\n        img: 1,\r\n        input: 1,\r\n        isindex: 1,\r\n        link: 1,\r\n        meta: 1,\r\n        param: 1,\r\n        embed: 1,\r\n        \"?xml\": 1,\r\n        wbr: 1\r\n      };\r\n      //Regex to detect whitespace only text nodes\r\n      this.reWhitespace = /^\\s*$/;\r\n\r\n      this.reset();\r\n      if (typeof callback == \"function\") {\r\n        this._callback = callback;\r\n      } else {\r\n        options = callback;\r\n      }\r\n      this._options = options ? options : {};\r\n      if (this._options.ignoreWhitespace === undefined) {\r\n        this._options.ignoreWhitespace = false; //Keep whitespace-only text nodes\r\n      }\r\n      if (this._options.includeLocation === undefined) {\r\n        this._options.includeLocation = false; //Include position of element (row, col) on nodes\r\n      }\r\n      if (this._options.verbose === undefined) {\r\n        this._options.verbose = true; //Keep data property for tags and raw property for all\r\n      }\r\n      if (this._options.enforceEmptyTags === undefined) {\r\n        this._options.enforceEmptyTags = true; //Don't allow children for HTML tags defined as empty in spec\r\n      }\r\n      if (this._options.caseSensitiveTags === undefined) {\r\n        this._options.caseSensitiveTags = false; //Lowercase all tag names\r\n      }\r\n      if (this._options.caseSensitiveAttr === undefined) {\r\n        this._options.caseSensitiveAttr = false; //Lowercase all attribute names\r\n      }\r\n    }\r\n    //Methods//\r\n    \r\n    setPrototypeOfDomUtils(array) {}\r\n    //Resets the builder back to starting state\r\n    reset() {\r\n      this.dom = [];\r\n      this.setPrototypeOfDomUtils(this.dom);\r\n      // this._raw = [];\r\n      this._done = false;\r\n      this._tagStack = [];\r\n      this._lastTag = null;\r\n      this._tagStack.last = function HtmlBuilder$_tagStack$last() {\r\n        return this.length ? this[this.length - 1] : null;\r\n      };\r\n      this._line = 1;\r\n      this._col = 1;\r\n    };\r\n    //Signals the builder that parsing is done\r\n    done() {\r\n      this._done = true;\r\n      this.handleCallback(null);\r\n    };\r\n\r\n    error(error) {\r\n      this.handleCallback(error);\r\n    };\r\n\r\n    handleCallback(error) {\r\n      if (typeof this._callback != \"function\") {\r\n        if (error) {\r\n          throw error;\r\n        } else {\r\n          return;\r\n        }\r\n      }\r\n      this._callback(error, this.dom);\r\n    };\r\n\r\n    isEmptyTag(element) {\r\n      var name = element.name.toLowerCase();\r\n      if (name.charAt(0) == \"?\") {\r\n        return true;\r\n      }\r\n      if (name.charAt(0) == \"/\") {\r\n        name = name.substring(1);\r\n      }\r\n      return this._options.enforceEmptyTags && !!this._emptyTags[name];\r\n    };\r\n\r\n    _getLocation() {\r\n      return { line: this._line, col: this._col };\r\n    };\r\n\r\n    // HtmlBuilder.reLineSplit = /(\\r\\n|\\r|\\n)/g;\r\n    _updateLocation(node) {\r\n      var positionData = node.type === Mode.Tag ? node.raw : node.data;\r\n      if (positionData === null) {\r\n        return;\r\n      }\r\n      // var lines = positionData.split(HtmlBuilder.reLineSplit);\r\n      var lines = positionData.split(\"\\n\");\r\n      this._line += lines.length - 1;\r\n      if (lines.length > 1) {\r\n        this._col = 1;\r\n      }\r\n      this._col += lines[lines.length - 1].length;\r\n      if (node.type === Mode.Tag) {\r\n        this._col += 2;\r\n      } else if (node.type === Mode.Comment) {\r\n        this._col += 7;\r\n      } else if (node.type === Mode.CData) {\r\n        this._col += 12;\r\n      }\r\n    };\r\n\r\n    _copyElement(element, parentNode) {\r\n      //var newElement = { type: element.type, parentNode: parentNode};\r\n      var newElement = new Element(element.type, parentNode);\r\n\r\n      if (this._options.verbose && element[\"raw\"] !== undefined) {\r\n        newElement.raw = element.raw;\r\n      }\r\n      if (element[\"name\"] !== undefined) {\r\n        switch (element.type) {\r\n          case Mode.Tag:\r\n            newElement.name = this._options.caseSensitiveTags\r\n              ? element.name\r\n              : element.name.toLowerCase();\r\n            break;\r\n\r\n          case Mode.Attr:\r\n            newElement.name = this._options.caseSensitiveAttr\r\n              ? element.name\r\n              : element.name.toLowerCase();\r\n            break;\r\n\r\n          default:\r\n            newElement.name = this._options.caseSensitiveTags\r\n              ? element.name\r\n              : element.name.toLowerCase();\r\n            break;\r\n        }\r\n      }\r\n      if (element[\"data\"] !== undefined) {\r\n        TagType.forEach(function (tagtype) {\r\n          element.data = element.data\r\n            .replace(new RegExp(tagtype.openCode, \"g\"), tagtype.open)\r\n            .replace(new RegExp(tagtype.closeCode, \"g\"), tagtype.close);\r\n        }, this);\r\n        newElement.data = element.data;\r\n      }\r\n\r\n      if (element[\"langName\"] !== undefined) {\r\n        newElement.langName = element.langName;\r\n      }\r\n\r\n      if (element.location) {\r\n        newElement.location = {\r\n          line: element.location.line,\r\n          col: element.location.col\r\n        };\r\n      }\r\n\r\n      return newElement;\r\n    };\r\n\r\n    write(element) {\r\n      if (this._done) {\r\n        this.handleCallback(\r\n          new Error(\r\n            \"Writing to the builder after done() called is not allowed without a reset()\"\r\n          )\r\n        );\r\n      }\r\n      if (this._options.includeLocation) {\r\n        if (element.type !== Mode.Attr) {\r\n          element.location = this._getLocation();\r\n          this._updateLocation(element);\r\n        }\r\n      }\r\n      if (element.type === Mode.Text && this._options.ignoreWhitespace) {\r\n        if (this.reWhitespace.test(element.data)) {\r\n          return;\r\n        }\r\n      }\r\n      var parent;\r\n      var node;\r\n      if (!this._tagStack.last()) {\r\n        //There are no parent elements\r\n        //If the element can be a container, add it to the tag stack and the top level list\r\n        if (element.type === Mode.Tag) {\r\n          if (element.name.charAt(0) != \"/\") {\r\n            //Ignore closing tags that obviously don't have an opening tag\r\n            node = this._copyElement(element);\r\n            this.dom.push(node);\r\n            if (!this.isEmptyTag(node)) {\r\n              //Don't add tags to the tag stack that can't have children\r\n              this._tagStack.push(node);\r\n            }\r\n            this._lastTag = node;\r\n          }\r\n        } else if (element.type === Mode.Attr && this._lastTag) {\r\n          if (!this._lastTag.attributes) {\r\n            this._lastTag.attributes = {};\r\n          }\r\n          this._lastTag.attributes[\r\n            this._options.caseSensitiveAttr\r\n              ? element.name\r\n              : element.name.toLowerCase()\r\n          ] =\r\n            element.data;\r\n        } else if (element.type === Mode.Script) {\r\n          if (element.name && element.name.charAt(0) == \"/\") {\r\n            return;\r\n          } else if (element.name && element.name.charAt(0) == \"!\") {\r\n            element.name = this._options.caseSensitiveTags\r\n              ? element.name.substring(1)\r\n              : element.name.substring(1).toLowerCase();\r\n            node = this._copyElement(element);\r\n            this.dom.push(node);\r\n            this._lastTag = node;\r\n          } else if (element.name) {\r\n            if (element.name)\r\n              element.name = this._options.caseSensitiveTags\r\n                ? element.name.substring(1)\r\n                : element.name.substring(1).toLowerCase();\r\n            node = this._copyElement(element);\r\n            this.dom.push(node);\r\n            this._tagStack.push(node); //Don't add tags to the tag stack that can't have children\r\n            this._lastTag = node;\r\n          } else {\r\n            //This is not a closing tag\r\n            node = this._copyElement(element);\r\n            this.dom.push(node);\r\n            this._lastTag = node;\r\n          }\r\n        } else {\r\n          //Otherwise just add to the top level list\r\n          this.dom.push(this._copyElement(element));\r\n        }\r\n      } else {\r\n        //There are parent elements\r\n        //If the element can be a container, add it as a child of the element\r\n        //on top of the tag stack and then add it to the tag stack\r\n        if (element.type === Mode.Tag) {\r\n          if (element.name.charAt(0) == \"/\") {\r\n            //This is a closing tag, scan the tagStack to find the matching opening tag\r\n            //and pop the stack up to the opening tag's parent\r\n            var baseName = this._options.caseSensitiveTags\r\n              ? element.name.substring(1)\r\n              : element.name.substring(1).toLowerCase();\r\n            if (!this.isEmptyTag(element)) {\r\n              var pos = this._tagStack.length - 1;\r\n              while (pos > -1 && this._tagStack[pos--].name != baseName) { }\r\n              if (pos > -1 || this._tagStack[0].name == baseName) {\r\n                while (pos < this._tagStack.length - 1) {\r\n                  this._tagStack.pop();\r\n                }\r\n              }\r\n            }\r\n          } else {\r\n            //This is not a closing tag\r\n            parent = this._tagStack.last();\r\n            if (element.type === Mode.Attr) {\r\n              if (!parent.attributes) {\r\n                parent.attributes = {};\r\n              }\r\n              parent.attributes[\r\n                this._options.caseSensitiveAttr\r\n                  ? element.name\r\n                  : element.name.toLowerCase()\r\n              ] =\r\n                element.data;\r\n            } else {\r\n              node = this._copyElement(element, parent);\r\n              if (!parent.children) {\r\n                parent.children = [];\r\n              }\r\n              parent.children.push(node);\r\n              if (!this.isEmptyTag(node)) {\r\n                //Don't add tags to the tag stack that can't have children\r\n                this._tagStack.push(node);\r\n              }\r\n              if (element.type === Mode.Tag) {\r\n                this._lastTag = node;\r\n              }\r\n            }\r\n          }\r\n        } else if (element.type === Mode.Script) {\r\n          if (element.name && element.name.charAt(0) == \"/\") {\r\n            //This is a closing tag, scan the tagStack to find the matching opening tag\r\n            //and pop the stack up to the opening tag's parent\r\n            var baseName = this._options.caseSensitiveTags\r\n              ? element.name.substring(1)\r\n              : element.name.substring(1).toLowerCase();\r\n            if (!this.isEmptyTag(element)) {\r\n              var pos = this._tagStack.length - 1;\r\n              while (pos > -1 && this._tagStack[pos--].name != baseName) { }\r\n              if (pos > -1 || this._tagStack[0].name == baseName) {\r\n                while (pos < this._tagStack.length - 1) {\r\n                  this._tagStack.pop();\r\n                }\r\n              }\r\n            }\r\n          } else if (element.name && element.name.charAt(0) == \"!\") {\r\n            parent = this._tagStack.last();\r\n            if (element.name)\r\n              element.name = this._options.caseSensitiveTags\r\n                ? element.name.substring(1)\r\n                : element.name.substring(1).toLowerCase();\r\n            node = this._copyElement(element, parent);\r\n            if (!parent.children) {\r\n              parent.children = [];\r\n            }\r\n            parent.children.push(node);\r\n            this._lastTag = node;\r\n          } else {\r\n            //This is not a closing tag\r\n            parent = this._tagStack.last();\r\n            if (element.name)\r\n              element.name = this._options.caseSensitiveTags\r\n                ? element.name.substring(1)\r\n                : element.name.substring(1).toLowerCase();\r\n            node = this._copyElement(element, parent);\r\n            if (!parent.children) {\r\n              parent.children = [];\r\n            }\r\n            parent.children.push(node);\r\n            if (element.name) {\r\n              //Don't add tags to the tag stack that can't have children\r\n              this._tagStack.push(node); //子要素にする\r\n            }\r\n            this._lastTag = node;\r\n          }\r\n        } else {\r\n          //This is not a container element\r\n          parent = this._tagStack.last();\r\n          if (element.type === Mode.Attr) {\r\n            if (!this._lastTag.attributes) {\r\n              this._lastTag.attributes = {};\r\n            }\r\n            this._lastTag.attributes[\r\n              this._options.caseSensitiveAttr\r\n                ? element.name\r\n                : element.name.toLowerCase()\r\n            ] =\r\n              element.data;\r\n            /*\r\n                      if (!parent.attributes) {\r\n                          parent.attributes = {};\r\n                      }\r\n                      parent.attributes[this._options.caseSensitiveAttr ? element.name : element.name.toLowerCase()] =\r\n                          element.data;\r\n                    */\r\n          } else {\r\n            if (!parent.children) {\r\n              parent.children = [];\r\n            }\r\n            parent.children.push(this._copyElement(element, parent));\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    //**Private**//\r\n    //Methods//\r\n\r\n  }\r\nexport { HtmlBuilder as DefaultHandler };\r\n\r\nexport class Element {\r\n    //Properties//\r\n    //Methods//\r\n    constructor(_type, _parentNode) {\r\n      this.type = _type;\r\n      this.parentNode = _parentNode;\r\n    }\r\n    get nextSibling() {\r\n      if (!this.parentNode || !this.parentNode.children) return null;\r\n      var i = this.parentNode.children.indexOf(this);\r\n      if (i == -1 || this.parentNode.children.lenght <= i) return null;\r\n      return this.parentNode.children[i + 1];\r\n    };\r\n    get attribs() {\r\n      if (!this.attributes) return null;\r\n      var ret = {};\r\n      for (var _key in this.attributes) {\r\n        var content = \"\";\r\n        this.attributes[_key].forEach(function (_row) {\r\n          content = _row.data || \"\";\r\n        });\r\n        ret[_key] = content;\r\n      }\r\n      console.log(\"attribs\", ret);\r\n      return ret;\r\n    }\r\n\r\n    getElementById(id, recurse) {\r\n      return DomUtils.getElementById(id, this, recurse);\r\n    };\r\n    getElementsByTagName(id, recurse, limit) {\r\n      return DomUtils.getElementsByTagName(id, this, recurse, limit);\r\n    };\r\n    getElementsByTagType(type, recurse, limit) {\r\n      return DomUtils.getElementsByTagType(type, this, recurse, limit);\r\n    };\r\n    getElements(options, recurse, limit) {\r\n      return DomUtils.getElements(options, this, recurse, limit);\r\n    };\r\n    removeChildAll() {\r\n      return DomUtils.removeChildAll(this);\r\n    };\r\n    removeChild(element) {\r\n      return DomUtils.removeChild(element, this);\r\n    };\r\n    createNode(type, parentNode) {\r\n      return new Element(type, parentNode || null);\r\n    };\r\n    createElement(tagName, parentNode) {\r\n      var newElement = new Element(\"tag\", parentNode || null);\r\n      newElement.name = tagName;\r\n      return newElement;\r\n    };\r\n    createTextNode(text, parentNode) {\r\n      var newElement = new Element(\"text\", parentNode || null);\r\n      newElement.data = text;\r\n      return newElement;\r\n    };\r\n\r\n    appendChild(element) {\r\n      this.children = this.children || [];\r\n      element.parentNode = this;\r\n      this.children.push(element);\r\n    };\r\n\r\n    insertBefore(newNode, referenceNode) {\r\n      this.children = this.children || [];\r\n      var index = this.children.indexOf(referenceNode);\r\n      this.children.splice(index, 0, newNode);\r\n    };\r\n\r\n    getAttribute(name) {\r\n      this.attributes[name];\r\n    };\r\n\r\n    cloneElement(parentNode) {\r\n      function cloneAttributes(attributes) {\r\n        var newAttributes = {};\r\n        for (var key in attributes) {\r\n          var attribute = attributes[key]; //list\r\n          var _attribute = [];\r\n          for (var i = 0; i < attribute.length; i++) {\r\n            var attributeElement = attribute[i]; //object {type,data,langName}\r\n            var _attributeElement = {\r\n              type: attributeElement.type,\r\n              data: attributeElement.data\r\n            };\r\n            if (attributeElement.langName)\r\n              _attributeElement.langName = attributeElement.langName;\r\n            _attribute.push(_attributeElement);\r\n          }\r\n          newAttributes[key] = _attribute;\r\n        }\r\n        return newAttributes;\r\n      }\r\n      var newElement = this.createNode(this.type, parentNode || {});\r\n      if (this.name) newElement.name = this.name;\r\n      if (this.raw) newElement.raw = this.raw;\r\n      if (this.location)\r\n        newElement.location = {\r\n          line: this.location.line,\r\n          col: this.location.col\r\n        };\r\n      if (this.langName) newElement.langName = this.langName;\r\n      if (this.data) newElement.data = this.data;\r\n\r\n      if (this.attributes)\r\n        newElement.attributes = cloneAttributes(this.attributes);\r\n      if (this.children) {\r\n        newElement.children = [];\r\n        for (var i = 0; i < this.children.length; i++) {\r\n          var child = this.children[i];\r\n          child.cloneElement(newElement);\r\n        }\r\n      }\r\n      if (newElement.parentNode.children) {\r\n        newElement.parentNode.children.push(newElement);\r\n      } else {\r\n        newElement.parentNode.children = [newElement];\r\n      }\r\n      return newElement;\r\n    };\r\n    //getElementsByClassName\r\n    //getAttribute\r\n    //setAttribute\r\n    //removeAttribute\r\n\r\n  }"]}